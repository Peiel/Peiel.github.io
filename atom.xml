<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Peiel&#39;s Blog</title>
  
  <subtitle>å¤§å…¶æ„¿ åšå…¶å¿— è™šå…¶å¿ƒ æŸ”å…¶æ°”</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://peierlong.com/"/>
  <updated>2019-03-13T03:20:13.236Z</updated>
  <id>http://peierlong.com/</id>
  
  <author>
    <name>Peiel</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title></title>
    <link href="http://peierlong.com/2019/03/13/%E6%88%91%E7%9A%84%E4%B9%A6%E5%8D%95/"/>
    <id>http://peierlong.com/2019/03/13/æˆ‘çš„ä¹¦å•/</id>
    <published>2019-03-13T02:32:01.043Z</published>
    <updated>2019-03-13T03:20:13.236Z</updated>
    
    <content type="html"><![CDATA[<p>â€”<br>title: My Book List<br>date: 2017-05-31 14:34:06<br>tags: ä¹¦å•<br>categories:</p><pre><code>- è¯»ä¹¦</code></pre><hr><h2 id="è¯­è¨€ç›¸å…³"><a href="#è¯­è¨€ç›¸å…³" class="headerlink" title="è¯­è¨€ç›¸å…³"></a>è¯­è¨€ç›¸å…³</h2><ul><li>ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹</li><li>ã€Šæ·±å…¥ç†è§£JVMã€‹â˜…â˜…â˜…â˜…â˜…</li><li>ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹â˜…â˜…â˜…â˜…â˜…</li><li>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹â˜…â˜…â˜…â˜…â˜…</li><li>ã€ŠEffective Javaã€‹â˜…â˜…â˜…â˜…â˜…</li><li>ã€ŠHead First Pythonã€‹</li><li>ã€ŠCç¨‹åºè®¾è®¡è¯­è¨€(ç¬¬äºŒç‰ˆæ–°ç‰ˆ)ã€‹</li><li>ã€Šæ±‡ç¼–è¯­è¨€(ç¬¬ä¸‰ç‰ˆ)ã€‹</li><li>ã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹•ã€‹</li><li>ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹â˜…â˜…â˜…â˜…â˜†</li></ul><a id="more"></a><h2 id="è®¡ç®—æœºåŸºç¡€ä¸ç½‘ç»œ"><a href="#è®¡ç®—æœºåŸºç¡€ä¸ç½‘ç»œ" class="headerlink" title="è®¡ç®—æœºåŸºç¡€ä¸ç½‘ç»œ"></a>è®¡ç®—æœºåŸºç¡€ä¸ç½‘ç»œ</h2><ul><li>ã€Šæ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿã€‹</li><li><a href="http://book.douban.com/subject/6097773/" target="_blank" rel="noopener">ã€ŠLinuxå†…æ ¸è®¾è®¡ä¸å®ç° ç¬¬3ç‰ˆã€‹</a></li><li><a href="http://book.douban.com/subject/26268767/" target="_blank" rel="noopener">ã€ŠWireSharkç½‘ç»œåˆ†æå°±è¿™ä¹ˆç®€å•ã€‹</a></li><li><a href="http://book.douban.com/subject/26710788/" target="_blank" rel="noopener">ã€ŠWireSharkç½‘ç»œåˆ†æçš„è‰ºæœ¯ã€‹</a></li><li>ã€ŠTCP/IPè¯¦è§£(å·ä¸€ï¼šåè®®)ã€‹</li><li>ã€Šå›¾è§£TCP/IP(ç¬¬äº”ç‰ˆ)ã€‹ </li><li>ã€ŠHTTPæƒå¨æŒ‡å—ã€‹</li><li>ã€Šç¨‹åºå‘˜çš„æ•°å­¦ã€‹ï¼ˆ1åŸºç¡€ 2ç»Ÿè®¡ 3çº¿æ€§ä»£æ•°ï¼‰</li></ul><h2 id="å¼€æºæ¡†æ¶ä¸å…·ä½“æŠ€æœ¯"><a href="#å¼€æºæ¡†æ¶ä¸å…·ä½“æŠ€æœ¯" class="headerlink" title="å¼€æºæ¡†æ¶ä¸å…·ä½“æŠ€æœ¯"></a>å¼€æºæ¡†æ¶ä¸å…·ä½“æŠ€æœ¯</h2><ul><li>ã€ŠHadoopæƒå¨æŒ‡å—ã€‹</li><li>ã€ŠNettyæƒå¨æŒ‡å—ã€‹</li><li>ã€Šä»PAXOSåˆ°ZOOKEEPERåˆ†å¸ƒå¼ä¸€è‡´æ€§åŸç†ä¸å®è·µã€‹</li><li><a href="http://book.douban.com/subject/26593175/" target="_blank" rel="noopener">ã€ŠDocker: å®¹å™¨ä¸å®¹å™¨äº‘ã€‹</a></li><li><a href="http://book.douban.com/subject/26702824/" target="_blank" rel="noopener">ã€Šåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼šåŸç†ä¸å®è·µã€‹</a></li><li><a href="http://book.douban.com/subject/26649141/" target="_blank" rel="noopener">ã€ŠSparkæŠ€æœ¯å†…å¹•ã€‹</a></li><li>ã€ŠMastering Nginx 2nd Editionã€‹</li></ul><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><ul><li>ã€Šäº¿çº§æµé‡ç½‘ç«™æ¶æ„æ ¸å¿ƒæŠ€æœ¯ã€‹ </li><li>ã€Šå¤§å‹ç½‘ç«™æŠ€æœ¯æ¶æ„ã€‹</li><li>ã€Šå¤§å‹åˆ†å¸ƒå¼ç½‘ç«™æ¶æ„è®¾è®¡ä¸å®è·µã€‹</li><li>ã€Šå¤§å‹ç½‘ç«™ç³»ç»Ÿä¸Javaä¸­é—´ä»¶å®è·µã€‹</li></ul><h2 id="ç®—æ³•ä¸æ•°æ®ç»“æ„-amp-è®¾è®¡æ¨¡å¼"><a href="#ç®—æ³•ä¸æ•°æ®ç»“æ„-amp-è®¾è®¡æ¨¡å¼" class="headerlink" title="ç®—æ³•ä¸æ•°æ®ç»“æ„ &amp; è®¾è®¡æ¨¡å¼"></a>ç®—æ³•ä¸æ•°æ®ç»“æ„ &amp; è®¾è®¡æ¨¡å¼</h2><ul><li>ã€Šç®—æ³•å¯¼è®ºã€‹</li><li>ã€Šæ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ(Javaè¯­è¨€æè¿°)ã€‹</li><li>ã€Šç®—æ³•4ã€‹</li></ul><ul><li>ã€ŠHead First è®¾è®¡æ¨¡å¼ã€‹</li></ul><h2 id="æ•°æ®åº“ä¸ç¼“å­˜"><a href="#æ•°æ®åº“ä¸ç¼“å­˜" class="headerlink" title="æ•°æ®åº“ä¸ç¼“å­˜"></a>æ•°æ®åº“ä¸ç¼“å­˜</h2><ul><li>ã€ŠRediså…¥é—¨æŒ‡å—ã€‹</li><li><a href="http://book.douban.com/subject/25900156/" target="_blank" rel="noopener">ã€ŠRedisè®¾è®¡ä¸å®ç°åˆ†æã€‹</a></li><li>ã€ŠMongoDBæƒå¨æŒ‡å—ã€‹</li><li>ã€ŠMySQLæŠ€æœ¯å†…å¹•  InnoDBå­˜å‚¨å¼•æ“  ç¬¬2ç‰ˆã€‹ </li><li>ã€Šé«˜æ€§èƒ½MySqlã€‹â˜…â˜…â˜…â˜…â˜…</li></ul><h2 id="ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»"><a href="#ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»" class="headerlink" title="ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»"></a>ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»</h2><ul><li>ã€ŠClean Codeã€‹</li><li>ã€Šæ•æ·è½¯ä»¶å¼€å‘ã€‹</li><li>ã€Šé‡æ„ã€‹</li><li>ã€Šç¨‹åºå‘˜ä¿®ç‚¼ä¹‹é“-ä»å°å·¥åˆ°ä¸“å®¶ã€‹</li><li>ã€Šä»£ç å¤§å…¨2ã€‹</li></ul><h2 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h2><ul><li>ã€ŠHTMLç§˜ç±ã€‹</li><li>ã€ŠJavaScriptæƒå¨æŒ‡å—ï¼ˆç¬¬å…­ç‰ˆï¼‰ã€‹</li><li>ã€Šäº†ä¸èµ·çš„Node.jsã€‹</li><li>ã€ŠNode.jså¼€å‘æŒ‡å—ã€‹</li><li>ã€Šæ·±å…¥æµ…å‡ºNode.jsã€‹</li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>ã€ŠæŠ€æœ¯ä¹‹ç³ã€‹</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;â€”&lt;br&gt;title: My Book List&lt;br&gt;date: 2017-05-31 14:34:06&lt;br&gt;tags: ä¹¦å•&lt;br&gt;categories:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;- è¯»ä¹¦
&lt;/code&gt;&lt;/pre&gt;&lt;hr&gt;
&lt;h2 id=&quot;è¯­è¨€ç›¸å…³&quot;&gt;&lt;a href=&quot;#è¯­è¨€ç›¸å…³&quot; class=&quot;headerlink&quot; title=&quot;è¯­è¨€ç›¸å…³&quot;&gt;&lt;/a&gt;è¯­è¨€ç›¸å…³&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹&lt;/li&gt;
&lt;li&gt;ã€Šæ·±å…¥ç†è§£JVMã€‹â˜…â˜…â˜…â˜…â˜…&lt;/li&gt;
&lt;li&gt;ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹â˜…â˜…â˜…â˜…â˜…&lt;/li&gt;
&lt;li&gt;ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹â˜…â˜…â˜…â˜…â˜…&lt;/li&gt;
&lt;li&gt;ã€ŠEffective Javaã€‹â˜…â˜…â˜…â˜…â˜…&lt;/li&gt;
&lt;li&gt;ã€ŠHead First Pythonã€‹&lt;/li&gt;
&lt;li&gt;ã€ŠCç¨‹åºè®¾è®¡è¯­è¨€(ç¬¬äºŒç‰ˆæ–°ç‰ˆ)ã€‹&lt;/li&gt;
&lt;li&gt;ã€Šæ±‡ç¼–è¯­è¨€(ç¬¬ä¸‰ç‰ˆ)ã€‹&lt;/li&gt;
&lt;li&gt;ã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹•ã€‹&lt;/li&gt;
&lt;li&gt;ã€ŠJavaå¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹â˜…â˜…â˜…â˜…â˜†&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hexo é—®é¢˜ä¿®å¤è®°å½•</title>
    <link href="http://peierlong.com/2019/03/12/hexo-problem-fix/"/>
    <id>http://peierlong.com/2019/03/12/hexo-problem-fix/</id>
    <published>2019-03-12T13:37:52.000Z</published>
    <updated>2019-03-13T02:32:01.040Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å®‰è£…nvm"><a href="#å®‰è£…nvm" class="headerlink" title="å®‰è£…nvm"></a>å®‰è£…nvm</h2><ol><li><code>curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash</code></li><li>é…ç½®ç¯å¢ƒå˜é‡</li></ol><a id="more"></a><h2 id="ä½¿ç”¨nvmå¿«æ·å®‰è£…node"><a href="#ä½¿ç”¨nvmå¿«æ·å®‰è£…node" class="headerlink" title="ä½¿ç”¨nvmå¿«æ·å®‰è£…node"></a>ä½¿ç”¨nvmå¿«æ·å®‰è£…node</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install 6.17.0</span><br></pre></td></tr></table></figure><h2 id="æŠ¥é”™è§£å†³"><a href="#æŠ¥é”™è§£å†³" class="headerlink" title="æŠ¥é”™è§£å†³"></a>æŠ¥é”™è§£å†³</h2><h3 id="é”™è¯¯1"><a href="#é”™è¯¯1" class="headerlink" title="é”™è¯¯1"></a>é”™è¯¯1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR Plugin load failed: hexo-renderer-sass</span><br></pre></td></tr></table></figure><h3 id="è§£å†³1"><a href="#è§£å†³1" class="headerlink" title="è§£å†³1"></a>è§£å†³1</h3><p>ä½¿ç”¨brewå®‰è£…ç³»ç»Ÿ <code>libsass</code> ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew reinstall libsass</span><br></pre></td></tr></table></figure><h3 id="é”™è¯¯2"><a href="#é”™è¯¯2" class="headerlink" title="é”™è¯¯2"></a>é”™è¯¯2</h3><p>nodeç‰ˆæœ¬ä¸ç¼–è¯‘ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´å¤±è´¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Error: The module &apos;/usr/local/lib/node_modules/hexo/node_modules/dtrace-provider/build/Release/DTraceProviderBindings.node&apos;</span><br><span class="line">was compiled against a different Node.js version using</span><br><span class="line">NODE_MODULE_VERSION 48. This version of Node.js requires</span><br><span class="line">NODE_MODULE_VERSION 67. Please try re-compiling or re-installing</span><br></pre></td></tr></table></figure><h3 id="è§£å†³2"><a href="#è§£å†³2" class="headerlink" title="è§£å†³2"></a>è§£å†³2</h3><p>æ ¹æ®é”™è¯¯æ—¥å¿—ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬å·48çš„nodeç‰ˆæœ¬ï¼Œ<a href="https://nodejs.org/zh-cn/download/releases/" target="_blank" rel="noopener">ç‚¹å‡»æŸ¥çœ‹é“¾æ¥</a></p><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/node_verison.jpg" alt="node_verison.jpg"></p><p>ä½¿ç”¨nvmå®‰è£…å¯¹åº”ç‰ˆæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm install 6.17.0</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>hexo ä¸èƒ½ä½¿ç”¨çš„ä¸»è¦åŸå› è¿˜æ˜¯è®¾å¤‡æ›´æ¢çš„åŸå› ï¼Œæ›´æ¢è®¾å¤‡æ³¨æ„åŒæ­¥nodeç‰ˆæœ¬ï¼Œç¯å¢ƒä¾èµ–ï¼Œå°±ä¸ä¼šå‡ºé—®é¢˜ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å®‰è£…nvm&quot;&gt;&lt;a href=&quot;#å®‰è£…nvm&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…nvm&quot;&gt;&lt;/a&gt;å®‰è£…nvm&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;code&gt;curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®ç¯å¢ƒå˜é‡&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="Hexo" scheme="http://peierlong.com/categories/Hexo/"/>
    
    
      <category term="Hexo" scheme="http://peierlong.com/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot2.xæ•´åˆES2.xæŠ¥failed to load elasticsearch nodes</title>
    <link href="http://peierlong.com/2018/07/18/SpringBoot2.x%E6%95%B4%E5%90%88ES2.x%E6%8A%A5failed-to-load-elasticsearch-nodes/"/>
    <id>http://peierlong.com/2018/07/18/SpringBoot2.xæ•´åˆES2.xæŠ¥failed-to-load-elasticsearch-nodes/</id>
    <published>2018-07-18T02:26:16.000Z</published>
    <updated>2019-03-13T02:32:01.040Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚"><a href="#åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚" class="headerlink" title="åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚"></a>åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR 2075 --- [           main] .d.e.r.s.AbstractElasticsearchRepository : failed to load elasticsearch nodes : org.elasticsearch.client.transport.NoNodeAvailableException: None of the configured nodes are available:</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="ç›¸å…³é…ç½®"><a href="#ç›¸å…³é…ç½®" class="headerlink" title="ç›¸å…³é…ç½®"></a>ç›¸å…³é…ç½®</h2><p><code>pom.xml</code>éƒ¨åˆ†é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.2.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><p><code>application.properties</code> ESç›¸å…³é…ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.data.elasticsearch.repositories.enabled=true</span><br><span class="line">spring.data.elasticsearch.cluster-nodes=192.168.xxx.xxx\:9300</span><br></pre></td></tr></table></figure><h2 id="ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬"></a>ç‰ˆæœ¬</h2><ul><li>SpringBoot2.0</li><li>ES2.4</li></ul><h2 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h2><p>å¯¼è‡´ä¸€ç›´è§£å†³ä¸äº†é—®é¢˜çš„åŸå› æ˜¯<a href="https://github.com/spring-projects/spring-data-elasticsearch/wiki/Spring-Data-Elasticsearch---Spring-Boot---version-matrix" target="_blank" rel="noopener">è¿™ä¸ªé“¾æ¥</a>æ˜¾ç¤ºSpringBoot2.0æ˜¯å…¼å®¹ES2.4çš„ï¼Œæ‰€ä»¥æˆ‘é¦–å…ˆæ’é™¤äº†å…¼å®¹é—®é¢˜ã€‚</p><p>ç½‘ä¸ŠæŸ¥æ‰¾ï¼ŒæŠ¥è¿™ä¸ªé”™çš„åŸå› æ˜¯å› ä¸ºIPé™åˆ¶ï¼Œæ— è®ºæ˜¯ä¿®æ”¹ESçš„é…ç½®ä¸­<code>network.host</code>å±æ€§ä¸º<code>0.0.0.0</code>ä¹Ÿå¥½ï¼Œæˆ‘é“¾æ¥ESçš„æœºå™¨çš„å†…ç½‘IPä¹Ÿå¥½ï¼Œ<strong>éƒ½ä¸å¥½ä½¿</strong>ã€‚</p><p>ä¹‹åçœ‹åˆ°äº†<a href="https://blog.csdn.net/lusyoe/article/details/80107865" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ï¼Œæˆ‘å†æ¬¡æ€€ç–‘æœ‰å¯èƒ½ç‰ˆæœ¬å…¼å®¹çš„é—®é¢˜ï¼Œä¿®æ”¹SpringBootä¸º<code>1.5.9.RELEASE</code>ç‰ˆæœ¬ï¼Œä¸æŠ¥é”™äº†ã€‚</p><p>è¿™ä¸ªå…¼å®¹æ€§é—®é¢˜ï¼Œè¦ä¹ˆé™çº§SpringBootï¼Œè¦ä¹ˆå‡çº§ESï¼Œè¿˜æ˜¯æ›´æ–°ESæ¯”è¾ƒé è°±ã€‚</p><hr><blockquote><p>é™çº§æ˜¯ä¸èƒ½é™çº§çš„ï¼Œè¿™è¾ˆå­éƒ½ä¸å¯èƒ½é™çº§</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚&quot;&gt;&lt;a href=&quot;#åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚&quot; class=&quot;headerlink&quot; title=&quot;åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚&quot;&gt;&lt;/a&gt;åœ¨SpringBootæ•´åˆESæ—¶ï¼Œé‡åˆ°å¦‚ä¸‹é”™è¯¯ã€‚&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ERROR 2075 --- [           main] .d.e.r.s.AbstractElasticsearchRepository : failed to load elasticsearch nodes : org.elasticsearch.client.transport.NoNodeAvailableException: None of the configured nodes are available:&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="ES" scheme="http://peierlong.com/tags/ES/"/>
    
      <category term="Spring" scheme="http://peierlong.com/tags/Spring/"/>
    
      <category term="Spring Boot" scheme="http://peierlong.com/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>HttpClient4.5.3æºç æµ…æ(HttpClientçš„executeæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹)</title>
    <link href="http://peierlong.com/2018/06/29/HttpClient4-5-3%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90(HttpClient%E7%9A%84execute%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B)/"/>
    <id>http://peierlong.com/2018/06/29/HttpClient4-5-3æºç æµ…æ(HttpClientçš„executeæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹)/</id>
    <published>2018-06-29T07:07:03.000Z</published>
    <updated>2019-03-13T02:32:01.036Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€éæ€»ç»“çš„<code>HttpClient</code>å¯¹è±¡çš„æ„é€ è¿‡ç¨‹ï¼Œæœ¬ç¯‡ä¸»è¦æ€»ç»“<code>HttpClient</code>å¯¹è±¡çš„<code>execute()</code>æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬å…ˆçœ‹æ•´ä½“çš„æ—¶åºå›¾ï¼ˆçœç•¥éƒ¨åˆ†ç»†èŠ‚ï¼‰ï¼Œç„¶åä¸€æ­¥æ­¥åˆ†æã€‚å½“ä¸çŸ¥é“æµç¨‹çš„æ—¶å€™èµ°debugä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p><a id="more"></a><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/Xnip2018-06-180_15-08-22.jpg" alt="Xnip2018-06-180_15-08-22.jpg"></p><p>æ ¹æ®ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬çŸ¥é“<code>HttpClient</code>å®ä¾‹æ˜¯ä½¿ç”¨çš„å­ç±»<code>CloseableHttpClient</code>ç±»åˆå§‹åŒ–è€Œæ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹å­ç±»çš„<code>execute()</code>æ–¹æ³•çš„æºä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CloseableHttpResponse <span class="title">execute</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> HttpUriRequest request)</span> <span class="keyword">throws</span> IOException, ClientProtocolException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> execute(request, (HttpContext) <span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@inheritDoc</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CloseableHttpResponse <span class="title">execute</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> HttpUriRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> HttpContext context)</span> <span class="keyword">throws</span> IOException, ClientProtocolException </span>&#123;</span><br><span class="line">    Args.notNull(request, <span class="string">"HTTP request"</span>);</span><br><span class="line">    <span class="keyword">return</span> doExecute(determineTarget(request), request, context);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> CloseableHttpResponse <span class="title">doExecute</span><span class="params">(HttpHost target, HttpRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">        HttpContext context)</span> <span class="keyword">throws</span> IOException, ClientProtocolException</span>;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°è°ƒç”¨é“¾è°ƒç”¨åˆ°äº†æŠ½è±¡æ–¹æ³•<code>doExecute()</code>ï¼Œä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“<code>HttpClient</code>å¯¹è±¡æ„å»ºæœ€åï¼Œæ˜¯ä½¿ç”¨çš„<code>CloseableHttpClient</code>çš„å­ç±»<code>InternalHttpClient</code>åˆ›å»ºçš„å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥çœ‹<code>InternalHttpClient</code>ç±»çš„<code>doExecute()</code>æ–¹æ³•çš„å…·ä½“å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> CloseableHttpResponse <span class="title">doExecute</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> HttpHost target,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> HttpRequest request,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">final</span> HttpContext context)</span> <span class="keyword">throws</span> IOException, ClientProtocolException </span>&#123;</span><br><span class="line">    Args.notNull(request, <span class="string">"HTTP request"</span>);</span><br><span class="line">    HttpExecutionAware execAware = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (request <span class="keyword">instanceof</span> HttpExecutionAware) &#123;</span><br><span class="line">        execAware = (HttpExecutionAware) request;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">final</span> HttpRequestWrapper wrapper = HttpRequestWrapper.wrap(request, target);</span><br><span class="line">        <span class="keyword">final</span> HttpClientContext localcontext = HttpClientContext.adapt(</span><br><span class="line">                context != <span class="keyword">null</span> ? context : <span class="keyword">new</span> BasicHttpContext());</span><br><span class="line">        RequestConfig config = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (request <span class="keyword">instanceof</span> Configurable) &#123;</span><br><span class="line">            config = ((Configurable) request).getConfig();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (config == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">final</span> HttpParams params = request.getParams();</span><br><span class="line">            <span class="keyword">if</span> (params <span class="keyword">instanceof</span> HttpParamsNames) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!((HttpParamsNames) params).getNames().isEmpty()) &#123;</span><br><span class="line">                    config = HttpClientParamConfig.getRequestConfig(params, <span class="keyword">this</span>.defaultConfig);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                config = HttpClientParamConfig.getRequestConfig(params, <span class="keyword">this</span>.defaultConfig);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (config != <span class="keyword">null</span>) &#123;</span><br><span class="line">            localcontext.setRequestConfig(config);</span><br><span class="line">        &#125;</span><br><span class="line">        setupContext(localcontext);</span><br><span class="line">        <span class="keyword">final</span> HttpRoute route = determineRoute(target, wrapper, localcontext);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.execChain.execute(route, wrapper, localcontext, execAware);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> HttpException httpException) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ClientProtocolException(httpException);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç ä¸­</p><ol><li><code>HttpExecutionAware</code>ç±»æ˜¯ç”¨äºæ¥æ”¶é˜»å¡I/Oæ“ä½œçš„é€šçŸ¥ã€‚</li><li><code>HttpRequestWrapper</code>ç±»æ˜¯<code>HttpRequest</code>æ¥å£çš„åŒ…è£…ç±»ã€‚</li><li><code>HttpClientContext</code>ç±»å®ç°<code>HttpContext</code>æ¥å£ï¼Œè¡¨ç¤ºHTTPè¿›ç¨‹çš„æ‰§è¡ŒçŠ¶æ€ã€‚</li><li><code>RequestConfig</code>è¯·æ±‚é…ç½®ç±»ï¼Œåˆå§‹åŒ–åèµ‹å€¼åˆ°äº†ä¸Šä¸‹æ–‡<code>HttpClientContext</code>ä¸­ã€‚</li><li><code>HttpRoute</code>ä¸ºè·¯ç”±ç±»ã€‚æƒ³æ›´æ·±äº†è§£å¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/zjysource/article/details/52945494" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ã€‚</li></ol><hr><p>æ¥ä¸‹æ¥ä¸»è¦é€»è¾‘åœ¨<code>MainClientExec</code>çš„<code>execute()</code>æ–¹æ³•ï¼Œæ¶‰åŠåˆ°æœ‰å…³httpsçš„authçš„å†…å®¹æš‚æ—¶ä¸åšåˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (request <span class="keyword">instanceof</span> HttpEntityEnclosingRequest) &#123;</span><br><span class="line">    RequestEntityProxy.enhance((HttpEntityEnclosingRequest) request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯<code>HttpEntityEnclosingRequest</code>ç±»å‹çš„requetï¼Œåˆ™ä½¿ç”¨Entityä»£ç†ç±»è¿›è¡ŒåŠ å¼ºï¼Œä¸»è¦ç”¨é€”æ˜¯å¯¹entityçš„å›æ”¶ç­‰æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object userToken = context.getUserToken();</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯<code>HttpClient</code>æ ‡è¯†ï¼Œé»˜è®¤ä¸ºnullï¼Œä¸ºäº†ä¿è¯ç”¨æˆ·ä½¿ç”¨é“¾æ¥çš„å”¯ä¸€æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ConnectionRequest connRequest = connManager.requestConnection(route, userToken);</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ä¸€ä¸ªç”±<code>connManager</code>ç®¡ç†å…¶ç”Ÿå‘½å‘¨æœŸçš„<code>ConnectionRequest</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (execAware != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (execAware.isAborted()) &#123;</span><br><span class="line">            connRequest.cancel();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RequestAbortedException(<span class="string">"Request aborted"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            execAware.setCancellable(connRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><code>execAware</code>ä¹Ÿå®é™…è¡¨ç¤ºä¸€ä¸ªå°è£…è¯·æ±‚ã€‚æŠŠå½“å‰é“¾æ¥èµ‹å€¼ç»™<code>execAware</code>æŒæœ‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> RequestConfig config = context.getRequestConfig();</span><br></pre></td></tr></table></figure><p>ä»<code>context</code>ä¸­å–å‡ºè¯·æ±‚é…ç½®ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> HttpClientConnection managedConn;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> timeout = config.getConnectionRequestTimeout();</span><br><span class="line">    managedConn = connRequest.get(timeout &gt; <span class="number">0</span> ? timeout : <span class="number">0</span>, TimeUnit.MILLISECONDS);</span><br><span class="line">&#125; <span class="keyword">catch</span>(<span class="keyword">final</span> InterruptedException interrupted) &#123;</span><br><span class="line">    Thread.currentThread().interrupt();</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RequestAbortedException(<span class="string">"Request aborted"</span>, interrupted);</span><br><span class="line">&#125; <span class="keyword">catch</span>(<span class="keyword">final</span> ExecutionException ex) &#123;</span><br><span class="line">    Throwable cause = ex.getCause();</span><br><span class="line">    <span class="keyword">if</span> (cause == <span class="keyword">null</span>) &#123;</span><br><span class="line">        cause = ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RequestAbortedException(<span class="string">"Request execution failed"</span>, cause);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>connRequest</code>å¾—åˆ°ä¸€ä¸ª<code>HttpClientConnection</code>ï¼Œ<code>HttpClientConnection</code> å¯ç”¨äºé€šè¿‡æŒ‡å®šè·¯ç”±è·¯å¾„è¿›è¡Œé€šä¿¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">context.setAttribute(HttpCoreContext.HTTP_CONNECTION, managedConn);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (config.isStaleConnectionCheckEnabled()) &#123;</span><br><span class="line">        <span class="comment">// validate connection</span></span><br><span class="line">        <span class="keyword">if</span> (managedConn.isOpen()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.log.debug(<span class="string">"Stale connection check"</span>);</span><br><span class="line">            <span class="keyword">if</span> (managedConn.isStale()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.log.debug(<span class="string">"Stale connection detected"</span>);</span><br><span class="line">                managedConn.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol><li>æŠŠ<code>managedConn</code>æ”¾å…¥<code>context</code>ä¸Šä¸‹æ–‡ä¸­</li><li>å¯¹å¤±æ•ˆé“¾æ¥è¿›è¡Œæ ¡éªŒ</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ConnectionHolder connHolder = <span class="keyword">new</span> ConnectionHolder(<span class="keyword">this</span>.log, <span class="keyword">this</span>.connManager, managedConn);</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªé“¾æ¥æŒæœ‰è€…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (execAware != <span class="keyword">null</span>) &#123;</span><br><span class="line">                execAware.setCancellable(connHolder);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>ä½¿<code>execAware</code>è¯·æ±‚<code>request</code>æ‹¥æœ‰é“¾æ¥æŒæœ‰è€…ï¼Œè¿™æ ·ç”¨æˆ·å¯ä»¥å¯¹<code>request</code>å¯ä»¥ç›´æ¥å¯¹æŒæœ‰è€…è¿›è¡Œæ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">HttpResponse response;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> execCount = <span class="number">1</span>;; execCount++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (execCount &gt; <span class="number">1</span> &amp;&amp; !RequestEntityProxy.isRepeatable(request)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NonRepeatableRequestException(<span class="string">"Cannot retry request "</span> +</span><br><span class="line">                        <span class="string">"with a non-repeatable request entity."</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (execAware != <span class="keyword">null</span> &amp;&amp; execAware.isAborted()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RequestAbortedException(<span class="string">"Request aborted"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!managedConn.isOpen()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.log.debug(<span class="string">"Opening connection "</span> + route);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    establishRoute(proxyAuthState, managedConn, route, request, context);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> TunnelRefusedException ex) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.log.isDebugEnabled()) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.log.debug(ex.getMessage());</span><br><span class="line">                    &#125;</span><br><span class="line">                    response = ex.getResponse();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> timeout = config.getSocketTimeout();</span><br><span class="line">            <span class="keyword">if</span> (timeout &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                managedConn.setSocketTimeout(timeout);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (execAware != <span class="keyword">null</span> &amp;&amp; execAware.isAborted()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RequestAbortedException(<span class="string">"Request aborted"</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.log.isDebugEnabled()) &#123;</span><br><span class="line">                <span class="keyword">this</span>.log.debug(<span class="string">"Executing request "</span> + request.getRequestLine());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ã€‚ã€‚ã€‚ çœç•¥authç›¸å…³</span></span><br><span class="line"></span><br><span class="line">            response = requestExecutor.execute(request, managedConn, context);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// The connection is in or can be brought to a re-usable state.</span></span><br><span class="line">            <span class="keyword">if</span> (reuseStrategy.keepAlive(response, context)) &#123;</span><br><span class="line">                <span class="comment">// Set the idle duration of this connection</span></span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">long</span> duration = keepAliveStrategy.getKeepAliveDuration(response, context);</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.log.isDebugEnabled()) &#123;</span><br><span class="line">                    <span class="keyword">final</span> String s;</span><br><span class="line">                    <span class="keyword">if</span> (duration &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                        s = <span class="string">"for "</span> + duration + <span class="string">" "</span> + TimeUnit.MILLISECONDS;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        s = <span class="string">"indefinitely"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">this</span>.log.debug(<span class="string">"Connection can be kept alive "</span> + s);</span><br><span class="line">                &#125;</span><br><span class="line">                connHolder.setValidFor(duration, TimeUnit.MILLISECONDS);</span><br><span class="line">                connHolder.markReusable();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                connHolder.markNonReusable();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ã€‚ã€‚ã€‚ çœç•¥authç›¸å…³ã€</span></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä»£ç å—æ”¾åœ¨ä¸€ä¸ªå¾ªç¯é‡Œè¾¹ï¼Œå¾ªç¯çš„æ­£å¸¸æµç¨‹çš„ç»ˆæ­¢æ¡ä»¶åœ¨<code>needAuthentication()</code>åˆ¤æ–­ä¸­ï¼Œæš‚ä¸åšåˆ†æã€‚æˆ‘ä»¬æ¥å¯¹ä»¥ä¸Šä»£ç è¿›è¡Œä¸€ä¸ªç®€è¦çš„åˆ†æï¼š</p><ol><li>åˆ¤æ–­åœ¨ç¬¬äºŒæ¬¡å¾ªç¯ä»¥åæ˜¯å¦å¯ä»¥é‡å¤è¯»ï¼Œå¦‚æœä¸å¯ä»¥é‡å¤è¯»ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚(ä¸å¯é‡å¤è¯»çš„æŒ‡çš„æ˜¯æµï¼Œåƒ<code>StringEntity</code> <code>FileEntity</code>è¿™æ ·çš„éƒ½æ˜¯å¯ä»¥é‡å¤è¯»çš„)</li><li>å¥½å‡ å¤„åœ°æ–¹éƒ½å¯¹<code>execAware</code>çœŸæ­£çš„<code>request</code>çš„æ˜¯å¦ç»ˆæ­¢<code>isAborted()</code>æ–¹æ³•åšæ ¡éªŒï¼Œå¦‚æœç»ˆæ­¢äº†ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å°±å¯ä»¥éšæ—¶å–æ¶ˆè¯·æ±‚äº†ã€‚</li><li>å¦‚æœé“¾æ¥ä¸æ˜¯opençŠ¶æ€çš„ï¼Œé‚£ä¹ˆä½¿ç”¨<code>route</code>è·¯ç”±å¯¹è±¡é‡æ–°å»ºç«‹ä¸€æ¬¡é“¾æ¥ã€‚</li><li>å¯¹é“¾æ¥è¿›è¡Œè¶…æ—¶è®¾ç½®ã€‚</li><li>ä½¿ç”¨è¯·æ±‚æ‰§è¡Œå™¨<code>requestExecutor</code>æ‰§è¡Œè¯·æ±‚å¾—åˆ°<code>response</code>å¯¹è±¡ã€‚</li><li>æ ¹æ®æ¶ˆæ¯å¤´åˆ¤æ–­é“¾æ¥æ˜¯å¦è¦ä¿æŒé•¿é“¾æ¥ï¼Œå¦‚æœæ˜¯ï¼Œæ ‡è®°<code>connHolder</code>ä¸ºå¯é‡ç”¨çš„ï¼Œå¦‚æœå¦ï¼Œåˆ™æ ‡è®°ä¸ºä¸å¯é‡ç”¨çš„ã€‚</li></ol><blockquote><p>æ³¨ï¼šåœ¨æ‰§è¡Œè¯·æ±‚çš„æ—¶å€™ï¼Œç”¨åˆ°çš„<code>request</code>æ˜¯<code>HttpRequestWrapper</code>åŒ…è£…ç±»ï¼Œä½¿ç”¨åŒ…è£…ç±»æ˜¯é˜²æ­¢çœŸæ­£çš„è¯·æ±‚æ“ä½œæ—¶å‘ç”Ÿæ”¹å˜ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (userToken == <span class="keyword">null</span>) &#123;</span><br><span class="line">            userToken = userTokenHandler.getUserToken(context);</span><br><span class="line">            context.setAttribute(HttpClientContext.USER_TOKEN, userToken);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userToken != <span class="keyword">null</span>) &#123;</span><br><span class="line">            connHolder.setState(userToken);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>æŠŠå½“å‰ç”¨æˆ·æ ‡è¯†ä¿å­˜ç»™é“¾æ¥æŒæœ‰è€…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// check for entity, release connection if possible</span></span><br><span class="line"><span class="keyword">final</span> HttpEntity entity = response.getEntity();</span><br><span class="line"><span class="keyword">if</span> (entity == <span class="keyword">null</span> || !entity.isStreaming()) &#123;</span><br><span class="line">    <span class="comment">// connection not needed and (assumed to be) in re-usable state</span></span><br><span class="line">    connHolder.releaseConnection();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HttpResponseProxy(response, <span class="keyword">null</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HttpResponseProxy(response, connHolder);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>ä»è¿”å›çš„<code>respnse</code>ä¸­å¾—åˆ°<code>HttpEntity</code>ï¼Œæ ¡éªŒå®ä½“å¦‚æœæ˜¯ç©ºæˆ–è€…ä¸æ˜¯ä¸€ä¸ªæµï¼Œåˆ™é‡Šæ”¾é“¾æ¥ã€‚</li><li>ä½¿ç”¨<code>HttpResponseProxy</code>ä»£ç†ç±»å¯¹responseè¿›è¡Œä»£ç†ï¼Œå¦‚æœè¯»å–å®Œäº†å“åº”ï¼Œé‚£ä¹ˆè¿™ä¸ªå“åº”å°±ä¼šå…³é—­ã€‚</li></ol><hr><p>è‡³æ­¤ï¼Œ<code>HttpClient</code>å¯¹è±¡çš„<code>execute()</code>æ–¹æ³•çš„ç®€è¦çš„æ‰§è¡Œæµç¨‹åŸºæœ¬ä¸Šå°±åˆ†æå®Œæ¯•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä¸Šä¸€éæ€»ç»“çš„&lt;code&gt;HttpClient&lt;/code&gt;å¯¹è±¡çš„æ„é€ è¿‡ç¨‹ï¼Œæœ¬ç¯‡ä¸»è¦æ€»ç»“&lt;code&gt;HttpClient&lt;/code&gt;å¯¹è±¡çš„&lt;code&gt;execute()&lt;/code&gt;æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬å…ˆçœ‹æ•´ä½“çš„æ—¶åºå›¾ï¼ˆçœç•¥éƒ¨åˆ†ç»†èŠ‚ï¼‰ï¼Œç„¶åä¸€æ­¥æ­¥åˆ†æã€‚å½“ä¸çŸ¥é“æµç¨‹çš„æ—¶å€™èµ°debugä¹Ÿæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç½‘ç»œ" scheme="http://peierlong.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="Http" scheme="http://peierlong.com/tags/Http/"/>
    
      <category term="HttpClient" scheme="http://peierlong.com/tags/HttpClient/"/>
    
  </entry>
  
  <entry>
    <title>HttpClient4.5.3æºç æµ…æ(HttpClientå¯¹è±¡æ„é€ è¿‡ç¨‹)</title>
    <link href="http://peierlong.com/2018/06/28/HttpClient4.5.3%E6%BA%90%E7%A0%81%E6%B5%85%E6%9E%90(HttpClient%E6%9E%84%E9%80%A0%E8%BF%87%E7%A8%8B)/"/>
    <id>http://peierlong.com/2018/06/28/HttpClient4.5.3æºç æµ…æ(HttpClientæ„é€ è¿‡ç¨‹)/</id>
    <published>2018-06-28T08:22:27.000Z</published>
    <updated>2019-03-13T02:32:01.036Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç”±äºç°æœ‰çš„å¯¹<code>HttpClient</code>çš„å·¥å…·ç±»å°è£…æœªå½¢æˆç»Ÿä¸€çš„é…ç½®ï¼Œé’ˆå¯¹çº¿ç¨‹æ± çš„é…ç½®ä¹Ÿä¸å…¨é¢ï¼Œå·¥å…·ç±»çš„å°è£…ä¹Ÿæ²¡åšåˆ°ä½¿ç”¨ç®€æ´åˆç†å›æ”¶ï¼Œæ­£å¥½é‡åˆ°<code>SpringMVC</code>å‘<code>SpringBoot</code>çš„è¿ç§»ï¼Œäºæ˜¯å¯¹<code>HttpClient</code>è¿›è¡Œä¸€æ¬¡é‡æ„ï¼Œå¯¹<code>HttpClient</code>è¿›è¡Œç‰ˆæœ¬å‡çº§ï¼Œå¹¶å°†ç›¸å…³é…ç½®åˆ†ç¦»å‡ºæ¥ç®¡ç†ã€‚ç”±äºå¯¹<code>HttpClient</code>å…·ä½“å®ç°é€»è¾‘ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæ‰€ä»¥æœ‰äº†è¿™æ¬¡çš„åˆ†æã€‚</p><a id="more"></a><h1 id="åˆ†æç›®æ ‡"><a href="#åˆ†æç›®æ ‡" class="headerlink" title="åˆ†æç›®æ ‡"></a>åˆ†æç›®æ ‡</h1><ul><li>å­¦ä¹ <code>HttpClient</code>çš„ä»£ç æ¶æ„ï¼Œäº†è§£å®ç°æ–¹å¼å’Œå…·ä½“çš„è°ƒç”¨æ–¹å¼ã€‚</li><li>å­¦ä¹ <code>HttpClient</code>å¯¹çº¿ç¨‹æ± çš„æ”¯æŒä»¥åŠ<code>IdleConnectionEvictor</code>ç±»å¯¹çº¿ç¨‹æ± ä¸­å¤±æ•ˆè¿æ¥çš„æ¸…é™¤ã€‚</li><li>å­¦ä¹ <code>HttpClientBuilder</code>ä¸­å¯¹<code>HttpClient</code>çš„æ„å»ºè¿‡ç¨‹ã€‚</li></ul><h1 id="æ•´ä½“ç»“æ„"><a href="#æ•´ä½“ç»“æ„" class="headerlink" title="æ•´ä½“ç»“æ„"></a>æ•´ä½“ç»“æ„</h1><h2 id="HttpClientæ¥å£å®ç°ç»“æ„"><a href="#HttpClientæ¥å£å®ç°ç»“æ„" class="headerlink" title="HttpClientæ¥å£å®ç°ç»“æ„"></a>HttpClientæ¥å£å®ç°ç»“æ„</h2><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/Xnip2018-06-179_16-24-12.jpg" alt="Xnip2018-06-179_16-24-12.jpg"></p><p><code>HttpClient</code>æ¥å£æ˜¯<code>HttpClient</code>çš„æ ¸å¿ƒæ¥å£ï¼Œæ•´ä¸ªå®ç°ä¹Ÿæ˜¯å›´ç»•ç€è¿™ä¸ªæ¥å£æ¥åšåŠ¨ä½œã€‚</p><p><code>HttpClient</code>æ¥å£æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼Œå…¶ä¸­<code>AutoRetryHttpClient</code>å’Œ<code>DecompressingHttpClient</code>åœ¨4.3ç‰ˆæœ¬æ ‡è®°ä¸ºè¿‡æœŸç±»ï¼Œæ•…ä¸åšåˆ†æï¼Œä¸»è¦æ¥çœ‹<code>CloseableHttpClient</code>ç±»ã€‚</p><p><code>CloseableHttpClient</code>ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæœ‰ä¸‰ä¸ªå­ç±»ï¼Œå…¶ä¸­<code>AbstractHttpClient</code>ä¸ºè¿‡æœŸç±»ï¼Œ<code>MinimalHttpClient</code>æ˜¯ç²¾ç®€å®ç°äº†ï¼Œ<code>InternalHttpClient</code>æ˜¯ä¸»è¦å®ç°ã€‚</p><h2 id="HttpClintçš„æ„é€ è¿‡ç¨‹"><a href="#HttpClintçš„æ„é€ è¿‡ç¨‹" class="headerlink" title="HttpClintçš„æ„é€ è¿‡ç¨‹"></a>HttpClintçš„æ„é€ è¿‡ç¨‹</h2><p>é¦–å…ˆè°ƒç”¨<code>HttpClients</code>ç±»çš„<code>createDefault()</code>ï¼Œæ ¹æ®æ³¨é‡Šå’Œè¿”å›éƒ½èƒ½çœ‹å‡ºé‡‡ç”¨çš„<code>CloseableHttpClient</code>ä¸ºé»˜è®¤å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates &#123;<span class="doctag">@link</span> CloseableHttpClient&#125; instance with default</span></span><br><span class="line"><span class="comment">     * configuration.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CloseableHttpClient <span class="title">createDefault</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> HttpClientBuilder.create().build();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡é€šè¿‡<code>HttpClientBuilder.create()</code>åˆ›å»º<code>HttpClientBuilder</code>å®ä¾‹ï¼Œå¹¶è°ƒç”¨<code>build()</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> CloseableHttpClient <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ... ç…§é¡¾ç‰ˆé¢ï¼Œçœç•¥ä¸­é—´å„ç§é…ç½®ä»£ç </span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InternalHttpClient(</span><br><span class="line">                execChain,</span><br><span class="line">                connManagerCopy,</span><br><span class="line">                routePlannerCopy,</span><br><span class="line">                cookieSpecRegistryCopy,</span><br><span class="line">                authSchemeRegistryCopy,</span><br><span class="line">                defaultCookieStore,</span><br><span class="line">                defaultCredentialsProvider,</span><br><span class="line">                defaultRequestConfig != <span class="keyword">null</span> ? defaultRequestConfig : RequestConfig.DEFAULT,</span><br><span class="line">                closeablesCopy);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿”å›çš„<code>CloseableHttpClient</code>å®ä¾‹ä½¿ç”¨<code>InternalHttpClient</code>ç±»å®ç°ã€‚</p><h2 id="HttpClientå¯¹çº¿ç¨‹æ± çš„æ”¯æŒæ–¹å¼"><a href="#HttpClientå¯¹çº¿ç¨‹æ± çš„æ”¯æŒæ–¹å¼" class="headerlink" title="HttpClientå¯¹çº¿ç¨‹æ± çš„æ”¯æŒæ–¹å¼"></a>HttpClientå¯¹çº¿ç¨‹æ± çš„æ”¯æŒæ–¹å¼</h2><p>HttpClientBuilder.java ç±»å…³äºçº¿ç¨‹æ± éƒ¨åˆ†æºä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClientBuilder</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Assigns &#123;<span class="doctag">@link</span> HttpClientConnectionManager&#125; instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> HttpClientBuilder <span class="title">setConnectionManager</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">final</span> HttpClientConnectionManager connManager)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.connManager = connManager;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> CloseableHttpClient <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        HttpClientConnectionManager connManagerCopy = <span class="keyword">this</span>.connManager;</span><br><span class="line">        <span class="keyword">if</span> (connManagerCopy == <span class="keyword">null</span>) &#123;</span><br><span class="line">            LayeredConnectionSocketFactory sslSocketFactoryCopy = <span class="keyword">this</span>.sslSocketFactory;</span><br><span class="line">            <span class="keyword">if</span> (sslSocketFactoryCopy == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> String[] supportedProtocols = systemProperties ? split(</span><br><span class="line">                        System.getProperty(<span class="string">"https.protocols"</span>)) : <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">final</span> String[] supportedCipherSuites = systemProperties ? split(</span><br><span class="line">                        System.getProperty(<span class="string">"https.cipherSuites"</span>)) : <span class="keyword">null</span>;</span><br><span class="line">                HostnameVerifier hostnameVerifierCopy = <span class="keyword">this</span>.hostnameVerifier;</span><br><span class="line">                <span class="keyword">if</span> (hostnameVerifierCopy == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    hostnameVerifierCopy = <span class="keyword">new</span> DefaultHostnameVerifier(publicSuffixMatcherCopy);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (sslContext != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    sslSocketFactoryCopy = <span class="keyword">new</span> SSLConnectionSocketFactory(</span><br><span class="line">                            sslContext, supportedProtocols, supportedCipherSuites, hostnameVerifierCopy);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (systemProperties) &#123;</span><br><span class="line">                        sslSocketFactoryCopy = <span class="keyword">new</span> SSLConnectionSocketFactory(</span><br><span class="line">                                (SSLSocketFactory) SSLSocketFactory.getDefault(),</span><br><span class="line">                                supportedProtocols, supportedCipherSuites, hostnameVerifierCopy);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        sslSocketFactoryCopy = <span class="keyword">new</span> SSLConnectionSocketFactory(</span><br><span class="line">                                SSLContexts.createDefault(),</span><br><span class="line">                                hostnameVerifierCopy);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"resource"</span>)</span><br><span class="line">            <span class="keyword">final</span> PoolingHttpClientConnectionManager poolingmgr = <span class="keyword">new</span> PoolingHttpClientConnectionManager(</span><br><span class="line">                    RegistryBuilder.&lt;ConnectionSocketFactory&gt;create()</span><br><span class="line">                        .register(<span class="string">"http"</span>, PlainConnectionSocketFactory.getSocketFactory())</span><br><span class="line">                        .register(<span class="string">"https"</span>, sslSocketFactoryCopy)</span><br><span class="line">                        .build(),</span><br><span class="line">                    <span class="keyword">null</span>,</span><br><span class="line">                    <span class="keyword">null</span>,</span><br><span class="line">                    dnsResolver,</span><br><span class="line">                    connTimeToLive,</span><br><span class="line">                    connTimeToLiveTimeUnit != <span class="keyword">null</span> ? connTimeToLiveTimeUnit : TimeUnit.MILLISECONDS);</span><br><span class="line">            <span class="keyword">if</span> (defaultSocketConfig != <span class="keyword">null</span>) &#123;</span><br><span class="line">                poolingmgr.setDefaultSocketConfig(defaultSocketConfig);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (defaultConnectionConfig != <span class="keyword">null</span>) &#123;</span><br><span class="line">                poolingmgr.setDefaultConnectionConfig(defaultConnectionConfig);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (systemProperties) &#123;</span><br><span class="line">                String s = System.getProperty(<span class="string">"http.keepAlive"</span>, <span class="string">"true"</span>);</span><br><span class="line">                <span class="keyword">if</span> (<span class="string">"true"</span>.equalsIgnoreCase(s)) &#123;</span><br><span class="line">                    s = System.getProperty(<span class="string">"http.maxConnections"</span>, <span class="string">"5"</span>);</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> max = Integer.parseInt(s);</span><br><span class="line">                    poolingmgr.setDefaultMaxPerRoute(max);</span><br><span class="line">                    poolingmgr.setMaxTotal(<span class="number">2</span> * max);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (maxConnTotal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                poolingmgr.setMaxTotal(maxConnTotal);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (maxConnPerRoute &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                poolingmgr.setDefaultMaxPerRoute(maxConnPerRoute);</span><br><span class="line">            &#125;</span><br><span class="line">            connManagerCopy = poolingmgr;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>HttpClientBuilder</code>æä¾›<code>setConnectionManager()</code>æ–¹æ³•æ¥ä¼ å…¥ä¸€ä¸ª<code>HttpClientConnectionManager</code>ç±»å‹ï¼Œè€Œ<code>HttpClientBuilder</code>å¯ä»¥é€šè¿‡<code>HttpClients.custom()</code>æ–¹æ³•è·å¾—ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸ä¼ å…¥è‡ªå®šä¹‰çš„<code>HttpClientConnectionManager</code>ï¼Œåœ¨æ‰§è¡Œ<code>build()</code>æ–¹æ³•æ—¶ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤çš„çº¿ç¨‹æ± ï¼Œä»£ç å‚è€ƒ<code>HttpClientBuilder</code>çš„<code>build()</code>æ–¹æ³•ã€‚</p><h2 id="HttpClientå¯¹çº¿ç¨‹æ± å¤±æ•ˆé“¾æ¥çš„çš„å¤„ç†"><a href="#HttpClientå¯¹çº¿ç¨‹æ± å¤±æ•ˆé“¾æ¥çš„çš„å¤„ç†" class="headerlink" title="HttpClientå¯¹çº¿ç¨‹æ± å¤±æ•ˆé“¾æ¥çš„çš„å¤„ç†"></a>HttpClientå¯¹çº¿ç¨‹æ± å¤±æ•ˆé“¾æ¥çš„çš„å¤„ç†</h2><p>åœ¨4.4ç‰ˆæœ¬ï¼Œæä¾›äº†<code>IdleConnectionEvictor</code>ç±»è¿›è¡Œå¯¹å¤±æ•ˆçº¿ç¨‹å’Œè¶…æ—¶é—²ç½®çº¿ç¨‹çš„å¤„ç†ã€‚ä¸»è¦å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.thread = <span class="keyword">this</span>.threadFactory.newThread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                        Thread.sleep(sleepTimeMs);</span><br><span class="line">                        connectionManager.closeExpiredConnections();</span><br><span class="line">                        <span class="keyword">if</span> (maxIdleTimeMs &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                            connectionManager.closeIdleConnections(maxIdleTimeMs, TimeUnit.MILLISECONDS);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception ex) &#123;</span><br><span class="line">                    exception = ex;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><p>ç®€å•æ¥è®²ï¼Œå®ç°åŸç†æ˜¯èµ·ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¿ƒè·³æ£€æµ‹ï¼Œè°ƒç”¨<code>connectionManager.closeExpiredConnections()</code>æ–¹æ³•æ¥è¿›è¡Œå¤±æ•ˆå›æ”¶ï¼Œåœ¨<code>HttpClientBuilder</code>ä¸­æœ‰ä¸¤ä¸ªå‚æ•°æ¥æ§åˆ¶æ˜¯å¦å¯ç”¨å¤±æ•ˆå›æ”¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> evictExpiredConnections;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">boolean</span> evictIdleConnections;</span><br></pre></td></tr></table></figure><p>åœ¨<code>build()</code>æ–¹æ³•ä¸­è°ƒç”¨å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (evictExpiredConnections || evictIdleConnections) &#123;</span><br><span class="line">            <span class="keyword">final</span> IdleConnectionEvictor connectionEvictor = <span class="keyword">new</span> IdleConnectionEvictor(cm,</span><br><span class="line">                    maxIdleTime &gt; <span class="number">0</span> ? maxIdleTime : <span class="number">10</span>, maxIdleTimeUnit != <span class="keyword">null</span> ? maxIdleTimeUnit : TimeUnit.SECONDS);</span><br><span class="line">            closeablesCopy.add(<span class="keyword">new</span> Closeable() &#123;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                    connectionEvictor.shutdown();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;);</span><br><span class="line">            connectionEvictor.start();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h1 id="remark"><a href="#remark" class="headerlink" title="remark"></a>remark</h1><p>è‡³æ­¤ï¼Œå¯¹<code>HttpClient</code>çš„æ„é€ è¿‡ç¨‹æœ‰æ‰€äº†è§£ï¼Œä¸‹ä¸€ç¯‡ä¸»è¦å­¦ä¹ ä¸€ä¸‹HttpClientçš„execute()æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ç”±äºç°æœ‰çš„å¯¹&lt;code&gt;HttpClient&lt;/code&gt;çš„å·¥å…·ç±»å°è£…æœªå½¢æˆç»Ÿä¸€çš„é…ç½®ï¼Œé’ˆå¯¹çº¿ç¨‹æ± çš„é…ç½®ä¹Ÿä¸å…¨é¢ï¼Œå·¥å…·ç±»çš„å°è£…ä¹Ÿæ²¡åšåˆ°ä½¿ç”¨ç®€æ´åˆç†å›æ”¶ï¼Œæ­£å¥½é‡åˆ°&lt;code&gt;SpringMVC&lt;/code&gt;å‘&lt;code&gt;SpringBoot&lt;/code&gt;çš„è¿ç§»ï¼Œäºæ˜¯å¯¹&lt;code&gt;HttpClient&lt;/code&gt;è¿›è¡Œä¸€æ¬¡é‡æ„ï¼Œå¯¹&lt;code&gt;HttpClient&lt;/code&gt;è¿›è¡Œç‰ˆæœ¬å‡çº§ï¼Œå¹¶å°†ç›¸å…³é…ç½®åˆ†ç¦»å‡ºæ¥ç®¡ç†ã€‚ç”±äºå¯¹&lt;code&gt;HttpClient&lt;/code&gt;å…·ä½“å®ç°é€»è¾‘ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæ‰€ä»¥æœ‰äº†è¿™æ¬¡çš„åˆ†æã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="ç½‘ç»œ" scheme="http://peierlong.com/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
      <category term="Http" scheme="http://peierlong.com/tags/Http/"/>
    
      <category term="HttpClient" scheme="http://peierlong.com/tags/HttpClient/"/>
    
  </entry>
  
  <entry>
    <title>Spring Bootè¯»å–é…ç½®æ–‡ä»¶æ–¹æ³•</title>
    <link href="http://peierlong.com/2018/06/21/Spring-Boot%E8%AF%BB%E5%8F%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%96%B9%E6%B3%95/"/>
    <id>http://peierlong.com/2018/06/21/Spring-Bootè¯»å–é…ç½®æ–‡ä»¶æ–¹æ³•/</id>
    <published>2018-06-21T06:32:50.000Z</published>
    <updated>2019-03-13T02:32:01.040Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-ä½¿ç”¨-Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹"><a href="#1-ä½¿ç”¨-Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹" class="headerlink" title="1. ä½¿ç”¨@Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹"></a>1. ä½¿ç”¨@Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹</h2><p>åœ¨ <code>application.properties</code> ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test=123</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç±»ä¸­å¯ä»¥ä½¿ç”¨@Valueæ³¨è§£å–å€¼</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Value(&quot;$&#123;test&#125;&quot;)</span><br><span class="line">private String test;</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="2-ä½¿ç”¨Environmentæ–¹å¼å–å€¼"><a href="#2-ä½¿ç”¨Environmentæ–¹å¼å–å€¼" class="headerlink" title="2. ä½¿ç”¨Environmentæ–¹å¼å–å€¼"></a>2. ä½¿ç”¨Environmentæ–¹å¼å–å€¼</h2><p>åŒæ ·ï¼Œä»¥è¯»å–æ–¹å¼ä¸€ä¸­çš„é…ç½®æ–‡ä»¶å†…å®¹ä¸ºä¾‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private Environment env;</span><br><span class="line"></span><br><span class="line">@RequestMapping(&quot;/test&quot;)</span><br><span class="line">public String test()&#123;</span><br><span class="line">    return env.getProperty(&quot;test&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ˜ å°„"><a href="#3-è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ˜ å°„" class="headerlink" title="3. è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ˜ å°„"></a>3. è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ˜ å°„</h2><p>åœ¨<code>application.properties</code>æ–‡ä»¶åŠ å…¥å†…å®¹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">test.name=zhangsan</span><br><span class="line">test.age=1</span><br></pre></td></tr></table></figure><p>æ–°å»ºå®ä½“ <code>Test.java</code>,å†…å®¹å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"test"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å¯ä»¥ä½¿ç”¨ <code>@PropertySource(&quot;classpath:my2.properties&quot;)</code> æŒ‡å®šè¯»å–çš„é…ç½®æ–‡ä»¶</p></blockquote><p>endï¼</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;1-ä½¿ç”¨-Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹&quot;&gt;&lt;a href=&quot;#1-ä½¿ç”¨-Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹&quot; class=&quot;headerlink&quot; title=&quot;1. ä½¿ç”¨@Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹&quot;&gt;&lt;/a&gt;1. ä½¿ç”¨@Valueæ–¹å¼è¯»å–ï¼Œç¤ºä¾‹å¦‚ä¸‹&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;code&gt;application.properties&lt;/code&gt; ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;test=123&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;ç„¶ååœ¨ç±»ä¸­å¯ä»¥ä½¿ç”¨@Valueæ³¨è§£å–å€¼&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@Value(&amp;quot;$&amp;#123;test&amp;#125;&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;private String test;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="Spring" scheme="http://peierlong.com/tags/Spring/"/>
    
      <category term="Spring Boot" scheme="http://peierlong.com/tags/Spring-Boot/"/>
    
  </entry>
  
  <entry>
    <title>å¾®ä¿¡æ”¯ä»˜ç”Ÿæˆ10ä½ä¸€å¤©å†…ä¸èƒ½é‡å¤çš„æ•°å­—å·¥å…·ç±»</title>
    <link href="http://peierlong.com/2018/05/15/%E5%BE%AE%E4%BF%A1%E6%94%AF%E4%BB%98%E7%94%9F%E6%88%9010%E4%BD%8D%E4%B8%80%E5%A4%A9%E5%86%85%E4%B8%8D%E8%83%BD%E9%87%8D%E5%A4%8D%E7%9A%84%E6%95%B0%E5%AD%97%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
    <id>http://peierlong.com/2018/05/15/å¾®ä¿¡æ”¯ä»˜ç”Ÿæˆ10ä½ä¸€å¤©å†…ä¸èƒ½é‡å¤çš„æ•°å­—å·¥å…·ç±»/</id>
    <published>2018-05-15T08:00:15.000Z</published>
    <updated>2019-03-13T03:20:13.531Z</updated>
    
    <content type="html"><![CDATA[<p><br>åœ¨å¼€å‘å¾®ä¿¡æ”¯ä»˜ç°é‡‘çº¢åŒ…åŠŸèƒ½æ—¶é‡åˆ°ç”Ÿæˆå•†æˆ·å·çš„éœ€è¦ç”Ÿæˆ10ä½ä¸€å¤©å†…ä¸èƒ½é‡å¤çš„æ•°å­—ï¼Œå¦‚æœç”¨å•çº¯çš„éšæœºæ•°ï¼Œæœ‰å¯èƒ½éšæœºæ•°ç¢°æ’ï¼Œäº§ç”Ÿç›¸åŒå•†æˆ·å·çš„é—®é¢˜ï¼Œæ‰€ä»¥è‡ªå·±å†™äº†ä¸ªå·¥å…·ç±»ã€‚</p><a id="more"></a><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String todayIndex = DateUtil.getSDFFDate();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å•†æˆ·è®¢å•å·ï¼ˆæ¯ä¸ªè®¢å•å·å¿…é¡»å”¯ä¸€ï¼‰</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * ç»„æˆï¼šmch_id+yyyymmdd+10ä½ä¸€å¤©å†…ä¸èƒ½é‡å¤çš„æ•°å­—</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> String <span class="title">generateRedPackMchBillno</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!todayIndex.equals(DateUtil.getSDFFDate())) &#123;</span><br><span class="line">        list.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    String mchBillno = MAC_ID + DateUtil.getSDFFDate() + getRandomNumber();</span><br><span class="line">    <span class="keyword">if</span> (list.contains(mchBillno)) &#123;</span><br><span class="line">        <span class="keyword">return</span> generateRedPackMchBillno();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        list.add(mchBillno);</span><br><span class="line">        todayIndex = DateUtil.getSDFFDate();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mchBillno;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ç”±äºä»£ç å­˜åœ¨å¤šä¸ªç«Ÿæ€æ¡ä»¶ï¼Œå¦‚æœä¸é‡‡å–åŒæ­¥ï¼Œåœ¨å¤šçº¿ç¨‹æ¡ä»¶ä¸‹ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ‰€ä»¥æ–¹æ³•è¦åŒæ­¥ã€‚</p><p>DateUtiléƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">static</span> SimpleDateFormat sdff = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyyMMdd"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getSDFFDate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sdff.format(<span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¼ºé™·æ€è€ƒ"><a href="#ç¼ºé™·æ€è€ƒ" class="headerlink" title="ç¼ºé™·æ€è€ƒ"></a>ç¼ºé™·æ€è€ƒ</h2><p>ç¼“å­˜çš„å·²ç»ç”Ÿæˆè¿‡çš„å•†æˆ·å·åœ¨ JVM é‡å¯çš„æ—¶å€™ä¼šé‡ç½®ï¼Œä¼šå¯¼è‡´é‡å¤ç”Ÿæˆï¼Œæ‰€ä»¥éœ€è¦æŠŠå·²ç»ç”Ÿæˆè¿‡çš„å•†æˆ·è¿›è¡ŒæŒä¹…åŒ–ç¼“å­˜ï¼Œå¯ä»¥å€ŸåŠ©å¼€å¯æŒä¹…åŒ–çš„ Redis æ¥è¿›è¡Œç¼“å­˜ã€‚</p><p>The endï¼</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;br&gt;åœ¨å¼€å‘å¾®ä¿¡æ”¯ä»˜ç°é‡‘çº¢åŒ…åŠŸèƒ½æ—¶é‡åˆ°ç”Ÿæˆå•†æˆ·å·çš„éœ€è¦ç”Ÿæˆ10ä½ä¸€å¤©å†…ä¸èƒ½é‡å¤çš„æ•°å­—ï¼Œå¦‚æœç”¨å•çº¯çš„éšæœºæ•°ï¼Œæœ‰å¯èƒ½éšæœºæ•°ç¢°æ’ï¼Œäº§ç”Ÿç›¸åŒå•†æˆ·å·çš„é—®é¢˜ï¼Œæ‰€ä»¥è‡ªå·±å†™äº†ä¸ªå·¥å…·ç±»ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="WXPay" scheme="http://peierlong.com/tags/WXPay/"/>
    
  </entry>
  
  <entry>
    <title>Java ClassLodaer çŸ¥è¯†æ€»ç»“</title>
    <link href="http://peierlong.com/2018/03/28/Java-ClassLodaer-%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
    <id>http://peierlong.com/2018/03/28/Java-ClassLodaer-çŸ¥è¯†æ€»ç»“/</id>
    <published>2018-03-28T08:46:05.000Z</published>
    <updated>2019-03-13T02:32:01.037Z</updated>
    
    <content type="html"><![CDATA[<p>è½¬è½½è‡ª<a href="http://ifeve.com/" target="_blank" rel="noopener">å¹¶å‘ç¼–ç¨‹ç½‘ â€“ ifeve.com</a>æœ¬æ–‡é“¾æ¥åœ°å€: <a href="http://ifeve.com/classloader/" target="_blank" rel="noopener">æ·±å…¥æµ…å‡ºClassLoader</a></p><h1 id="ç±»ä¸ç±»åŠ è½½å™¨"><a href="#ç±»ä¸ç±»åŠ è½½å™¨" class="headerlink" title="ç±»ä¸ç±»åŠ è½½å™¨"></a>ç±»ä¸ç±»åŠ è½½å™¨</h1><h1 id="åŒäº²å§”æ´¾æ¨¡å‹"><a href="#åŒäº²å§”æ´¾æ¨¡å‹" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å‹"></a>åŒäº²å§”æ´¾æ¨¡å‹</h1><h1 id="è¿ååŒäº²å§”æ´¾åŸåˆ™çš„ä¾‹å­"><a href="#è¿ååŒäº²å§”æ´¾åŸåˆ™çš„ä¾‹å­" class="headerlink" title="è¿ååŒäº²å§”æ´¾åŸåˆ™çš„ä¾‹å­"></a>è¿ååŒäº²å§”æ´¾åŸåˆ™çš„ä¾‹å­</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è½¬è½½è‡ª&lt;a href=&quot;http://ifeve.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;å¹¶å‘ç¼–ç¨‹ç½‘ â€“ ifeve.com&lt;/a&gt;æœ¬æ–‡é“¾æ¥åœ°å€: &lt;a href=&quot;http://ifeve.com/classloader/&quot; target
      
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="JVM" scheme="http://peierlong.com/tags/JVM/"/>
    
      <category term="ClassLoader" scheme="http://peierlong.com/tags/ClassLoader/"/>
    
  </entry>
  
  <entry>
    <title>Javaå­—èŠ‚ç æŒ‡ä»¤çš„åˆ†ç±»</title>
    <link href="http://peierlong.com/2018/03/28/Java%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E7%9A%84%E5%88%86%E7%B1%BB/"/>
    <id>http://peierlong.com/2018/03/28/Javaå­—èŠ‚ç æŒ‡ä»¤çš„åˆ†ç±»/</id>
    <published>2018-03-28T07:36:30.000Z</published>
    <updated>2019-03-13T02:32:01.037Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å…·æœ‰é˜…è¯»å­—èŠ‚ç æŒ‡ä»¤çš„èƒ½åŠ›å¯¹äºç†è§£Javaè¯­ä¹‰æœ‰ç€é‡è¦çš„æ„ä¹‰</strong></p><a id="more"></a><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/Xnip2018-03-87_15-35-04.jpg" alt="Xnip2018-03-87_15-35-04.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;å…·æœ‰é˜…è¯»å­—èŠ‚ç æŒ‡ä»¤çš„èƒ½åŠ›å¯¹äºç†è§£Javaè¯­ä¹‰æœ‰ç€é‡è¦çš„æ„ä¹‰&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="JVM" scheme="http://peierlong.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>é˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ Pythonè„šæœ¬(è‡ªåŠ¨å¤åˆ¶MarkDownè¯­æ³•çš„å›¾ç‰‡è‡³ç²˜è´´æ¿)</title>
    <link href="http://peierlong.com/2018/03/13/%E9%98%BF%E9%87%8C%E4%BA%91%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0Python%E8%84%9A%E6%9C%AC-%E8%87%AA%E5%8A%A8%E5%A4%8D%E5%88%B6MarkDown%E8%AF%AD%E6%B3%95%E7%9A%84%E5%9B%BE%E7%89%87%E8%87%B3%E7%B2%98%E8%B4%B4%E6%9D%BF/"/>
    <id>http://peierlong.com/2018/03/13/é˜¿é‡Œäº‘æ–‡ä»¶ä¸Šä¼ Pythonè„šæœ¬-è‡ªåŠ¨å¤åˆ¶MarkDownè¯­æ³•çš„å›¾ç‰‡è‡³ç²˜è´´æ¿/</id>
    <published>2018-03-13T05:07:40.000Z</published>
    <updated>2019-03-13T02:32:01.044Z</updated>
    
    <content type="html"><![CDATA[<h1 id="oss2mk"><a href="#oss2mk" class="headerlink" title="oss2mk"></a>oss2mk</h1><p>ç”±äº<code>MWeb</code>ä¸æ”¯æŒé˜¿é‡Œäº‘å›¾åºŠï¼Œæœ¬è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ—¶æŠŠå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘osså¹¶æŠŠå›¾ç‰‡çš„markdownè¯­æ³•å¤åˆ¶åˆ°ç²˜è´´æ¿ã€‚</p><blockquote><p>GitHubåœ°å€: <a href="https://github.com/peierlong/oss2mk" target="_blank" rel="noopener">https://github.com/peierlong/oss2mk</a></p></blockquote><a id="more"></a><h2 id="è¿è¡Œç¯å¢ƒ"><a href="#è¿è¡Œç¯å¢ƒ" class="headerlink" title="è¿è¡Œç¯å¢ƒ"></a>è¿è¡Œç¯å¢ƒ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ç³»ç»Ÿ          : macOS 10.13</span><br><span class="line">Pythonç‰ˆæœ¬    : 3.6.1</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h2><p>æ‰§è¡Œå‘½ä»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">oss_2_mk.py [-absolute_path]</span><br></pre></td></tr></table></figure><p>ä¾‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ‰§è¡Œ:</span><br><span class="line">oss_2_mk.py /Users/elong/Desktop/war/gc_collector.jpg</span><br><span class="line">è¾“å‡º:</span><br><span class="line">obj_name : gc_collector.jpg</span><br><span class="line">start upload to oss ....</span><br><span class="line">end upload to oss</span><br><span class="line">please CMD + v to paste markdown img grammar</span><br></pre></td></tr></table></figure><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> oss2</span><br><span class="line"></span><br><span class="line">PREFIX = <span class="string">'http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">uploadToOSS</span><span class="params">(name, path)</span>:</span></span><br><span class="line">    accessKeyId = <span class="string">"YOUR ALIYUN ACCESSKEYID"</span></span><br><span class="line">    accessKeySecret = <span class="string">"YOUR ALIYUN ACCESSKEYSECRET"</span></span><br><span class="line">    <span class="comment"># endpoint = "oss-cn-qingdao-internal.aliyuncs.com"</span></span><br><span class="line">    endpoint = <span class="string">"oss-cn-hongkong.aliyuncs.com"</span></span><br><span class="line">    bucket = <span class="string">"peierlong-blog"</span></span><br><span class="line">    auth = oss2.Auth(accessKeyId, accessKeySecret)</span><br><span class="line">    service = oss2.Service(auth, endpoint)</span><br><span class="line">    bucketObj = oss2.Bucket(auth, endpoint, bucket)</span><br><span class="line">    bucketObj.put_object_from_file(name, path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getClipboardData</span><span class="params">()</span>:</span></span><br><span class="line">    p = subprocess.Popen([<span class="string">'pbpaste'</span>], stdout=subprocess.PIPE)</span><br><span class="line">    retcode = p.wait()</span><br><span class="line">    data = p.stdout.read()</span><br><span class="line">    <span class="comment"># è¿™é‡Œçš„dataä¸ºbytesç±»å‹ï¼Œä¹‹åéœ€è¦è½¬æˆutf-8æ“ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setClipboardData</span><span class="params">(data)</span>:</span></span><br><span class="line">    p = subprocess.Popen([<span class="string">'pbcopy'</span>], stdin=subprocess.PIPE)</span><br><span class="line">    p.stdin.write(data)</span><br><span class="line">    p.stdin.close()</span><br><span class="line">    p.communicate()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">"args error, ploease input the file path. "</span>)</span><br><span class="line"></span><br><span class="line">    path = sys.argv[<span class="number">1</span>]</span><br><span class="line">    obj_name = path[path.rfind(<span class="string">"/"</span>) + <span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'obj_name : '</span> + obj_name)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'start upload to oss ....'</span>)</span><br><span class="line">    uploadToOSS(obj_name, path)</span><br><span class="line">    print(<span class="string">'end upload to oss'</span>)</span><br><span class="line"></span><br><span class="line">    mk_img = <span class="string">'![%s](%s)'</span> % (obj_name, PREFIX + obj_name)</span><br><span class="line">    setClipboardData(bytes(mk_img, <span class="string">'utf8'</span>))</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'please CMD + v to paste markdown img grammar'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>The end!</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;oss2mk&quot;&gt;&lt;a href=&quot;#oss2mk&quot; class=&quot;headerlink&quot; title=&quot;oss2mk&quot;&gt;&lt;/a&gt;oss2mk&lt;/h1&gt;&lt;p&gt;ç”±äº&lt;code&gt;MWeb&lt;/code&gt;ä¸æ”¯æŒé˜¿é‡Œäº‘å›¾åºŠï¼Œæœ¬è„šæœ¬çš„ä¸»è¦åŠŸèƒ½æ—¶æŠŠå›¾ç‰‡ä¸Šä¼ åˆ°é˜¿é‡Œäº‘osså¹¶æŠŠå›¾ç‰‡çš„markdownè¯­æ³•å¤åˆ¶åˆ°ç²˜è´´æ¿ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GitHubåœ°å€: &lt;a href=&quot;https://github.com/peierlong/oss2mk&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/peierlong/oss2mk&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Python" scheme="http://peierlong.com/categories/Python/"/>
    
    
      <category term="Python" scheme="http://peierlong.com/tags/Python/"/>
    
      <category term="aliyun" scheme="http://peierlong.com/tags/aliyun/"/>
    
  </entry>
  
  <entry>
    <title>JVMåƒåœ¾æ”¶é›†å™¨çŸ¥è¯†æ€»ç»“</title>
    <link href="http://peierlong.com/2018/03/09/JVM%E5%9E%83%E5%9C%BE%E6%94%B6%E9%9B%86%E5%99%A8%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/"/>
    <id>http://peierlong.com/2018/03/09/JVMåƒåœ¾æ”¶é›†å™¨çŸ¥è¯†æ€»ç»“/</id>
    <published>2018-03-09T10:16:25.000Z</published>
    <updated>2019-03-13T02:32:01.036Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡å¤§éƒ¨åˆ†çš„çŸ¥è¯†æ¥è‡ªäºå‘¨å¿—æ˜å¤§ç¥çš„<a href="https://book.douban.com/subject/24722612/" target="_blank" rel="noopener">ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬2ç‰ˆï¼‰ã€‹</a>ä¸€ä¹¦ï¼Œç³»ç»Ÿå­¦ä¹ JVMç›¸å…³çŸ¥è¯†çš„å¼ºçƒˆæ¨èã€‚ </p></blockquote><h1 id="ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•"></a>ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•</h1><p>æœ‰å…³åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæœ‰ä¸€ä¸ªå›½å¤–çš„å¤§ç¥ç”¨JSç”Ÿæˆçš„åŠ¨å›¾ç›´è§‚çš„å±•ç¤ºäº†åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ï¼Œæœ‰åŠ©äºå¯¹åƒåœ¾æ”¶é›†ç®—æ³•çš„ç†è§£ï¼Œè¿™æ˜¯æ–‡ç« <a href="https://spin.atomicobject.com/2014/09/03/visualizing-garbage-collection-algorithms/" target="_blank" rel="noopener">è¿æ¥</a>ã€‚</p><h2 id="æ— åƒåœ¾å›æ”¶-NO-GC"><a href="#æ— åƒåœ¾å›æ”¶-NO-GC" class="headerlink" title="æ— åƒåœ¾å›æ”¶(NO-GC)"></a>æ— åƒåœ¾å›æ”¶(NO-GC)</h2><p>åœ¨ç¨‹åºè¿è¡Œç»“æŸåï¼Œä¸€æ¬¡æ€§çš„å¯¹å†…å­˜è¿›è¡Œå›æ”¶ï¼Œæ˜¯æœ€ç®€å•çš„å›æ”¶æœºåˆ¶ã€‚å…¶å¹¶å‘æ€§èƒ½æœ€é«˜ï¼Œå¦‚æœèƒ½æŠŠä»»åŠ¡çš„é¢—ç²’åº¦å˜å¾—æ›´ç»†ï¼Œå¯ä»¥æœ‰æ•ˆçš„æ¸…ç†åƒåœ¾ã€‚æœ€å¤§çš„ç¼ºç‚¹æ˜¯å¯¹é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºæˆ–è€…å ç”¨å†…å­˜å¤§çš„ç¨‹åºæ¥è¯´ï¼Œéå¸¸å®¹æ˜“å†…å­˜æº¢å‡ºã€‚</p><a id="more"></a><h2 id="å¼•ç”¨è®¡æ•°ç®—æ³•-Reference-Counting"><a href="#å¼•ç”¨è®¡æ•°ç®—æ³•-Reference-Counting" class="headerlink" title="å¼•ç”¨è®¡æ•°ç®—æ³•(Reference Counting)"></a>å¼•ç”¨è®¡æ•°ç®—æ³•(Reference Counting)</h2><p>æ¯ä¸ªå¯¹è±¡éƒ½æŒæœ‰ä¸€ä¸ªå¼•ç”¨çš„è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨å°±åŠ ä¸€ï¼Œå½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å°±å‡ä¸€ï¼Œå½“è®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œè¯´æ˜å¯¹è±¡æ˜¯å¯è¢«å›æ”¶çš„ã€‚å¼•ç”¨è®¡æ•°å™¨æœ€å¤§çš„ç¼ºé™·æ—¶å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚è€Œä¸”åœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œå¼•ç”¨è®¡æ•°å™¨å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p><h2 id="æ ‡è®°æ¸…é™¤ç®—æ³•-Mark-Sweep"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•-Mark-Sweep" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•(Mark Sweep)"></a>æ ‡è®°æ¸…é™¤ç®—æ³•(Mark Sweep)</h2><p>é¡¾åæ€ä¹‰ï¼Œæ ‡è®°æ¸…é™¤ç®—æ³•åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œã€æ ‡è®°ã€å’Œã€æ¸…é™¤ã€ã€‚ç›¸å¯¹äºå¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œè§£å†³äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œå¹¶ä¸”å¼€é”€è¦å°ï¼Œå› ä¸ºä¸éœ€è¦ç»´æŠ¤è®¡æ•°å™¨äº†ã€‚</p><p>æ ‡è®°æ¸…é™¤ç®—æ³•ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œä»è€Œå¯¼è‡´å¤§å¯¹è±¡æ— æ³•è·å–åˆ°è¿ç»­çš„å†…å­˜ç©ºé—´ã€‚å¹¶ä¸”ï¼Œä¸¤ä¸ªé˜¶æ®µçš„æ‰§è¡Œæ•ˆç‡éƒ½ä¸é«˜ã€‚</p><h2 id="æ ‡è®°æ•´ç†ç®—æ³•-Mark-Compact"><a href="#æ ‡è®°æ•´ç†ç®—æ³•-Mark-Compact" class="headerlink" title="æ ‡è®°æ•´ç†ç®—æ³•(Mark Compact)"></a>æ ‡è®°æ•´ç†ç®—æ³•(Mark Compact)</h2><p>æ ‡è®°æ•´ç†ç®—æ³•æ˜¯åœ¨æ ‡è®°æ¸…é™¤ç®—æ³•çš„åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›çš„ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹å’Œæ ‡è®°æ¸…é™¤ç®—æ³•ä¸€ä¸‹ï¼Œæ ‡è®°åï¼Œä¼šæŠŠæ‰€æœ‰å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…é™¤å…¶ä½™å†…å­˜ã€‚</p><h2 id="å¤åˆ¶ç®—æ³•-Copying"><a href="#å¤åˆ¶ç®—æ³•-Copying" class="headerlink" title="å¤åˆ¶ç®—æ³•(Copying)"></a>å¤åˆ¶ç®—æ³•(Copying)</h2><p>å¤åˆ¶ç®—æ³•åœ¨é’ˆå¯¹å¯¹è±¡å­˜æ´»ç‡è¾ƒä½çš„åœºæ™¯ä¸‹æœ‰è¾ƒé«˜çš„æ•ˆç‡ï¼Œå¤åˆ¶ç®—æ³•ä¼šé™ä½ç©ºé—´æˆæœ¬ã€‚åœ¨Javaè™šæ‹Ÿæœºå †å†…å­˜æ–°ç”Ÿä»£éå¸¸é€‚åˆä½¿ç”¨è¿™ç§ç®—æ³•ã€‚</p><h1 id="Javaåƒåœ¾æ”¶é›†å™¨"><a href="#Javaåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="Javaåƒåœ¾æ”¶é›†å™¨"></a>Javaåƒåœ¾æ”¶é›†å™¨</h1><p>Javaåƒåœ¾æ”¶é›†å™¨ä½¿ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œç”±äºåƒåœ¾æ”¶é›†ä¸»è¦é›†ä¸­åœ¨å †å†…å­˜ä¸­ï¼Œäºæ˜¯æŠŠå †åˆ†ä¸ºâ€å¹´è½»ä»£â€å’Œâ€å¹´è€ä»£â€ï¼Œä¹ŸæŠŠæ–¹æ³•åŒºåœ¨é€»è¾‘ä¸Šç§°ä¸ºâ€æ°¸ä¹…ä»£â€ã€‚å¹´è½»ä»£ä¸­çš„å¯¹è±¡å­˜æ´»æ—¶é—´è¾ƒçŸ­ï¼Œç»å¤§éƒ¨åˆ†åƒåœ¾æ”¶é›†å™¨ä½¿ç”¨å¤åˆ¶ç®—æ³•ã€‚å¹´è€ä»£ä¸­å¯¹è±¡å­˜æ´»æ—¶é—´è¾ƒé•¿ï¼Œä¸€èˆ¬é‡‡ç”¨æ ‡è®°-æ¸…é™¤æˆ–è€…æ ‡è®°-æ•´ç†ç®—æ³•ã€‚ä¸‹å›¾ä¸ºå„ä¸ªæ”¶é›†å™¨æ˜¯å¦</p><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/gc_collector.jpg" alt="gc_collector.jpg"></p><h2 id="å¹´è½»ä»£ä¸­çš„åƒåœ¾æ”¶é›†å™¨"><a href="#å¹´è½»ä»£ä¸­çš„åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="å¹´è½»ä»£ä¸­çš„åƒåœ¾æ”¶é›†å™¨"></a>å¹´è½»ä»£ä¸­çš„åƒåœ¾æ”¶é›†å™¨</h2><h3 id="Serialæ”¶é›†å™¨"><a href="#Serialæ”¶é›†å™¨" class="headerlink" title="Serialæ”¶é›†å™¨"></a>Serialæ”¶é›†å™¨</h3><ul><li>é‡‡ç”¨å¤åˆ¶ç®—æ³•å®ç°</li><li>å•çº¿ç¨‹</li><li>GCçº¿ç¨‹æ‰§è¡Œæ—¶ï¼Œå¿…é¡» Stop The World</li></ul><h3 id="ParNewæ”¶é›†å™¨"><a href="#ParNewæ”¶é›†å™¨" class="headerlink" title="ParNewæ”¶é›†å™¨"></a>ParNewæ”¶é›†å™¨</h3><ul><li>é‡‡ç”¨å¤åˆ¶ç®—æ³•å®ç°</li><li>å¤šçº¿ç¨‹</li><li>å¤šæ¡GCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œç”¨æˆ·çº¿ç¨‹å¿…é¡» Stop The World</li></ul><h3 id="Parallel-Scavengeæ”¶é›†å™¨"><a href="#Parallel-Scavengeæ”¶é›†å™¨" class="headerlink" title="Parallel Scavengeæ”¶é›†å™¨"></a>Parallel Scavengeæ”¶é›†å™¨</h3><ul><li>é‡‡ç”¨å¤åˆ¶ç®—æ³•å®ç°</li><li>å¹¶è¡Œå¤šçº¿ç¨‹æ”¶é›†å™¨</li><li>å¤šæ¡GCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œç”¨æˆ·çº¿ç¨‹å¿…é¡» Stop The World</li><li>å…¶ä»–æ”¶é›†å™¨å…³æ³¨ç”¨æˆ·çº¿ç¨‹åœé¡¿æ—¶é—´ï¼Œæ­¤æ”¶é›†å™¨å…³æ³¨ç¨‹åºååé‡ã€‚</li></ul><h2 id="å¹´è€ä»£"><a href="#å¹´è€ä»£" class="headerlink" title="å¹´è€ä»£"></a>å¹´è€ä»£</h2><h3 id="Serial-Oldæ”¶é›†å™¨"><a href="#Serial-Oldæ”¶é›†å™¨" class="headerlink" title="Serial Oldæ”¶é›†å™¨"></a>Serial Oldæ”¶é›†å™¨</h3><ul><li>Serial Oldæ”¶é›†å™¨æ—¶Serialæ”¶é›†å™¨çš„å¹´è€ä»£ç‰ˆæœ¬</li><li>å•çº¿ç¨‹æ”¶é›†å™¨</li><li>æ ‡è®°-æ•´ç†ç®—æ³•</li><li>æ˜¯CMSç®—æ³•çš„åå¤‡æ–¹æ¡ˆ</li></ul><h3 id="Parallel-Oldæ”¶é›†å™¨"><a href="#Parallel-Oldæ”¶é›†å™¨" class="headerlink" title="Parallel Oldæ”¶é›†å™¨"></a>Parallel Oldæ”¶é›†å™¨</h3><ul><li>Parallel Oldæ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</li><li>å¤šçº¿ç¨‹æ”¶é›†å™¨</li><li>æ³¨é‡ååé‡ä»¥åŠCPUèµ„æºæ•æ„Ÿåœºåˆï¼Œå¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel Scavenge + Parallel Oldçš„ç»„åˆã€‚</li></ul><h3 id="CMSæ”¶é›†å™¨"><a href="#CMSæ”¶é›†å™¨" class="headerlink" title="CMSæ”¶é›†å™¨"></a>CMSæ”¶é›†å™¨</h3><ul><li>CMS(Concurrent Mark Sweep)æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­åœé¡¿æ—¶é—´ç›®æ ‡çš„æ”¶é›†å™¨ã€‚</li><li>ä½¿ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•å®ç°</li><li>å¤šçº¿ç¨‹</li></ul><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>å¹¶å‘æ”¶é›†</li><li>ä½åœé¡¿</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>CMSæ”¶é›†å™¨å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿï¼ˆå›æ”¶çº¿ç¨‹æ•° (cpuæ•°é‡ + 3)/4   æ‰€ä»¥CPUä¸è¶³4ä¸ªæ—¶ï¼Œåƒåœ¾æ”¶é›†çº¿ç¨‹å ç”¨50% CPUèµ„æº ï¼‰</li><li>CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾(Floating Garbage)</li><li>æ ‡è®°-æ¸…é™¤ç®—æ³•å¸¦æ¥çš„å†…å­˜ç¢ç‰‡å¤„ç†</li></ul><p><strong>CMSè¿‡ç¨‹ï¼š</strong></p><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/CMS-Process.jpg" alt="CMS-Process.jpg"></p><h1 id="remark"><a href="#remark" class="headerlink" title="remark"></a>remark</h1><p>ç”±äºG1æ”¶é›†å™¨æš‚æ—¶ä½¿ç”¨å¹¶ä¸ä¸»æµï¼Œæš‚æ—¶ä¸åšè¿‡å¤šçš„å­¦ä¹ ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡å¤§éƒ¨åˆ†çš„çŸ¥è¯†æ¥è‡ªäºå‘¨å¿—æ˜å¤§ç¥çš„&lt;a href=&quot;https://book.douban.com/subject/24722612/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬2ç‰ˆï¼‰ã€‹&lt;/a&gt;ä¸€ä¹¦ï¼Œç³»ç»Ÿå­¦ä¹ JVMç›¸å…³çŸ¥è¯†çš„å¼ºçƒˆæ¨èã€‚ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•&quot;&gt;&lt;a href=&quot;#ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•&quot;&gt;&lt;/a&gt;ä¸€ã€åƒåœ¾æ”¶é›†ç®—æ³•&lt;/h1&gt;&lt;p&gt;æœ‰å…³åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæœ‰ä¸€ä¸ªå›½å¤–çš„å¤§ç¥ç”¨JSç”Ÿæˆçš„åŠ¨å›¾ç›´è§‚çš„å±•ç¤ºäº†åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ï¼Œæœ‰åŠ©äºå¯¹åƒåœ¾æ”¶é›†ç®—æ³•çš„ç†è§£ï¼Œè¿™æ˜¯æ–‡ç« &lt;a href=&quot;https://spin.atomicobject.com/2014/09/03/visualizing-garbage-collection-algorithms/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿æ¥&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id=&quot;æ— åƒåœ¾å›æ”¶-NO-GC&quot;&gt;&lt;a href=&quot;#æ— åƒåœ¾å›æ”¶-NO-GC&quot; class=&quot;headerlink&quot; title=&quot;æ— åƒåœ¾å›æ”¶(NO-GC)&quot;&gt;&lt;/a&gt;æ— åƒåœ¾å›æ”¶(NO-GC)&lt;/h2&gt;&lt;p&gt;åœ¨ç¨‹åºè¿è¡Œç»“æŸåï¼Œä¸€æ¬¡æ€§çš„å¯¹å†…å­˜è¿›è¡Œå›æ”¶ï¼Œæ˜¯æœ€ç®€å•çš„å›æ”¶æœºåˆ¶ã€‚å…¶å¹¶å‘æ€§èƒ½æœ€é«˜ï¼Œå¦‚æœèƒ½æŠŠä»»åŠ¡çš„é¢—ç²’åº¦å˜å¾—æ›´ç»†ï¼Œå¯ä»¥æœ‰æ•ˆçš„æ¸…ç†åƒåœ¾ã€‚æœ€å¤§çš„ç¼ºç‚¹æ˜¯å¯¹é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºæˆ–è€…å ç”¨å†…å­˜å¤§çš„ç¨‹åºæ¥è¯´ï¼Œéå¸¸å®¹æ˜“å†…å­˜æº¢å‡ºã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="JVM" scheme="http://peierlong.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>JVMå†…å­˜æ¨¡å‹ç®€è¿°</title>
    <link href="http://peierlong.com/2018/03/09/JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E6%80%BB%E7%BB%93/"/>
    <id>http://peierlong.com/2018/03/09/JVMå†…å­˜æ¨¡å‹æ€»ç»“/</id>
    <published>2018-03-09T10:11:14.000Z</published>
    <updated>2019-03-13T02:32:01.036Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡å¤§éƒ¨åˆ†çš„çŸ¥è¯†æ¥è‡ªäºå‘¨å¿—æ˜å¤§ç¥çš„<a href="https://book.douban.com/subject/24722612/" target="_blank" rel="noopener">ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬2ç‰ˆï¼‰ã€‹</a>ä¸€ä¹¦ï¼Œç³»ç»Ÿå­¦ä¹ JVMç›¸å…³çŸ¥è¯†çš„å¼ºçƒˆæ¨èã€‚ </p></blockquote><p>Javaå†…å­˜åŒºåŸŸæ¦‚æ‹¬æ€§çš„æ¥è®²ï¼Œåˆ†ä¸ºçº¿ç¨‹ç‹¬å çš„è™šæ‹Ÿæœºæ ˆ(VM Stack)ã€æœ¬åœ°æ–¹æ³•æ ˆ(Native Method Stack)ã€ç¨‹åºè®¡æ•°å™¨(Programer Counter Register)å’Œçº¿ç¨‹å…±äº«çš„æ–¹æ³•åŒº(Method Area)ã€å †(Heap)ã€‚</p><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/Xnip2018-03-71_15-54-12.jpg" alt="Xnip2018-03-71_15-54-12"></p><a id="more"></a><h1 id="ä¸€ã€çº¿ç¨‹ç‹¬å åŒºåŸŸ"><a href="#ä¸€ã€çº¿ç¨‹ç‹¬å åŒºåŸŸ" class="headerlink" title="ä¸€ã€çº¿ç¨‹ç‹¬å åŒºåŸŸ"></a>ä¸€ã€çº¿ç¨‹ç‹¬å åŒºåŸŸ</h1><h2 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h2><p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜åŒºåŸŸï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šåˆ†é…ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ï¼Œç”¨æ¥å­˜å‚¨å½“å‰æ‰€è‡´è¡Œçš„å­—èŠ‚ç çš„è¡Œå·ï¼Œç¨‹åºçš„æ‰§è¡Œã€è·³è½¬ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†éƒ½éœ€è¦è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒã€‚</p><h2 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h2><p>å’Œç¨‹åºè®¡æ•°å™¨ä¸€æ ·ï¼Œè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç‹¬å çš„ï¼Œç”Ÿå‘½å‘¨æœŸå’Œçº¿ç¨‹ç›¸åŒï¼Œè™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ï¼šæ¯ä¸ªæ–¹æ³•æ‰§è¡Œçš„åŒæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</p><p>æ¯ä¸€ä¸ªæ–¹æ³•ä»è°ƒç”¨åˆ°æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå¯¹åº”ç€ä¸€æ¬¡å…¥æ ˆå’Œå‡ºæ ˆçš„è¿‡ç¨‹ã€‚</p><h3 id="å±€éƒ¨å˜é‡è¡¨"><a href="#å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="å±€éƒ¨å˜é‡è¡¨"></a>å±€éƒ¨å˜é‡è¡¨</h3><p>å±€éƒ¨å˜é‡è¡¨ä¸­å­˜å‚¨ç€ç¼–è¯‘å™¨å¯çŸ¥çš„åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨å’ŒreturnAddressç±»å‹(æŒ‡å‘ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€)ã€‚</p><p>å±€éƒ¨å˜é‡è¡¨çš„å¤§å°è¡¨ç¤ºä¸ºå±€éƒ¨å˜é‡ç©ºé—´(Slot)ï¼Œ64ä½é•¿åº¦çš„doubleå’Œlongå ç”¨ä¸¤ä¸ªSlotï¼Œå…¶ä½™å ç”¨ä¸€ä¸ªã€‚</p><h2 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h2><p>æœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆçš„ä½œç”¨ç±»ä¼¼ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„Nativeæ–¹æ³•æœåŠ¡ï¼Œè™šæ‹Ÿæœºè§„èŒƒæ²¡æœ‰æ˜ç¡®è§„èŒƒæ­¤åŒºåŸŸï¼ŒSun HotSpotç›´æ¥æŠŠæœ¬åœ°æ–¹æ³•æ ˆå’Œè™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€ã€‚</p><h1 id="äºŒã€çº¿ç¨‹å…±äº«åŒºåŸŸ"><a href="#äºŒã€çº¿ç¨‹å…±äº«åŒºåŸŸ" class="headerlink" title="äºŒã€çº¿ç¨‹å…±äº«åŒºåŸŸ"></a>äºŒã€çº¿ç¨‹å…±äº«åŒºåŸŸ</h1><h2 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h2><p>æ–¹æ³•åŒºæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ï¼Œå³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚</p><p>HotSpotè™šæ‹Ÿæœºä¸­ï¼Œæ–¹æ³•åŒºä¹Ÿç§°ä¸ºâ€æ°¸ä¹…ä»£(Permanent Generation)â€ã€‚</p><h2 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h2><p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸé—´ç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚</p><h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><p>å †æ˜¯Javaè™šæ‹Ÿæœºå†…å­˜æ¨¡å‹ä¸­æœ€å¤§çš„ä¸€å—çº¿ç¨‹å…±äº«çš„åŒºåŸŸï¼Œæ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ä½œç”¨å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚</p><p>Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œä¹Ÿç§°ä¸ºâ€GCå †â€ã€‚ä½¿ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œåˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ä»å†…å­˜åˆ†é…çš„è§’åº¦çœ‹ï¼ŒJavaå †å¯èƒ½åˆ’åˆ†å‡ºå¤šä¸ªçº¿ç¨‹ç§æœ‰çš„åˆ†é…ç¼“å†²åŒº(Thread Local Allocation Buffer, TLAB)ã€‚</p><hr><p>ä»¥ä¸Šï¼ŒJavaå†…å­˜æ¨¡å‹ç®€è¿°å®Œæ¯•ï¼Œä¸Šä¸€å¼ æ€»ç»“çš„æ€ç»´å¯¼å›¾ã€‚</p><p><img src="http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/WechatIMG178.jpeg" alt="WechatIMG178.jpeg"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡å¤§éƒ¨åˆ†çš„çŸ¥è¯†æ¥è‡ªäºå‘¨å¿—æ˜å¤§ç¥çš„&lt;a href=&quot;https://book.douban.com/subject/24722612/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ˆç¬¬2ç‰ˆï¼‰ã€‹&lt;/a&gt;ä¸€ä¹¦ï¼Œç³»ç»Ÿå­¦ä¹ JVMç›¸å…³çŸ¥è¯†çš„å¼ºçƒˆæ¨èã€‚ &lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Javaå†…å­˜åŒºåŸŸæ¦‚æ‹¬æ€§çš„æ¥è®²ï¼Œåˆ†ä¸ºçº¿ç¨‹ç‹¬å çš„è™šæ‹Ÿæœºæ ˆ(VM Stack)ã€æœ¬åœ°æ–¹æ³•æ ˆ(Native Method Stack)ã€ç¨‹åºè®¡æ•°å™¨(Programer Counter Register)å’Œçº¿ç¨‹å…±äº«çš„æ–¹æ³•åŒº(Method Area)ã€å †(Heap)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://peierlong-blog.oss-cn-hongkong.aliyuncs.com/Xnip2018-03-71_15-54-12.jpg&quot; alt=&quot;Xnip2018-03-71_15-54-12&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="JVM" scheme="http://peierlong.com/tags/JVM/"/>
    
  </entry>
  
  <entry>
    <title>ã€ŠElasticsearchæƒå¨æŒ‡å—ã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="http://peierlong.com/2018/03/06/%E3%80%8AElasticsearch-%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/"/>
    <id>http://peierlong.com/2018/03/06/ã€ŠElasticsearch-æƒå¨æŒ‡å—ã€‹è¯»ä¹¦ç¬”è®°/</id>
    <published>2018-03-06T06:31:27.000Z</published>
    <updated>2019-03-13T02:32:01.041Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸ºã€ŠElasticsearchæƒå¨æŒ‡å—ã€‹é˜…è¯»ç¬”è®°ï¼ŒåŸä¹¦é“¾æ¥è¯·ç‚¹å‡»<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html" target="_blank" rel="noopener">è¿™é‡Œ</a>æŸ¥çœ‹ã€‚</p></blockquote><a id="more"></a><h1 id="ç´¢å¼•-åŠ¨è¯-æ“ä½œä¸ç´¢å¼•-åè¯"><a href="#ç´¢å¼•-åŠ¨è¯-æ“ä½œä¸ç´¢å¼•-åè¯" class="headerlink" title="ç´¢å¼•(åŠ¨è¯)æ“ä½œä¸ç´¢å¼•(åè¯)"></a>ç´¢å¼•(åŠ¨è¯)æ“ä½œä¸ç´¢å¼•(åè¯)</h1><p>æ•´ä¸ª<code>PUT</code>æ“ä½œçš„åŠ¨ä½œç§°ä¹‹ä¸ºç´¢å¼•(åŠ¨è¯)</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /megacorp/employee/1</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"first_name"</span> : <span class="string">"John"</span>,</span><br><span class="line">    <span class="attr">"last_name"</span> :  <span class="string">"Smith"</span>,</span><br><span class="line">    <span class="attr">"age"</span> :        <span class="number">25</span>,</span><br><span class="line">    <span class="attr">"about"</span> :      <span class="string">"I love to go rock climbing"</span>,</span><br><span class="line">    <span class="attr">"interests"</span>: [ <span class="string">"sports"</span>, <span class="string">"music"</span> ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>megacorp</code> ç´¢å¼•åç§°</li><li><code>employee</code> ç´¢å¼•ç±»å‹</li><li><code>1</code>        ç‰¹å®šé›‡å‘˜çš„id</li></ul><h1 id="æ£€ç´¢æ–‡æ¡£"><a href="#æ£€ç´¢æ–‡æ¡£" class="headerlink" title="æ£€ç´¢æ–‡æ¡£"></a>æ£€ç´¢æ–‡æ¡£</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/1</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"_index"</span> :   <span class="string">"megacorp"</span>,</span><br><span class="line">  <span class="attr">"_type"</span> :    <span class="string">"employee"</span>,</span><br><span class="line">  <span class="attr">"_id"</span> :      <span class="string">"1"</span>,</span><br><span class="line">  <span class="attr">"_version"</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">"found"</span> :    <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"_source"</span> :  &#123;</span><br><span class="line">      <span class="attr">"first_name"</span> :  <span class="string">"John"</span>,</span><br><span class="line">      <span class="attr">"last_name"</span> :   <span class="string">"Smith"</span>,</span><br><span class="line">      <span class="attr">"age"</span> :         <span class="number">25</span>,</span><br><span class="line">      <span class="attr">"about"</span> :       <span class="string">"I love to go rock climbing"</span>,</span><br><span class="line">      <span class="attr">"interests"</span>:  [ <span class="string">"sports"</span>, <span class="string">"music"</span> ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è½»é‡æœç´¢"><a href="#è½»é‡æœç´¢" class="headerlink" title="è½»é‡æœç´¢"></a>è½»é‡æœç´¢</h1><h2 id="æœç´¢æ‰€æœ‰é›‡å‘˜"><a href="#æœç´¢æ‰€æœ‰é›‡å‘˜" class="headerlink" title="æœç´¢æ‰€æœ‰é›‡å‘˜"></a>æœç´¢æ‰€æœ‰é›‡å‘˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search</span><br></pre></td></tr></table></figure><h2 id="æœç´¢last-nameä¸ºSmithçš„æ‰€æœ‰é›‡å‘˜"><a href="#æœç´¢last-nameä¸ºSmithçš„æ‰€æœ‰é›‡å‘˜" class="headerlink" title="æœç´¢last_nameä¸ºSmithçš„æ‰€æœ‰é›‡å‘˜"></a>æœç´¢last_nameä¸ºSmithçš„æ‰€æœ‰é›‡å‘˜</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search?q=last_name:Smith</span><br></pre></td></tr></table></figure><h1 id="ä½¿ç”¨æŸ¥è¯¢è¡¨è¾¾å¼æœç´¢"><a href="#ä½¿ç”¨æŸ¥è¯¢è¡¨è¾¾å¼æœç´¢" class="headerlink" title="ä½¿ç”¨æŸ¥è¯¢è¡¨è¾¾å¼æœç´¢"></a>ä½¿ç”¨æŸ¥è¯¢è¡¨è¾¾å¼æœç´¢</h1><p><strong>æœç´¢last_nameä¸ºSmithçš„æ‰€æœ‰é›‡å‘˜</strong>å¯ä»¥æ”¹å†™ä¸ºä»¥ä¸‹å½¢å¼</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"last_name"</span> : <span class="string">"Smith"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ›´å¤æ‚çš„æœç´¢"><a href="#æ›´å¤æ‚çš„æœç´¢" class="headerlink" title="æ›´å¤æ‚çš„æœç´¢"></a>æ›´å¤æ‚çš„æœç´¢</h1><h2 id="è¿‡æ»¤å™¨-filter-çš„ä½¿ç”¨"><a href="#è¿‡æ»¤å™¨-filter-çš„ä½¿ç”¨" class="headerlink" title="è¿‡æ»¤å™¨ filter çš„ä½¿ç”¨"></a>è¿‡æ»¤å™¨ filter çš„ä½¿ç”¨</h2><p>æœç´¢last_nameä¸ºSmithçš„æ‰€æœ‰é›‡å‘˜ï¼Œå¹¶åªéœ€è¦å¹´é¾„å¤§äº30çš„ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"bool"</span>: &#123;</span><br><span class="line">            <span class="attr">"must"</span>: &#123;</span><br><span class="line">                <span class="attr">"match"</span> : &#123;</span><br><span class="line">                    <span class="attr">"last_name"</span> : <span class="string">"smith"</span> </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"filter"</span>: &#123;</span><br><span class="line">                <span class="attr">"range"</span> : &#123;</span><br><span class="line">                    <span class="attr">"age"</span> : &#123; <span class="attr">"gt"</span> : <span class="number">30</span> &#125; </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å…¨æ–‡æœç´¢"><a href="#å…¨æ–‡æœç´¢" class="headerlink" title="å…¨æ–‡æœç´¢"></a>å…¨æ–‡æœç´¢</h1><p>æœç´¢ä¸‹æ‰€æœ‰å–œæ¬¢æ”€å²©ï¼ˆrock climbingï¼‰çš„é›‡å‘˜</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"match"</span> : &#123;</span><br><span class="line">            <span class="attr">"about"</span> : <span class="string">"rock climbing"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   ...</span><br><span class="line">   "hits": &#123;</span><br><span class="line">      "total":      2,</span><br><span class="line">      "max_score":  0.16273327,</span><br><span class="line">      "hits": [</span><br><span class="line">         &#123;</span><br><span class="line">            ...</span><br><span class="line">            "_score":         0.16273327, </span><br><span class="line">            "_source": &#123;</span><br><span class="line">               ...</span><br><span class="line">               "about":       "I love to go rock climbing",</span><br><span class="line">               ...</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">            ...</span><br><span class="line">            "_score":         0.016878016, </span><br><span class="line">            "_source": &#123;</span><br><span class="line">               ...</span><br><span class="line">               "about":       "I love to go rock albums",</span><br><span class="line">               ...</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>_score</code> ä¸ºç›¸å…³æ€§å¾—åˆ†å­—æ®µï¼Œå¾—åˆ†è¶Šé«˜ï¼Œæ’åè¶Šé å‰ã€‚</p><h1 id="çŸ­è¯­æœç´¢"><a href="#çŸ­è¯­æœç´¢" class="headerlink" title="çŸ­è¯­æœç´¢"></a>çŸ­è¯­æœç´¢</h1><p>ä»…åŒ¹é…åŒæ—¶åŒ…å« â€œrockâ€ å’Œ â€œclimbingâ€ ï¼Œå¹¶ä¸” äºŒè€…ä»¥çŸ­è¯­ â€œrock climbingâ€ çš„å½¢å¼ç´§æŒ¨ç€çš„é›‡å‘˜è®°å½•ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"match_phrase"</span> : &#123;</span><br><span class="line">            <span class="attr">"about"</span> : <span class="string">"rock climbing"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="é«˜äº®æœç´¢"><a href="#é«˜äº®æœç´¢" class="headerlink" title="é«˜äº®æœç´¢"></a>é«˜äº®æœç´¢</h1><p>ESä¸­ä½¿ç”¨<code>highlight</code>å‚æ•°ä½¿ç»“æœé«˜äº®ã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"query"</span> : &#123;</span><br><span class="line">        <span class="attr">"match_phrase"</span> : &#123;</span><br><span class="line">            <span class="attr">"about"</span> : <span class="string">"rock climbing"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"highlight"</span>: &#123;</span><br><span class="line">        <span class="attr">"fields"</span> : &#123;</span><br><span class="line">            <span class="attr">"about"</span> : &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ†æ-èšåˆæœç´¢-aggregations"><a href="#åˆ†æ-èšåˆæœç´¢-aggregations" class="headerlink" title="åˆ†æ-èšåˆæœç´¢(aggregations)"></a>åˆ†æ-èšåˆæœç´¢(aggregations)</h1><p>æŒ–æ˜å‡ºé›‡å‘˜ä¸­æœ€å—æ¬¢è¿çš„å…´è¶£çˆ±å¥½</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /megacorp/employee/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"aggs"</span>: &#123;</span><br><span class="line">    <span class="attr">"all_interests"</span>: &#123;</span><br><span class="line">      <span class="attr">"terms"</span>: &#123; <span class="attr">"field"</span>: <span class="string">"interests"</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä¸ºã€ŠElasticsearchæƒå¨æŒ‡å—ã€‹é˜…è¯»ç¬”è®°ï¼ŒåŸä¹¦é“¾æ¥è¯·ç‚¹å‡»&lt;a href=&quot;https://www.elastic.co/guide/cn/elasticsearch/guide/current/index.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;è¿™é‡Œ&lt;/a&gt;æŸ¥çœ‹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Elasticsearch" scheme="http://peierlong.com/categories/Elasticsearch/"/>
    
    
      <category term="Elasticsearch" scheme="http://peierlong.com/tags/Elasticsearch/"/>
    
  </entry>
  
  <entry>
    <title>äºŒå‰æŸ¥æ‰¾æ ‘å®ç°</title>
    <link href="http://peierlong.com/2018/02/09/%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91%E5%AE%9E%E7%8E%B0/"/>
    <id>http://peierlong.com/2018/02/09/äºŒå‰æŸ¥æ‰¾æ ‘å®ç°/</id>
    <published>2018-02-09T06:21:43.000Z</published>
    <updated>2019-03-13T02:32:01.041Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šå¤©æ˜¯å†œå†è…ŠæœˆäºŒåå››ï¼Œä¹Ÿæ˜¯è¿‡å¹´å‰ä¸Šç­çš„æœ€åä¸€å¤©ï¼Œä¹˜ç€å·¥ä½œä¸å¿™çš„åŠŸå¤«ï¼ŒæŠŠç®—æ³•4å…¬å¼€è¯¾çš„ç¬¬å››å‘¨åšä¸ªç»“æŸï¼Œæœ¬æ–‡æ€»ç»“ç¬¬å››å‘¨ä¸­ç¬¬äºŒèŠ‚ç¬¦å·è¡¨(Symbol Tables)ä¸­çš„äºŒå‰æŸ¥æ‰¾æ ‘(Binary Search Tree)æ•°æ®ç»“æ„ã€‚</p><h2 id="äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨"><a href="#äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨" class="headerlink" title="äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨"></a>äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨</h2><p>from : <a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%85%83%E6%90%9C%E5%B0%8B%E6%A8%B9" target="_blank" rel="noopener">wiki</a></p><blockquote><p>äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼‰ï¼Œä¹Ÿç§°äºŒå‰æœç´¢æ ‘ã€æœ‰åºäºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šordered binary treeï¼‰ï¼Œæ’åºäºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šsorted binary treeï¼‰ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š</p></blockquote><blockquote><p>è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›<br>è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›<br>ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼›<br>æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚</p></blockquote><a id="more"></a><h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> edu.princeton.cs.algs4.Queue;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * äºŒå‰æŸ¥æ‰¾æ ‘çš„å®ç°</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> elong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018/1/23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BST</span>&lt;<span class="title">Key</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">Key</span>&gt;, <span class="title">Value</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node root;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Key key;</span><br><span class="line">        <span class="keyword">private</span> Value value;</span><br><span class="line">        <span class="keyword">private</span> Node left, right;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(Key key, Value value)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.count = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> key + <span class="string">" : "</span> + value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Key key, Value value)</span> </span>&#123;</span><br><span class="line">        root = put(root, key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">put</span><span class="params">(Node x, Key key, Value value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Node(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cmp = key.compareTo(x.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            x.left = put(x.left, key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            x.right = put(x.right, key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">            x.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">        x.count = <span class="number">1</span> + size(x.left) + size(x.right);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Value <span class="title">get</span><span class="params">(Key key)</span> </span>&#123;</span><br><span class="line">        Node x = root;</span><br><span class="line">        <span class="keyword">while</span> (x != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> cmp = key.compareTo(x.key);</span><br><span class="line">            <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                x = x.left;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                x = x.right;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> x.value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node.count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Key <span class="title">minKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node node = minKey(root);</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> node.key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">minKey</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> minKey(node.left);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Key <span class="title">maxKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Node node = maxKey(root);</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> node.key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">maxKey</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> maxKey(node.right);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°äºç­‰äºç»™å®šKeyçš„æœ€å¤§å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Key <span class="title">floor</span><span class="params">(Key key)</span> </span>&#123;</span><br><span class="line">        Node node = floor(root, key);</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> node.key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">floor</span><span class="params">(Node node, Key key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> cmp = key.compareTo(node.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> floor(node.left, key);</span><br><span class="line">        &#125;</span><br><span class="line">        Node x = floor(node.right, key);</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤§äºç­‰äºç»™å®šKeyçš„æœ€å°å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Key <span class="title">ceiling</span><span class="params">(Key key)</span> </span>&#123;</span><br><span class="line">        Node node = ceiling(root, key);</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node.key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">ceiling</span><span class="params">(Node node, Key key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> cmp = key.compareTo(node.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ceiling(node.right, key);</span><br><span class="line">        &#125;</span><br><span class="line">        Node x = ceiling(node.left, key);</span><br><span class="line">        <span class="keyword">if</span> (x != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°äºKeyçš„Nodeçš„æ•°é‡</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">rank</span><span class="params">(Key key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> rank(root, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">rank</span><span class="params">(Node node, Key key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cmp = key.compareTo(node.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> size(node.left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + size(node.left) + rank(node.right, key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rank(node.left, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterable&lt;Key&gt; <span class="title">keys</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Queue&lt;Key&gt; q = <span class="keyword">new</span> Queue&lt;&gt;();</span><br><span class="line">        inorder(root, q);</span><br><span class="line">        <span class="keyword">return</span> q;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">inorder</span><span class="params">(Node node, Queue&lt;Key&gt; q)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        inorder(node.left, q);</span><br><span class="line">        q.enqueue(node.key);</span><br><span class="line">        inorder(node.right, q);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Key key)</span> </span>&#123;</span><br><span class="line">        delete(root, key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">delete</span><span class="params">(Node node, Key key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cmp = key.compareTo(node.key);</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.left = delete(node.left, key);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            node.right = delete(node.right, key);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (node.right == <span class="keyword">null</span>) <span class="keyword">return</span> node.left;</span><br><span class="line">            <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) <span class="keyword">return</span> node.right;</span><br><span class="line"></span><br><span class="line">            Node t = node;</span><br><span class="line">            node = minKey(t.right);</span><br><span class="line">            node.right = delMin(t.right);</span><br><span class="line">            node.left = t.left;</span><br><span class="line">        &#125;</span><br><span class="line">        node.count = <span class="number">1</span> + size(node.left) + size(node.right);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delMin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        delMin(root);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Node <span class="title">delMin</span><span class="params">(Node node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node.left == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> node.right;</span><br><span class="line">        &#125;</span><br><span class="line">        node.left = delMin(node.left);</span><br><span class="line">        node.count = <span class="number">1</span> + size(node.left) + size(node.right);</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BST&lt;String, String&gt; bst = <span class="keyword">new</span> BST&lt;&gt;();</span><br><span class="line">        bst.put(<span class="string">"b"</span>, <span class="string">"b"</span>);</span><br><span class="line">        bst.put(<span class="string">"c"</span>, <span class="string">"c"</span>);</span><br><span class="line">        bst.put(<span class="string">"d"</span>, <span class="string">"d"</span>);</span><br><span class="line">        bst.put(<span class="string">"e"</span>, <span class="string">"e"</span>);</span><br><span class="line">        bst.put(<span class="string">"u"</span>, <span class="string">"r"</span>);</span><br><span class="line">        bst.put(<span class="string">"f"</span>, <span class="string">"r"</span>);</span><br><span class="line">        bst.put(<span class="string">"y"</span>, <span class="string">"r"</span>);</span><br><span class="line">        bst.put(<span class="string">"v"</span>, <span class="string">"r"</span>);</span><br><span class="line">        bst.put(<span class="string">"v"</span>, <span class="string">"r"</span>);</span><br><span class="line">        bst.put(<span class="string">"v"</span>, <span class="string">"r"</span>);</span><br><span class="line">        bst.put(<span class="string">"a"</span>, <span class="string">"r"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(bst.ceiling(<span class="string">"a"</span>));</span><br><span class="line">        System.out.println(bst.maxKey());</span><br><span class="line">        System.out.println(bst.size());</span><br><span class="line">        System.out.println(bst.rank(<span class="string">"z"</span>));</span><br><span class="line"></span><br><span class="line">        bst.delMin();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String s : bst.keys()) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœ¬äººæ€è€ƒ"><a href="#æœ¬äººæ€è€ƒ" class="headerlink" title="æœ¬äººæ€è€ƒ"></a>æœ¬äººæ€è€ƒ</h2><ol><li>é€’å½’æ€æƒ³çš„è¿ç”¨æœ‰å¾…æé«˜</li><li>åœ¨å†™ä»£ç å‰ï¼Œå¤§è„‘ä¸­ä¸€å®šè¦æœ‰æ¸…æ™°çš„æ•°æ®ç»“æ„ï¼Œå¦è€…å®¹æ˜“å†™åˆ°ä¸€åŠæ€è·¯æ–­äº†ã€‚</li></ol><p>The end</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ä»Šå¤©æ˜¯å†œå†è…ŠæœˆäºŒåå››ï¼Œä¹Ÿæ˜¯è¿‡å¹´å‰ä¸Šç­çš„æœ€åä¸€å¤©ï¼Œä¹˜ç€å·¥ä½œä¸å¿™çš„åŠŸå¤«ï¼ŒæŠŠç®—æ³•4å…¬å¼€è¯¾çš„ç¬¬å››å‘¨åšä¸ªç»“æŸï¼Œæœ¬æ–‡æ€»ç»“ç¬¬å››å‘¨ä¸­ç¬¬äºŒèŠ‚ç¬¦å·è¡¨(Symbol Tables)ä¸­çš„äºŒå‰æŸ¥æ‰¾æ ‘(Binary Search Tree)æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;h2 id=&quot;äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨&quot;&gt;&lt;a href=&quot;#äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨&quot; class=&quot;headerlink&quot; title=&quot;äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨&quot;&gt;&lt;/a&gt;äºŒå‰æŸ¥æ‰¾æ ‘çš„æ€§è´¨&lt;/h2&gt;&lt;p&gt;from : &lt;a href=&quot;https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%85%83%E6%90%9C%E5%B0%8B%E6%A8%B9&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;wiki&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼‰ï¼Œä¹Ÿç§°äºŒå‰æœç´¢æ ‘ã€æœ‰åºäºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šordered binary treeï¼‰ï¼Œæ’åºäºŒå‰æ ‘ï¼ˆè‹±è¯­ï¼šsorted binary treeï¼‰ï¼Œæ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›&lt;br&gt;è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰èŠ‚ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹èŠ‚ç‚¹çš„å€¼ï¼›&lt;br&gt;ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼›&lt;br&gt;æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Algorithms" scheme="http://peierlong.com/categories/Algorithms/"/>
    
    
      <category term="Algorithms" scheme="http://peierlong.com/tags/Algorithms/"/>
    
  </entry>
  
  <entry>
    <title>tomcatä¸‹slf4jæ—¥å¿—ä¸è¾“å‡ºé—®é¢˜æ¢ç©¶ä¸è§£å†³</title>
    <link href="http://peierlong.com/2018/02/05/tomcat%E4%B8%8Bslf4j%E6%97%A5%E5%BF%97%E4%B8%8D%E8%BE%93%E5%87%BA%E9%97%AE%E9%A2%98%E6%8E%A2%E7%A9%B6%E4%B8%8E%E8%A7%A3%E5%86%B3/"/>
    <id>http://peierlong.com/2018/02/05/tomcatä¸‹slf4jæ—¥å¿—ä¸è¾“å‡ºé—®é¢˜æ¢ç©¶ä¸è§£å†³/</id>
    <published>2018-02-05T03:10:36.000Z</published>
    <updated>2019-03-13T02:32:01.041Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>è¿‘æ—¥ï¼Œç”±äºå…¬å¸ç³»ç»Ÿæ¶æ„è°ƒæ•´ï¼Œå‘ç°tomcat8ä¸‹æ—¥å¿—è¾“å‡ºæœ‰é—®é¢˜ï¼Œä½†æ˜¯tomcat7æ²¡æœ‰é—®é¢˜ï¼Œå…¶ä¸­ä½†å‡¡å¼•ç”¨ <code>slf4j</code> è¾“å‡ºçš„æ—¥å¿—éƒ½ä¸è¾“å‡ºäº†ã€‚</p><h2 id="é—®é¢˜åˆ†æ"><a href="#é—®é¢˜åˆ†æ" class="headerlink" title="é—®é¢˜åˆ†æ"></a>é—®é¢˜åˆ†æ</h2><p>é¦–å…ˆï¼Œå®šä½é—®é¢˜ï¼Œç”±äºä»£ç æ²¡æœ‰åšè¿‡ä»»ä½•æ”¹åŠ¨ï¼Œæ‰€ä»¥ç›´æ¥å®šä½åˆ°tomcat7å’Œtomcat8å·®å¼‚å¼•èµ·çš„ï¼Œæ„Ÿè§‰åƒæ˜¯åŒ…å†²çªï¼Œæ‰€ä»¥æ²¿ç€è¿™ä¸ªæ€è·¯æ’æŸ¥é—®é¢˜ã€‚</p><a id="more"></a><h3 id="åœ¨æˆ‘çš„ç”µè„‘ä¸Šåˆ†åˆ«ä¸‹è½½-tomcat7-å’Œ-tomcat8ï¼Œåœ¨æ—¥å¿—ä¸­çœ‹åˆ°æ‰“å°åˆ°å¦‚ä¸‹å¼‚å¸¸æ—¥å¿—"><a href="#åœ¨æˆ‘çš„ç”µè„‘ä¸Šåˆ†åˆ«ä¸‹è½½-tomcat7-å’Œ-tomcat8ï¼Œåœ¨æ—¥å¿—ä¸­çœ‹åˆ°æ‰“å°åˆ°å¦‚ä¸‹å¼‚å¸¸æ—¥å¿—" class="headerlink" title="åœ¨æˆ‘çš„ç”µè„‘ä¸Šåˆ†åˆ«ä¸‹è½½ tomcat7 å’Œ tomcat8ï¼Œåœ¨æ—¥å¿—ä¸­çœ‹åˆ°æ‰“å°åˆ°å¦‚ä¸‹å¼‚å¸¸æ—¥å¿—"></a>åœ¨æˆ‘çš„ç”µè„‘ä¸Šåˆ†åˆ«ä¸‹è½½ <code>tomcat7</code> å’Œ <code>tomcat8</code>ï¼Œåœ¨æ—¥å¿—ä¸­çœ‹åˆ°æ‰“å°åˆ°å¦‚ä¸‹å¼‚å¸¸æ—¥å¿—</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SLF4J: Class path contains multiple SLF4J bindings.</span><br><span class="line">SLF4J: Found binding in [jar:file:/Users/elong/Desktop/war/apache-tomcat-8.5.24/webapps/niuban-mobile/WEB-INF/lib/slf4j-nop-1.7.0.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: Found binding in [jar:file:/Users/elong/Desktop/war/apache-tomcat-8.5.24/webapps/niuban-mobile/WEB-INF/lib/slf4j-log4j12-1.7.9.jar!/org/slf4j/impl/StaticLoggerBinder.class]</span><br><span class="line">SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.</span><br><span class="line">SLF4J: Actual binding is of type [org.slf4j.helpers.NOPLoggerFactory]</span><br></pre></td></tr></table></figure><p>æ­¤æŠ¥é”™ä¸ºä¾èµ–å†²çªå¼•èµ·çš„æ—¥å¿—è¾“å‡ºï¼Œæ ¹æ®æŒ‡å¼•ï¼Œæ‰“å¼€ <a href="http://www.slf4j.org/codes.html#multiple_bindings" target="_blank" rel="noopener">slf4jå®˜ç½‘æ–‡æ¡£</a>ï¼ŒæŸ¥åˆ°å¦‚ä¸‹é…ç½®ï¼Œä½¿ç”¨<code>exclusions</code>æ ‡ç­¾æ’é™¤ä¾èµ–ï¼Œä¿®æ”¹mavené…ç½®æ–‡ä»¶<code>pom.xml</code>ä¸­æ—¥å¿—çš„ä¾èµ–ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.apache.cassandra<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cassandra-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å†æ¬¡æ‰§è¡Œï¼Œé—®é¢˜ä¾ç„¶æ²¡æœ‰è§£å†³ï¼Œè¿tomcat7ä¸‹æ—¥å¿—éƒ½æ²¡æœ‰äº†ï¼Œæ­¤é…ç½®è¡Œä¸é€šï¼Œå†µä¸”ä¹Ÿä¸æ‡‚<code>org.apache.cassandra</code>è¿™ä¸ªæ˜¯ä»€ä¹ˆä¾èµ–ï¼Œä¹Ÿè®¸è¿™ä¸ªé…ç½®æ˜¯ç¤ºä¾‹ä»£ç ã€‚</p><h3 id="æ”¹å˜æ€è·¯ï¼ŒDebugæ¨¡å¼ä¸‹æŸ¥çœ‹slf4jçš„Loggeræ¥å£çš„å…·ä½“å®ç°ç±»æ˜¯ä»€ä¹ˆ"><a href="#æ”¹å˜æ€è·¯ï¼ŒDebugæ¨¡å¼ä¸‹æŸ¥çœ‹slf4jçš„Loggeræ¥å£çš„å…·ä½“å®ç°ç±»æ˜¯ä»€ä¹ˆ" class="headerlink" title="æ”¹å˜æ€è·¯ï¼ŒDebugæ¨¡å¼ä¸‹æŸ¥çœ‹slf4jçš„Loggeræ¥å£çš„å…·ä½“å®ç°ç±»æ˜¯ä»€ä¹ˆ?"></a>æ”¹å˜æ€è·¯ï¼ŒDebugæ¨¡å¼ä¸‹æŸ¥çœ‹slf4jçš„<code>Logger</code>æ¥å£çš„å…·ä½“å®ç°ç±»æ˜¯ä»€ä¹ˆ?</h3><p>å…ˆä¸Šä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(Test.class);</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">testLogger</span><span class="params">()</span></span>&#123;</span><br><span class="line">    LOGGER.info(<span class="string">"this is a test"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨Tomcat7ä¸‹ï¼Œç”¨å¯ä»¥æ‰“å°å‡ºæ—¥å¿—çš„é…ç½®æ‰§è¡Œä»£ç ï¼Œ<code>Logger</code>çš„å…·ä½“å®ç°ç±»æ˜¯<code>org.slf4j.impl.Log4jLoggerAdapter</code>ï¼Œå…¶ä¸­æ‰“å°çš„å¯åŠ¨æ—¥å¿—ä¹Ÿè¯´æ˜äº†è¿™ä¸€ç‚¹ã€‚</p><p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fo6t6i7be4j31kw04dtdo.jpg" alt></p><p>åŒæ ·çš„é…ç½®ï¼Œåœ¨Tomcat8ä¸‹ï¼Œ<code>Logger</code>çš„å…·ä½“å®ç°ç±»æ˜¯<code>org.slf4j.helpers.NOPLogger(NOP)</code><br>ï¼ŒNOPLoggerä¸ºslf4jé»˜è®¤çš„æ— æ“ä½œLoggerå®ç°ç±»ï¼Œæ‰€ä»¥å¾ˆæ˜¾ç„¶ä¸ä¼šæœ‰æ—¥å¿—è¾“å‡ºçš„ã€‚</p><p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fo6ta061i8j31kw04g79d.jpg" alt></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ˜¯ä»€ä¹ˆå¯¼è‡´çš„<code>Logger</code>å®ç°ç±»çš„æ”¹å˜ï¼Ÿçœ‹æºç æ‰¾æ‰¾çº¿ç´¢</p><p>é¦–å…ˆ<code>LoggerFactory</code>çš„<code>getLogger()</code>æ–¹æ³•å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title">getLogger</span><span class="params">(Class clazz)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> getLogger(clazz.getName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return a logger named according to the name parameter using the statically</span></span><br><span class="line"><span class="comment"> * bound &#123;<span class="doctag">@link</span> ILoggerFactory&#125; instance.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name The name of the logger.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> logger</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title">getLogger</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">  ILoggerFactory iLoggerFactory = getILoggerFactory();</span><br><span class="line">  <span class="keyword">return</span> iLoggerFactory.getLogger(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…·ä½“é€‰æ‹©é‚£ç§æ—¥å¿—å®ç°(e.g. java.util.logging, logback, log4j) å°±åœ¨ä»¥ä¸Šä»£ç ä¸­ <code>ILoggerFactory</code> æ¥å£çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ç€çœ‹<code>getILoggerFactory()</code>æ–¹æ³•çš„å…·ä½“å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ILoggerFactory <span class="title">getILoggerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (INITIALIZATION_STATE == UNINITIALIZED) &#123;</span><br><span class="line">      INITIALIZATION_STATE = ONGOING_INITIALIZATION;</span><br><span class="line">      performInitialization();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> (INITIALIZATION_STATE) &#123;</span><br><span class="line">      <span class="keyword">case</span> SUCCESSFUL_INITIALIZATION:</span><br><span class="line">        <span class="keyword">return</span> StaticLoggerBinder.getSingleton().getLoggerFactory();</span><br><span class="line">      <span class="keyword">case</span> NOP_FALLBACK_INITIALIZATION:</span><br><span class="line">        <span class="keyword">return</span> NOP_FALLBACK_FACTORY;</span><br><span class="line">      <span class="keyword">case</span> FAILED_INITIALIZATION:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(UNSUCCESSFUL_INIT_MSG);</span><br><span class="line">      <span class="keyword">case</span> ONGOING_INITIALIZATION:</span><br><span class="line">        <span class="comment">// support re-entrant behavior.</span></span><br><span class="line">        <span class="comment">// See also http://bugzilla.slf4j.org/show_bug.cgi?id=106</span></span><br><span class="line">        <span class="keyword">return</span> TEMP_FACTORY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unreachable code"</span>);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®debugæ‰§è¡Œï¼Œtomcat7å’Œtomcat8ä¸­éƒ½ä¼šæ‰§è¡Œåˆ°switchè¯­å¥ <code>SUCCESSFUL_INITIALIZATION</code> åˆ†æ”¯ä¸­ï¼Œå…¶ä¸­<code>StaticLoggerBinder</code>ç±»çš„å®ä¾‹ï¼Œå…¶ä¸­<code>StaticLoggerBinder</code>ä¸­çš„<code>loggerFactory</code>æ¥å£å±æ€§æŒ‡å‘äº†ä¸åŒçš„å®ç°ï¼ˆè¿™ä¹Ÿæ­£æ˜¯slf4jæ‰€è°“çš„å¤–è§‚(Facade)æ¨¡å¼ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„æ—¥å¿—è§£å†³æ–¹æ¡ˆï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹<code>LoggerFactory</code>åˆå§‹åŒ–æ—¶ç±»åŠ è½½å™¨å¯¹<code>org/slf4j/impl/StaticLoggerBinder.class</code>ç±»çš„åŠ è½½çš„éªŒè¯è¿‡ç¨‹ã€‚æˆ‘ä»¬çœ‹<code>performInitialization()</code>æ–¹æ³•çš„å®ç°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">performInitialization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    bind();</span><br><span class="line">    <span class="keyword">if</span> (INITIALIZATION_STATE == SUCCESSFUL_INITIALIZATION) &#123;</span><br><span class="line">      versionSanityCheck();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Set staticLoggerBinderPathSet = findPossibleStaticLoggerBinderPathSet();</span><br><span class="line">      reportMultipleBindingAmbiguity(staticLoggerBinderPathSet);</span><br><span class="line">      <span class="comment">// the next line does the binding</span></span><br><span class="line">      StaticLoggerBinder.getSingleton();</span><br><span class="line">      INITIALIZATION_STATE = SUCCESSFUL_INITIALIZATION;</span><br><span class="line">      reportActualBinding(staticLoggerBinderPathSet);</span><br><span class="line">      emitSubstituteLoggerWarning();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoClassDefFoundError ncde) &#123;</span><br><span class="line">      String msg = ncde.getMessage();</span><br><span class="line">      <span class="keyword">if</span> (messageContainsOrgSlf4jImplStaticLoggerBinder(msg)) &#123;</span><br><span class="line">        INITIALIZATION_STATE = NOP_FALLBACK_INITIALIZATION;</span><br><span class="line">        Util.report(<span class="string">"Failed to load class \"org.slf4j.impl.StaticLoggerBinder\"."</span>);</span><br><span class="line">        Util.report(<span class="string">"Defaulting to no-operation (NOP) logger implementation"</span>);</span><br><span class="line">        Util.report(<span class="string">"See "</span> + NO_STATICLOGGERBINDER_URL</span><br><span class="line">                + <span class="string">" for further details."</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        failedBinding(ncde);</span><br><span class="line">        <span class="keyword">throw</span> ncde;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (java.lang.NoSuchMethodError nsme) &#123;</span><br><span class="line">      String msg = nsme.getMessage();</span><br><span class="line">      <span class="keyword">if</span> (msg != <span class="keyword">null</span> &amp;&amp; msg.indexOf(<span class="string">"org.slf4j.impl.StaticLoggerBinder.getSingleton()"</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">        INITIALIZATION_STATE = FAILED_INITIALIZATION;</span><br><span class="line">        Util.report(<span class="string">"slf4j-api 1.6.x (or later) is incompatible with this binding."</span>);</span><br><span class="line">        Util.report(<span class="string">"Your binding is version 1.5.5 or earlier."</span>);</span><br><span class="line">        Util.report(<span class="string">"Upgrade your binding to version 1.6.x."</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">throw</span> nsme;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      failedBinding(e);</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unexpected initialization failure"</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Set <span class="title">findPossibleStaticLoggerBinderPathSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// use Set instead of list in order to deal with  bug #138</span></span><br><span class="line">    <span class="comment">// LinkedHashSet appropriate here because it preserves insertion order during iteration</span></span><br><span class="line">    Set staticLoggerBinderPathSet = <span class="keyword">new</span> LinkedHashSet();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      ClassLoader loggerFactoryClassLoader = LoggerFactory.class</span><br><span class="line">              .getClassLoader();</span><br><span class="line">      Enumeration paths;</span><br><span class="line">      <span class="keyword">if</span> (loggerFactoryClassLoader == <span class="keyword">null</span>) &#123;</span><br><span class="line">        paths = ClassLoader.getSystemResources(STATIC_LOGGER_BINDER_PATH);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        paths = loggerFactoryClassLoader</span><br><span class="line">                .getResources(STATIC_LOGGER_BINDER_PATH);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> (paths.hasMoreElements()) &#123;</span><br><span class="line">        URL path = (URL) paths.nextElement();</span><br><span class="line">        staticLoggerBinderPathSet.add(path);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException ioe) &#123;</span><br><span class="line">      Util.report(<span class="string">"Error getting resources from path"</span>, ioe);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> staticLoggerBinderPathSet;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>findPossibleStaticLoggerBinderPathSet()</code>æ–¹æ³•ä¸­æŸ¥æ‰¾æ‰€æœ‰åŠ è½½è¿‡çš„pathï¼Œç„¶åå°†å…¶æ”¾åˆ°ä¸€ä¸ªSetä¸­ï¼Œåœ¨åç»­çš„<code>reportMultipleBindingAmbiguity()</code>æ–¹æ³•ä¸­è¿›è¡ŒéªŒè¯æ‰“å°é”™è¯¯æ—¥å¿—ï¼Œtomcatæ—¥å¿—ä¸­æˆ‘ä»¬çœ‹åˆ°çš„æ—¥å¿—å°±æ˜¯è¿™ä¸ªæ–¹æ³•è¾“å‡ºçš„ã€‚è‡³æ­¤ï¼Œæºç åˆ†æå®Œæ¯•ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>çœŸæ­£æ²¡æœ‰è¾“å‡ºæ—¥å¿—çš„åŸå› æ˜¯å› ä¸º<code>Logger</code>å¼•ç”¨æŒ‡å‘çš„å®ç°ä¸æ˜¯<code>log4j</code>çš„å®ç°æ‰€å¯¼è‡´çš„ï¼Œå…¶ä¸­<code>LoggerFactory</code>ç±»åœ¨ç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œ<code>ClassLoader</code>å¯¹å¤šä¸ª<code>StaticLoggerBinder.class</code>æ–‡ä»¶çš„åŠ è½½é¡ºåºä¸åŒï¼Œå¯¼è‡´å®ç°çš„ä¸åŒã€‚</p><h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>æœ‰ä¸¤ç§æ€è·¯éƒ½è§£å†³äº†ï¼Œç¬¬äºŒç§æ›´ä¼˜é›…ã€‚</p><ol><li>å°è¯•å‡çº§<code>slf4j</code>ç‰ˆæœ¬å’Œ<code>slf4j-log4j</code>æ¡¥æ¥åŒ…ç‰ˆæœ¬ï¼Œä»1.7.9å‡çº§è‡³1.7.25ï¼Œé—®é¢˜è§£å†³ã€‚</li><li>ä¸å‡çº§ç‰ˆæœ¬ï¼Œè§£å†³ä¾èµ–å†²çªï¼Œæ‰¾åˆ°<code>slf4j-nop</code>åŒ…çš„mavenä¾èµ–æ¥æºï¼Œä»mvaenä¸­ä½¿ç”¨<code>&lt;exclusions&gt;</code>æ ‡ç­¾æ’é™¤ä¾èµ–ã€‚</li></ol><p><strong>mavenæ£€æŸ¥ä¾èµ–å†²çªæ–¹å¼:</strong><br>ä½¿ç”¨<code>mvn dependency:tree</code>æŸ¥çœ‹ä¾èµ–æ ‘ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[INFO] +- com.aliyun:aliyun-java-sdk-core:jar:2.1.9:compile</span><br><span class="line">[INFO] +- com.aliyun.oss:aliyun-sdk-oss:jar:2.0.5:compile</span><br><span class="line">[INFO] |  +- org.apache.httpcomponents:httpclient:jar:4.4:compile</span><br><span class="line">[INFO] |  |  \- org.apache.httpcomponents:httpcore:jar:4.4:compile</span><br><span class="line">[INFO] |  \- net.sf.json-lib:json-lib:jar:jdk15:2.4:compile</span><br><span class="line">[INFO] |     \- net.sf.ezmorph:ezmorph:jar:1.0.6:compile</span><br><span class="line">[INFO] +- com.aliyun.opensearch:aliyun-sdk-opensearch:jar:2.1.3:compile</span><br><span class="line">[INFO] |  +- org.apache.httpcomponents:httpmime:jar:4.3.1:compile</span><br><span class="line">[INFO] |  +- org.json:json:jar:20131018:compile</span><br><span class="line">[INFO] |  \- org.slf4j:slf4j-nop:jar:1.7.0:compile</span><br></pre></td></tr></table></figure><p><strong><em>å…¶ä¸­æœ€åä¸€è¡Œä¸ºæ‰¾åˆ°å†²çªåŒ…çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—ä¸è¾“å‡ºçš„ç½ªé­ç¥¸é¦–ï¼Œåœ¨<code>aliyun-sdk-opensearch:jar</code>åŒ…ä¸­ä¾èµ–ï¼Œæ‰€ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŠŠå®ƒå¹²æ‰ã€‚</em></strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.opensearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-opensearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-nop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œé—®é¢˜å®Œç¾è§£å†³ï¼Œ</p><h3 id="é—ç•™é—®é¢˜"><a href="#é—ç•™é—®é¢˜" class="headerlink" title="é—ç•™é—®é¢˜"></a>é—ç•™é—®é¢˜</h3><ol><li>tomcat7å’Œtomcat8çš„<code>ParallelWebappClassLoader</code>ç±»åŠ è½½å™¨çš„å®ç°æ–¹å¼æœ‰ä½•ä¸åŒï¼Ÿä¸ºä½•åŠ è½½é¡ºåºä¸åŒï¼Ÿï¼ˆ2018-2-26: è½¬ä¸€ç¯‡è®²ç±»åŠ è½½å™¨çš„ <a href="http://ifeve.com/classloader/" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œè®²çš„å¾ˆä¸é”™ï¼‰</li><li>åœ¨åŠ è½½åŒåç±»çš„æ—¶å€™ï¼ŒçœŸæ­£è¿è¡Œçš„æ˜¯å“ªä¸ªç±»æ˜¯å¦‚ä½•é€‰æ‹©çš„ï¼Ÿä¸ºä½•æ‰§è¡Œç¬¬ä¸€ä¸ªè¢«åŠ è½½çš„ç±»ï¼Ÿ</li></ol><h3 id="slf4jæºç çš„ä¸¤ç‚¹ä¸ªäººæ„Ÿå—"><a href="#slf4jæºç çš„ä¸¤ç‚¹ä¸ªäººæ„Ÿå—" class="headerlink" title="slf4jæºç çš„ä¸¤ç‚¹ä¸ªäººæ„Ÿå—"></a>slf4jæºç çš„ä¸¤ç‚¹ä¸ªäººæ„Ÿå—</h3><ol><li>ç¾¡æ…•å…¶ä»£ç çš„å‘½åè§„èŒƒã€åˆç†çš„ä»£ç æŠ½è±¡ã€æ¨¡å¼çš„è¿ç”¨ã€‚</li><li>ç¨‹åºå‘˜å°±è¦æœ‰å·¥åŒ ç²¾ç¥ï¼Œä»£ç ä¹Ÿæ˜¯ä¸€ç§è‰ºæœ¯å“ã€‚:)</li></ol><p>end</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;è¿‘æ—¥ï¼Œç”±äºå…¬å¸ç³»ç»Ÿæ¶æ„è°ƒæ•´ï¼Œå‘ç°tomcat8ä¸‹æ—¥å¿—è¾“å‡ºæœ‰é—®é¢˜ï¼Œä½†æ˜¯tomcat7æ²¡æœ‰é—®é¢˜ï¼Œå…¶ä¸­ä½†å‡¡å¼•ç”¨ &lt;code&gt;slf4j&lt;/code&gt; è¾“å‡ºçš„æ—¥å¿—éƒ½ä¸è¾“å‡ºäº†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;a href=&quot;#é—®é¢˜åˆ†æ&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜åˆ†æ&quot;&gt;&lt;/a&gt;é—®é¢˜åˆ†æ&lt;/h2&gt;&lt;p&gt;é¦–å…ˆï¼Œå®šä½é—®é¢˜ï¼Œç”±äºä»£ç æ²¡æœ‰åšè¿‡ä»»ä½•æ”¹åŠ¨ï¼Œæ‰€ä»¥ç›´æ¥å®šä½åˆ°tomcat7å’Œtomcat8å·®å¼‚å¼•èµ·çš„ï¼Œæ„Ÿè§‰åƒæ˜¯åŒ…å†²çªï¼Œæ‰€ä»¥æ²¿ç€è¿™ä¸ªæ€è·¯æ’æŸ¥é—®é¢˜ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="http://peierlong.com/categories/Java/"/>
    
    
      <category term="Java" scheme="http://peierlong.com/tags/Java/"/>
    
      <category term="Log" scheme="http://peierlong.com/tags/Log/"/>
    
      <category term="Tomcat" scheme="http://peierlong.com/tags/Tomcat/"/>
    
  </entry>
  
  <entry>
    <title>8Puzzleé—®é¢˜å®ç°ä¸è¸©å‘</title>
    <link href="http://peierlong.com/2018/01/22/8Puzzle%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94/"/>
    <id>http://peierlong.com/2018/01/22/8Puzzleé—®é¢˜è§£ç­”/</id>
    <published>2018-01-22T10:03:15.000Z</published>
    <updated>2019-03-13T02:32:01.032Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>8Puzzleé—®é¢˜ç®—æ³•ä½¿ç”¨<code>A*ç®—æ³•</code>ï¼Œæ•°æ®ç»“æ„ä¸»è¦æ˜¯<code>ä¼˜å…ˆé˜Ÿåˆ—</code>ã€‚</p></blockquote><a id="more"></a><h2 id="è¯„åˆ†ç³»ç»Ÿé”™è¯¯ä¿®å¤è®°å½•"><a href="#è¯„åˆ†ç³»ç»Ÿé”™è¯¯ä¿®å¤è®°å½•" class="headerlink" title="è¯„åˆ†ç³»ç»Ÿé”™è¯¯ä¿®å¤è®°å½•"></a>è¯„åˆ†ç³»ç»Ÿé”™è¯¯ä¿®å¤è®°å½•</h2><h3 id="Boardç±»toStringå®ç°ä¸¢å¤±éƒ¨åˆ†æ‰“å°"><a href="#Boardç±»toStringå®ç°ä¸¢å¤±éƒ¨åˆ†æ‰“å°" class="headerlink" title="Boardç±»toStringå®ç°ä¸¢å¤±éƒ¨åˆ†æ‰“å°"></a>Boardç±»toStringå®ç°ä¸¢å¤±éƒ¨åˆ†æ‰“å°</h3><p>æ—¥å¿—ï¼š</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fnpjrlwdv1j30jk0cw75h.jpg" alt></p><p>è§£å†³æ–¹æ¡ˆï¼Œæ·»åŠ å³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public String toString() &#123;</span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    sb.append(blocks.length).append(&quot;\n&quot;);</span><br><span class="line">    for (int[] block : blocks) &#123;</span><br><span class="line">        for (int j = 0; j &lt; blocks.length; j++) &#123;</span><br><span class="line">            sb.append(&quot; &quot;).append(block[j]);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(&quot;\n&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Boardç±»equals-å®ç°BUG"><a href="#Boardç±»equals-å®ç°BUG" class="headerlink" title="Boardç±»equals()å®ç°BUG"></a>Boardç±»equals()å®ç°BUG</h3><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fnpkq11bipj30zw0kcn0e.jpg" alt></p><p>æ·»åŠ å¯¹å¯¹è±¡çš„ç±»çš„åˆ¤æ–­ï¼Œæ·»åŠ åå³å¯ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public boolean equals(Object other) &#123;</span><br><span class="line">    if (other == null) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    if (other == this) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">    if (other.getClass() != this.getClass()) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    if (other instanceof Board) &#123;</span><br><span class="line">        Board that = (Board) other;</span><br><span class="line">        if (that.blocks.length != this.blocks.length) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for (int i = 0; i &lt; this.blocks.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; this.blocks.length; j++) &#123;</span><br><span class="line">                if (this.blocks[i][j] != that.blocks[i][j]) &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Boardç±»twin-å®ç°BUG"><a href="#Boardç±»twin-å®ç°BUG" class="headerlink" title="Boardç±»twin()å®ç°BUG"></a>Boardç±»twin()å®ç°BUG</h3><p>æ—¥å¿—ï¼š</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fnplkepjngj30hw0tw42i.jpg" alt></p><p>è§£å†³æ–¹æ¡ˆï¼Œswap è°ƒç”¨æ–¹é”™è¯¯ï¼Œä¿®æ”¹ä¸º board å¼•ç”¨å³å¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public Board twin() &#123;</span><br><span class="line">    Board board = new Board(blocks);</span><br><span class="line">    for (int i = 0; i &lt; blocks.length; i++) &#123;</span><br><span class="line">        for (int j = 0; j &lt; blocks.length - 1; j++) &#123;</span><br><span class="line">            if (board.blocks[i][j] != 0 &amp;&amp; board.blocks[i][j + 1] != 0) &#123;</span><br><span class="line">                board.swap(i, j, i, j + 1);</span><br><span class="line">                return board;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return board;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆï¼Œç»ˆäºè¯„åˆ†æ»¡åˆ†ã€‚</p><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fnplxwihmnj31f20d4q4s.jpg" alt></p><h2 id="å®Œæ•´å®ç°ä»£ç "><a href="#å®Œæ•´å®ç°ä»£ç " class="headerlink" title="å®Œæ•´å®ç°ä»£ç "></a>å®Œæ•´å®ç°ä»£ç </h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line">import edu.princeton.cs.algs4.Stack;</span><br><span class="line">import edu.princeton.cs.algs4.StdOut;</span><br><span class="line"></span><br><span class="line">public class Board &#123;</span><br><span class="line">    private final int[][] blocks;</span><br><span class="line"></span><br><span class="line">    // construct a board from an n-by-n array of blocks</span><br><span class="line">    // (where blocks[i][j] = block in row i, column j)</span><br><span class="line">    public Board(int[][] blocks) &#123;</span><br><span class="line">        this.blocks = new int[blocks.length][blocks.length];</span><br><span class="line">        for (int i = 0; i &lt; blocks.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; blocks.length; j++) &#123;</span><br><span class="line">                this.blocks[i][j] = blocks[i][j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // board dimension n</span><br><span class="line">    public int dimension() &#123;</span><br><span class="line">        return blocks.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // number of blocks out of place</span><br><span class="line">    public int hamming() &#123;</span><br><span class="line">        int hammingNumber = 0;</span><br><span class="line">        for (int i = 0; i &lt; blocks.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; blocks.length; j++) &#123;</span><br><span class="line">                if (blocks[i][j] != getGoalVal(i, j) &amp;&amp; !isEnd(i, j)) &#123;</span><br><span class="line">                    hammingNumber++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return hammingNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // sum of Manhattan distances between blocks and goal</span><br><span class="line">    public int manhattan() &#123;</span><br><span class="line">        int manhattanNumber = 0;</span><br><span class="line">        for (int i = 0; i &lt; blocks.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; blocks.length; j++) &#123;</span><br><span class="line">                int value = blocks[i][j];</span><br><span class="line">                if (value != 0 &amp;&amp; value != getGoalVal(i, j)) &#123;</span><br><span class="line">                    int ii = (value - 1) / blocks.length;</span><br><span class="line">                    int jj = value - ii * blocks.length - 1;</span><br><span class="line">                    int distance = Math.abs(i - ii) + Math.abs(j - jj);</span><br><span class="line">                    manhattanNumber += distance;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return manhattanNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // is this board the goal board?</span><br><span class="line">    public boolean isGoal() &#123;</span><br><span class="line">        if (blocks[blocks.length - 1][blocks.length - 1] != 0) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        for (int i = 0; i &lt; blocks.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; blocks.length; j++) &#123;</span><br><span class="line">                if (blocks[i][j] != getGoalVal(i, j)) &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // a board that is obtained by exchanging any pair of blocks</span><br><span class="line">    public Board twin() &#123;</span><br><span class="line">        Board board = new Board(blocks);</span><br><span class="line">        for (int i = 0; i &lt; blocks.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; blocks.length - 1; j++) &#123;</span><br><span class="line">                if (board.blocks[i][j] != 0 &amp;&amp; board.blocks[i][j + 1] != 0) &#123;</span><br><span class="line">                    board.swap(i, j, i, j + 1);</span><br><span class="line">                    return board;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return board;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // does this board equal y?</span><br><span class="line">    public boolean equals(Object other) &#123;</span><br><span class="line">        if (other == null) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if (other == this) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line">        if (other.getClass() != this.getClass()) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if (other instanceof Board) &#123;</span><br><span class="line">            Board that = (Board) other;</span><br><span class="line">            if (that.blocks.length != this.blocks.length) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">            for (int i = 0; i &lt; this.blocks.length; i++) &#123;</span><br><span class="line">                for (int j = 0; j &lt; this.blocks.length; j++) &#123;</span><br><span class="line">                    if (this.blocks[i][j] != that.blocks[i][j]) &#123;</span><br><span class="line">                        return false;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int getGoalVal(int i, int j) &#123;</span><br><span class="line">        if (isEnd(i, j)) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return i * blocks.length + j + 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean isEnd(int i, int j) &#123;</span><br><span class="line">        return i == blocks.length - 1 &amp;&amp; j == blocks.length - 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private boolean swap(int i, int j, int si, int sj) &#123;</span><br><span class="line">        if (si &lt; 0 || si &gt;= blocks.length || sj &lt; 0 || sj &gt;= blocks.length) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        int swap = blocks[i][j];</span><br><span class="line">        blocks[i][j] = blocks[si][sj];</span><br><span class="line">        blocks[si][sj] = swap;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // all neighboring boards</span><br><span class="line">    public Iterable&lt;Board&gt; neighbors() &#123;</span><br><span class="line">        int i0 = 0, j0 = 0;</span><br><span class="line">        boolean isFind = false;</span><br><span class="line">        for (int i = 0; i &lt; blocks.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; blocks.length; j++) &#123;</span><br><span class="line">                if (blocks[i][j] == 0) &#123;</span><br><span class="line">                    i0 = i;</span><br><span class="line">                    j0 = j;</span><br><span class="line">                    isFind = true;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            if (isFind) &#123;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;Board&gt; stack = new Stack&lt;&gt;();</span><br><span class="line">        Board board = new Board(blocks);</span><br><span class="line">        boolean isSwap = board.swap(i0, j0, i0 - 1, j0);</span><br><span class="line">        if (isSwap) &#123;</span><br><span class="line">            stack.push(board);</span><br><span class="line">        &#125;</span><br><span class="line">        board = new Board(blocks);</span><br><span class="line">        isSwap = board.swap(i0, j0, i0 + 1, j0);</span><br><span class="line">        if (isSwap) &#123;</span><br><span class="line">            stack.push(board);</span><br><span class="line">        &#125;</span><br><span class="line">        board = new Board(blocks);</span><br><span class="line">        isSwap = board.swap(i0, j0, i0, j0 - 1);</span><br><span class="line">        if (isSwap) &#123;</span><br><span class="line">            stack.push(board);</span><br><span class="line">        &#125;</span><br><span class="line">        board = new Board(blocks);</span><br><span class="line">        isSwap = board.swap(i0, j0, i0, j0 + 1);</span><br><span class="line">        if (isSwap) &#123;</span><br><span class="line">            stack.push(board);</span><br><span class="line">        &#125;</span><br><span class="line">        return stack;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // string representation of this board (in the output format specified below)</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        StringBuilder sb = new StringBuilder();</span><br><span class="line">        sb.append(blocks.length).append(&quot;\n&quot;);</span><br><span class="line">        for (int[] block : blocks) &#123;</span><br><span class="line">            for (int j = 0; j &lt; blocks.length; j++) &#123;</span><br><span class="line">                sb.append(&quot; &quot;).append(block[j]);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(&quot;\n&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // unit tests (not graded)</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        int[][] is = new int[3][3];</span><br><span class="line">        int start = 0;</span><br><span class="line">        for (int i = 0; i &lt; is.length; i++) &#123;</span><br><span class="line">            for (int j = 0; j &lt; is.length; j++) &#123;</span><br><span class="line">                is[i][j] = start++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Board board = new Board(is);</span><br><span class="line">        StdOut.println(board);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">import edu.princeton.cs.algs4.In;</span><br><span class="line">import edu.princeton.cs.algs4.MinPQ;</span><br><span class="line">import edu.princeton.cs.algs4.Stack;</span><br><span class="line">import edu.princeton.cs.algs4.StdOut;</span><br><span class="line"></span><br><span class="line">public class Solver &#123;</span><br><span class="line"></span><br><span class="line">    private final Stack&lt;Board&gt; boards;</span><br><span class="line">    private boolean isSolvable;</span><br><span class="line"></span><br><span class="line">    // find a solution to the initial board (using the A* algorithm)</span><br><span class="line">    public Solver(Board initial) &#123;</span><br><span class="line">        if (initial == null) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;args board is null&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        boards = new Stack&lt;&gt;();</span><br><span class="line">        if (initial.isGoal()) &#123;</span><br><span class="line">            isSolvable = true;</span><br><span class="line">            boards.push(initial);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        if (initial.twin().isGoal()) &#123;</span><br><span class="line">            isSolvable = false;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        MinPQ&lt;SearchNode&gt; minPQ = new MinPQ&lt;&gt;();</span><br><span class="line">        MinPQ&lt;SearchNode&gt; minPQTwin = new MinPQ&lt;&gt;();</span><br><span class="line">        Board board = initial;</span><br><span class="line">        Board boardTwin = initial.twin();</span><br><span class="line">        SearchNode node = new SearchNode(board, 0, null);</span><br><span class="line">        SearchNode nodeTwin = new SearchNode(boardTwin, 0, null);</span><br><span class="line">        minPQ.insert(node);</span><br><span class="line">        minPQTwin.insert(nodeTwin);</span><br><span class="line"></span><br><span class="line">        while (true) &#123;</span><br><span class="line">            node = minPQ.delMin();</span><br><span class="line">            nodeTwin = minPQTwin.delMin();</span><br><span class="line">            board = node.board;</span><br><span class="line">            boardTwin = nodeTwin.board;</span><br><span class="line">            if (board.isGoal()) &#123;</span><br><span class="line">                isSolvable = true;</span><br><span class="line">                boards.push(board);</span><br><span class="line">                while (node.previous != null) &#123;</span><br><span class="line">                    node = node.previous;</span><br><span class="line">                    boards.push(node.board);</span><br><span class="line">                &#125;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            if (boardTwin.isGoal()) &#123;</span><br><span class="line">                isSolvable = false;</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            node.moves++;</span><br><span class="line">            nodeTwin.moves++;</span><br><span class="line"></span><br><span class="line">            Iterable&lt;Board&gt; neighbors = board.neighbors();</span><br><span class="line">            for (Board b : neighbors) &#123;</span><br><span class="line">                if (node.previous != null &amp;&amp; node.previous.board.equals(b)) &#123;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                minPQ.insert(new SearchNode(b, node.moves, node));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Iterable&lt;Board&gt; neighborsTwin = boardTwin.neighbors();</span><br><span class="line">            for (Board b : neighborsTwin) &#123;</span><br><span class="line">                if (nodeTwin.previous != null &amp;&amp; nodeTwin.previous.board.equals(b)) &#123;</span><br><span class="line">                    continue;</span><br><span class="line">                &#125;</span><br><span class="line">                minPQTwin.insert(new SearchNode(b, nodeTwin.moves, nodeTwin));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // is the initial board solvable?</span><br><span class="line">    public boolean isSolvable() &#123;</span><br><span class="line">        return isSolvable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // min number of moves to solve initial board; -1 if unsolvable</span><br><span class="line">    public int moves() &#123;</span><br><span class="line">        if (isSolvable) &#123;</span><br><span class="line">            return boards.size() - 1;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // sequence of boards in a shortest solution; null if unsolvable</span><br><span class="line">    public Iterable&lt;Board&gt; solution() &#123;</span><br><span class="line">        if (isSolvable) &#123;</span><br><span class="line">            return boards;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private class SearchNode implements Comparable&lt;SearchNode&gt; &#123;</span><br><span class="line">        private Board board;</span><br><span class="line">        private int moves;</span><br><span class="line">        private SearchNode previous;</span><br><span class="line">        private int cachedPriority = -1;</span><br><span class="line"></span><br><span class="line">        public SearchNode(Board board, int moves, SearchNode previous) &#123;</span><br><span class="line">            this.board = board;</span><br><span class="line">            this.moves = moves;</span><br><span class="line">            this.previous = previous;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private int priority() &#123;</span><br><span class="line">            if (cachedPriority == -1) &#123;</span><br><span class="line">                cachedPriority = board.manhattan() + moves;</span><br><span class="line">            &#125;</span><br><span class="line">            return cachedPriority;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public int compareTo(SearchNode that) &#123;</span><br><span class="line">            return Integer.compare(this.priority(), that.priority());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // solve a slider puzzle (given below)</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // create initial board from file</span><br><span class="line">        In in = new In(args[0]);</span><br><span class="line">        int n = in.readInt();</span><br><span class="line">        int[][] blocks = new int[n][n];</span><br><span class="line">        for (int i = 0; i &lt; n; i++)</span><br><span class="line">            for (int j = 0; j &lt; n; j++)</span><br><span class="line">                blocks[i][j] = in.readInt();</span><br><span class="line">        Board initial = new Board(blocks);</span><br><span class="line"></span><br><span class="line">        // solve the puzzle</span><br><span class="line">        Solver solver = new Solver(initial);</span><br><span class="line"></span><br><span class="line">        // print solution to standard output</span><br><span class="line">        if (!solver.isSolvable())</span><br><span class="line">            StdOut.println(&quot;No solution possible&quot;);</span><br><span class="line">        else &#123;</span><br><span class="line">            StdOut.println(&quot;Minimum number of moves = &quot; + solver.moves());</span><br><span class="line">            for (Board board : solver.solution())</span><br><span class="line">                StdOut.println(board);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šï¼Œ8Puzzleå®ç°å®Œæˆã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;8Puzzleé—®é¢˜ç®—æ³•ä½¿ç”¨&lt;code&gt;A*ç®—æ³•&lt;/code&gt;ï¼Œæ•°æ®ç»“æ„ä¸»è¦æ˜¯&lt;code&gt;ä¼˜å…ˆé˜Ÿåˆ—&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Algorithms" scheme="http://peierlong.com/categories/Algorithms/"/>
    
    
      <category term="Algorithms" scheme="http://peierlong.com/tags/Algorithms/"/>
    
  </entry>
  
  <entry>
    <title>ç®—æ³•4å…¬å¼€è¯¾8-Puzzleç¼–ç¨‹é¢˜æ¦‚è¿°</title>
    <link href="http://peierlong.com/2018/01/18/%E7%AE%97%E6%B3%954%E5%85%AC%E5%BC%80%E8%AF%BE8Puzzle%E7%BC%96%E7%A8%8B%E9%A2%98%E6%A6%82%E8%BF%B0/"/>
    <id>http://peierlong.com/2018/01/18/ç®—æ³•4å…¬å¼€è¯¾8Puzzleç¼–ç¨‹é¢˜æ¦‚è¿°/</id>
    <published>2018-01-18T07:19:58.000Z</published>
    <updated>2019-03-13T02:32:01.044Z</updated>
    
    <content type="html"><![CDATA[<p>åŸé¢˜åœ°å€ï¼š<a href="http://coursera.cs.princeton.edu/algs4/assignments/8puzzle.html" target="_blank" rel="noopener">http://coursera.cs.princeton.edu/algs4/assignments/8puzzle.html</a></p><p>æœ¬æ–‡ä¸»è¦é’ˆå¯¹åŸé¢˜åšä¸€ä¸ªç®€å•çš„æ¦‚è¿°ï¼Œç›®çš„æ˜¯ç†è§£8-Puzzleé—®é¢˜ï¼Œä»¥ä¾¿æ–¹ä¾¿è‡ªå·±æ—¥åæŸ¥çœ‹ã€‚æœ‰çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥å‘é‚®ä»¶ä¸€èµ·äº¤æµã€‚è‹±æ–‡é˜…è¯»èƒ½åŠ›å¼ºè¯·å¿½ç•¥æœ¬æ–‡ç›´æ¥å»åŸæ–‡ã€‚</p><h2 id="The-problem"><a href="#The-problem" class="headerlink" title="The problem"></a>The problem</h2><p><code>8-Puzzle</code>é—®é¢˜æ˜¯Noyes Palmer Chapmanåœ¨1870å¹´å‘æ˜å’Œæ¨å¹¿çš„ä¸€ä¸ªéš¾é¢˜ï¼Œåœ¨ä¸€ä¸ª<code>3*3</code>çš„ç½‘ç»œæ ¼å­ä¸Šæ”¾ç€<code>1~8</code>å’Œä¸€ä¸ªç©ºç™½ä½ï¼Œéœ€è¦å®ç°çš„ç›®æ ‡å°±æ˜¯ä½¿ç”¨æœ€å°‘çš„æ­¥æ•°ï¼Œå¯¹<code>1~8</code>è¿›è¡Œæ’åºå¹¶ä½¿ç©ºç™½ä½åœ¨æœ€åä¸€æ ¼ä¸­ï¼Œåªå…è®¸å°†æ•°å­—å—æ¨ªå‘å’Œçºµå‘ç§»å…¥ç©ºç™½å—ï¼Œä»¥ä¸‹ä¸ºå›¾ä¾‹ï¼š</p><a id="more"></a><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fnkssf10hjj30ww05mgm3.jpg" alt="8-Puzzle problem"></p><h2 id="æœ€ä½³ä¼˜å…ˆæœç´¢-Best-first-search"><a href="#æœ€ä½³ä¼˜å…ˆæœç´¢-Best-first-search" class="headerlink" title="æœ€ä½³ä¼˜å…ˆæœç´¢(Best-first search)"></a>æœ€ä½³ä¼˜å…ˆæœç´¢(Best-first search)</h2><p>æˆ‘ä»¬é¦–å…ˆæè¿°ä¸€ä¸ªè§£å†³é—®é¢˜çš„é€šç”¨çš„äººå·¥æ™ºèƒ½çš„æ–¹æ³•<strong>A*æœç´¢ç®—æ³•</strong>ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ¸¸æˆçš„æœç´¢èŠ‚ç‚¹Boardï¼Œè¯¥èŠ‚ç‚¹æ¿ä¸ºè¾¾åˆ°æ£‹ç›˜æ‰€åšçš„ç§»åŠ¨æ¬¡æ•°ï¼Œä»¥åŠå‰ä»»æœç´¢èŠ‚ç‚¹ã€‚é¦–å…ˆï¼Œæ’å…¥ä¸€ä¸ªåˆå§‹åŒ–çš„æœç´¢èŠ‚ç‚¹ï¼ˆè¯¥åˆå§‹æ¿ï¼Œ0 movesï¼Œå‰ä»»æœç´¢èŠ‚ç‚¹ä¸º nullï¼‰è¿›å…¥ä¼˜å…ˆé˜Ÿåˆ—ã€‚ç„¶åï¼Œä»ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­åˆ é™¤å…·æœ‰æœ€ä½ä¼˜å…ˆçº§çš„æœç´¢èŠ‚ç‚¹ï¼Œå¹¶ä¸”å°†æ‰€æœ‰ç›¸é‚»æœç´¢èŠ‚ç‚¹ï¼ˆä»å‡ºåˆ—çš„æœç´¢èŠ‚ç‚¹ä¸€æ¬¡å¯è¾¾çš„èŠ‚ç‚¹ï¼‰æ’å…¥åˆ°ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹çŸ¥é“å‡ºåˆ—çš„æœç´¢èŠ‚ç‚¹ä¸ç›®æ ‡æ¿ä¸€è‡´ã€‚è¿™ç§æ–¹æ³•çš„æˆåŠŸå–å†³äºå¯¹æœç´¢èŠ‚ç‚¹çš„ä¼˜å…ˆçº§å‡½æ•°é€‰æ‹©ã€‚æˆ‘ä»¬è®¤ä¸ºæœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜å…ˆçº§å‡½æ•°ï¼š</p><ul><li><em>Hamming priority function.</em> å…·æœ‰é”™è¯¯ä½ç½®çš„å—çš„æ•°é‡åŠ ä¸Šåˆ°ç›®å‰ä¸ºæ­¢ç§»åŠ¨åˆ°è¾¾æœç´¢èŠ‚ç‚¹çš„æ•°é‡ã€‚ç›´è§‚çš„è®²ï¼Œå…·æœ‰é”™è¯¯ä½ç½®ä¸Šçš„å°‘é‡å—çš„æœç´¢èŠ‚ç‚¹æ›´æ¥è¿‘ç›®æ ‡ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¼˜é€‰ä½¿ç”¨å°‘é‡ç§»åŠ¨å·²ç»åˆ°è¾¾çš„æœç´¢èŠ‚ç‚¹ã€‚</li><li><em>Manhattan priority function.</em> æ‰€æœ‰å—åˆ°ç›®æ ‡å—çš„æ›¼å“ˆé¡¿è·ç¦»ï¼ˆå‚ç›´å’Œæ°´å¹³çš„è·ç¦»ä¹‹å’Œï¼‰çš„å’ŒåŠ ä¸Šåˆ°ç›®å‰ä¸ºæ­¢ç§»åŠ¨åˆ°è¾¾æœç´¢èŠ‚ç‚¹çš„æ•°é‡ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fnku7fs7ihj30zs05qwf6.jpg" alt></p><p>æˆ‘ä»¬åšä¸€ä¸ªå…³é”®çš„è§‚å¯Ÿï¼šè§£å†³ Puzzle ä»ç»™å®šä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—çš„æœç´¢èŠ‚ç‚¹å¼€å§‹ï¼Œæˆ‘ä»¬éœ€è¦åšçš„ç§»åŠ¨çš„æ€»æ¬¡æ•°ï¼ˆåŒ…å«å·²ç»åšå‡ºçš„åŠ¨ä½œï¼‰è‡³å°‘æ˜¯å…¶ä¼˜å…ˆçº§ï¼Œä½¿ç”¨æ±‰æ˜æˆ–å“ˆæ›¼é¡¿ä¼˜å…ˆçº§å‡½æ•°ã€‚ï¼ˆå¯¹äºæ±‰æ˜è€Œè¨€ï¼Œæ¯ä¸ªä¸€ä¸ªè‡³å°‘éœ€è¦ç§»åŠ¨ä¸€æ¬¡åˆ°è¾¾å®ƒçš„ç›®æ ‡ä½ç½®ã€‚å¯¹äºå“ˆæ›¼é¡¿è€Œè¨€ï¼Œæ¯ä¸€ä¸ªè‡³å°‘ç§»åŠ¨å“ˆæ›¼é¡¿è·ç¦»æ¥åˆ°è¾¾å®ƒçš„ç›®æ ‡ä½ç½®ã€‚åœ¨è®¡ç®—æ±‰æ˜å’Œå“ˆæ›¼é¡¿çš„ä¼˜å…ˆæ¬¡åºæ—¶ï¼Œä¸è¦è®¡ç®—ç©ºç™½çš„æ–¹æ ¼ã€‚ï¼‰å› æ­¤ï¼Œå½“ç›®æ ‡æ¿å‡ºé˜Ÿæ—¶ï¼Œæˆ‘ä»¬ä¸ä»…å‘ç°ä»åˆå§‹æ¿åˆ°ç›®æ ‡æ¿çš„ä¸€ç³»åˆ—ç§»åŠ¨ï¼Œè€Œä¸”è¿˜å‘ç°äº†æœ€å°‘çš„ç§»åŠ¨æ¬¡æ•°ã€‚</p><h2 id="ä¸€ä¸ªå…³é”®çš„ä¼˜åŒ–"><a href="#ä¸€ä¸ªå…³é”®çš„ä¼˜åŒ–" class="headerlink" title="ä¸€ä¸ªå…³é”®çš„ä¼˜åŒ–"></a>ä¸€ä¸ªå…³é”®çš„ä¼˜åŒ–</h2><p>æœ€ä½³ä¼˜å…ˆæœç´¢æœ‰ä¸€ä¸ªéå¸¸æ“è›‹çš„ç‰¹æ€§ï¼Œæœç´¢èŠ‚ç‚¹å¯¹åº”çš„æ¿å—å…¥é˜Ÿåˆ°ä¼˜å…ˆé˜Ÿåˆ—å¤šæ¬¡ï¼Œä¸ºäº†å‡å°‘å¯¹ä¸å¿…è¦çš„æœç´¢èŠ‚ç‚¹çš„æ¢ç´¢ï¼Œå½“æˆ‘ä»¬å¯¹ç›¸é‚»çš„æœç´¢èŠ‚ç‚¹å…¥é˜Ÿæ—¶ï¼Œä¸è¦å¯¹ç›¸é‚»èŠ‚ç‚¹å’Œå‰ä»»èŠ‚ç‚¹ç›¸åŒçš„board è¿›è¡Œå…¥é˜Ÿæ“ä½œã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fnkvbs3z11j30w0068aar.jpg" alt></p><h2 id="ç¬¬äºŒä¸ªä¼˜åŒ–"><a href="#ç¬¬äºŒä¸ªä¼˜åŒ–" class="headerlink" title="ç¬¬äºŒä¸ªä¼˜åŒ–"></a>ç¬¬äºŒä¸ªä¼˜åŒ–</h2><p>ä¸ºäº†é¿å…æ¯æ¬¡åœ¨å„ç§ä¼˜å…ˆçº§é˜Ÿåˆ—æ„å»ºæ—¶é‡æ–°è®¡ç®—å“ˆæ›¼é¡¿ä¼˜å…ˆçº§ï¼Œåœ¨æ„å»ºæœç´¢èŠ‚ç‚¹æ—¶é¢„å…ˆè®¡ç®—å…¶å€¼ï¼Œå°†å…¶ä¿å­˜åœ¨å¸¸é‡ä¸­ï¼Œåœ¨éœ€è¦çš„æ—¶å€™è¿”å›ã€‚è¿™ç§ç¼“å­˜æŠ€æœ¯æ˜¯å¹¿æ³›é€‚ç”¨çš„ï¼šè€ƒè™‘åœ¨å¤šæ¬¡è®¡ç®—ç›¸åŒæ•°é‡çš„æƒ…å†µä¸‹ä½¿ç”¨å®ƒï¼Œå¹¶ä¸”è®¡ç®—è¯¥æ•°é‡æ—¶ç“¶é¢ˆæ“ä½œã€‚</p><h2 id="åšå¼ˆæ ‘ï¼ˆGame-Treeï¼‰"><a href="#åšå¼ˆæ ‘ï¼ˆGame-Treeï¼‰" class="headerlink" title="åšå¼ˆæ ‘ï¼ˆGame Treeï¼‰"></a>åšå¼ˆæ ‘ï¼ˆGame Treeï¼‰</h2><p>æŸ¥çœ‹è®¡ç®—çš„ä¸€ç§æ–¹æ³•æ˜¯ä½œä¸ºåšå¼ˆæ ‘ï¼Œå…¶ä¸­æ¯ä¸ªæœç´¢èŠ‚ç‚¹æ—¶åšå¼ˆæ ‘ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¯¹åº”äºå…¶ç›¸é‚»æœç´¢èŠ‚ç‚¹ã€‚åšå¼ˆæ ‘çš„æ ¹èŠ‚ç‚¹æ˜¯åˆå§‹èŠ‚ç‚¹ï¼Œå†…éƒ¨èŠ‚ç‚¹å·²ç»è¢«å¤„ç†ï¼Œå¶èŠ‚ç‚¹ä¿æŒåœ¨ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ï¼Œåœ¨æ¯ä¸€æ­¥ä¸­ï¼ŒA*æœç´¢ç®—æ³•ä»ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­åˆ é™¤å…·æœ‰æœ€å°ä¼˜å…ˆçº§çš„èŠ‚ç‚¹å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†ï¼ˆé€šè¿‡å°†å…¶å­èŠ‚ç‚¹æ·»åŠ åˆ°åšå¼ˆæ ‘å’Œä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ï¼‰ã€‚</p><p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fnkw75o1laj319g0rgwhq.jpg" alt></p><h2 id="æ£€æµ‹ä¸èƒ½è§£å†³çš„Puzzles"><a href="#æ£€æµ‹ä¸èƒ½è§£å†³çš„Puzzles" class="headerlink" title="æ£€æµ‹ä¸èƒ½è§£å†³çš„Puzzles"></a>æ£€æµ‹ä¸èƒ½è§£å†³çš„Puzzles</h2><p>ä¸æ˜¯æ‰€æœ‰çš„åˆå§‹ borad é€šè¿‡åˆæ³•çš„ç§»åŠ¨æ¬¡æ•°ï¼ŒåŒ…å«ä»¥ä¸‹ï¼š</p><p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fnkxama9p4j30f6064mxf.jpg" alt></p><p>è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„æ€§è´¨ï¼š8-puzzleé—®é¢˜ä¸­å‡¡æ˜¯æ— è§£çš„å›¾ï¼Œå°†é™¤äº†ç©ºç™½æ ä¹‹å¤–çš„ä»»æ„ä¸¤ä¸ªæ ¼å­äº¤æ¢ï¼Œéƒ½èƒ½å¾—åˆ°å¯è§£å›¾ã€‚è€Œå¯è§£å›¾é€šè¿‡ä¸€æ¬¡äº¤æ¢å¾—åˆ°çš„æ˜¯æ— è§£å›¾ã€‚<br>è¯æ˜ä¸æ˜¯çœ‹çš„å¾ˆæ‡‚ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»è¿™ä¸ªç½‘ç«™çœ‹çœ‹ï¼š<a href="http://www.cs.bham.ac.uk/~mdr/teaching/modules04/java2/TilesSolvability.html" target="_blank" rel="noopener">http://www.cs.bham.ac.uk/~mdr/teaching/modules04/java2/TilesSolvability.html</a></p><h2 id="Board-and-Solver-API"><a href="#Board-and-Solver-API" class="headerlink" title="Board and Solver API"></a>Board and Solver API</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Board &#123;</span><br><span class="line">    public Board(int[][] blocks)           // construct a board from an n-by-n array of blocks</span><br><span class="line">                                           // (where blocks[i][j] = block in row i, column j)</span><br><span class="line">    public int dimension()                 // board dimension n</span><br><span class="line">    public int hamming()                   // number of blocks out of place</span><br><span class="line">    public int manhattan()                 // sum of Manhattan distances between blocks and goal</span><br><span class="line">    public boolean isGoal()                // is this board the goal board?</span><br><span class="line">    public Board twin()                    // a board that is obtained by exchanging any pair of blocks</span><br><span class="line">    public boolean equals(Object y)        // does this board equal y?</span><br><span class="line">    public Iterable&lt;Board&gt; neighbors()     // all neighboring boards</span><br><span class="line">    public String toString()               // string representation of this board (in the output format specified below)</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) // unit tests (not graded)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class Solver &#123;</span><br><span class="line">    public Solver(Board initial)           // find a solution to the initial board (using the A* algorithm)</span><br><span class="line">    public boolean isSolvable()            // is the initial board solvable?</span><br><span class="line">    public int moves()                     // min number of moves to solve initial board; -1 if unsolvable</span><br><span class="line">    public Iterable&lt;Board&gt; solution()      // sequence of boards in a shortest solution; null if unsolvable</span><br><span class="line">    public static void main(String[] args) // solve a slider puzzle (given below)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Solveræµ‹è¯•ç”¨ä¾‹"><a href="#Solveræµ‹è¯•ç”¨ä¾‹" class="headerlink" title="Solveræµ‹è¯•ç”¨ä¾‹"></a>Solveræµ‹è¯•ç”¨ä¾‹</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">    // create initial board from file</span><br><span class="line">    In in = new In(args[0]);</span><br><span class="line">    int n = in.readInt();</span><br><span class="line">    int[][] blocks = new int[n][n];</span><br><span class="line">    for (int i = 0; i &lt; n; i++)</span><br><span class="line">        for (int j = 0; j &lt; n; j++)</span><br><span class="line">            blocks[i][j] = in.readInt();</span><br><span class="line">    Board initial = new Board(blocks);</span><br><span class="line"></span><br><span class="line">    // solve the puzzle</span><br><span class="line">    Solver solver = new Solver(initial);</span><br><span class="line"></span><br><span class="line">    // print solution to standard output</span><br><span class="line">    if (!solver.isSolvable())</span><br><span class="line">        StdOut.println(&quot;No solution possible&quot;);</span><br><span class="line">    else &#123;</span><br><span class="line">        StdOut.println(&quot;Minimum number of moves = &quot; + solver.moves());</span><br><span class="line">        for (Board board : solver.solution())</span><br><span class="line">            StdOut.println(board);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¾“å‡ºç¤ºä¾‹"><a href="#è¾“å‡ºç¤ºä¾‹" class="headerlink" title="è¾“å‡ºç¤ºä¾‹"></a>è¾“å‡ºç¤ºä¾‹</h2><p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fnpizjunxjj30ok1060us.jpg" alt></p><h2 id="äº¤ä»˜å’Œå¯ä½¿ç”¨çš„åŒ…"><a href="#äº¤ä»˜å’Œå¯ä½¿ç”¨çš„åŒ…" class="headerlink" title="äº¤ä»˜å’Œå¯ä½¿ç”¨çš„åŒ…"></a>äº¤ä»˜å’Œå¯ä½¿ç”¨çš„åŒ…</h2><p>éœ€è¦æäº¤æ–‡ä»¶<code>Board.java</code>å’Œ<code>Solver.java</code>ï¼Œæ”¯æŒå®˜æ–¹<code>args4.jar</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>java.lang</code> <code>java.util</code>ï¼Œå¿…é¡»ä½¿ç”¨args4.jarä¸­çš„<code>MinQP</code>ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚</p><p>ä»¥ä¸Šï¼Œ8Puzzleé—®é¢˜æ¦‚è¿°å®Œæ¯•ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;åŸé¢˜åœ°å€ï¼š&lt;a href=&quot;http://coursera.cs.princeton.edu/algs4/assignments/8puzzle.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://coursera.cs.princeton.edu/algs4/assignments/8puzzle.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦é’ˆå¯¹åŸé¢˜åšä¸€ä¸ªç®€å•çš„æ¦‚è¿°ï¼Œç›®çš„æ˜¯ç†è§£8-Puzzleé—®é¢˜ï¼Œä»¥ä¾¿æ–¹ä¾¿è‡ªå·±æ—¥åæŸ¥çœ‹ã€‚æœ‰çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„å°ä¼™ä¼´ä¹Ÿå¯ä»¥å‘é‚®ä»¶ä¸€èµ·äº¤æµã€‚è‹±æ–‡é˜…è¯»èƒ½åŠ›å¼ºè¯·å¿½ç•¥æœ¬æ–‡ç›´æ¥å»åŸæ–‡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;The-problem&quot;&gt;&lt;a href=&quot;#The-problem&quot; class=&quot;headerlink&quot; title=&quot;The problem&quot;&gt;&lt;/a&gt;The problem&lt;/h2&gt;&lt;p&gt;&lt;code&gt;8-Puzzle&lt;/code&gt;é—®é¢˜æ˜¯Noyes Palmer Chapmanåœ¨1870å¹´å‘æ˜å’Œæ¨å¹¿çš„ä¸€ä¸ªéš¾é¢˜ï¼Œåœ¨ä¸€ä¸ª&lt;code&gt;3*3&lt;/code&gt;çš„ç½‘ç»œæ ¼å­ä¸Šæ”¾ç€&lt;code&gt;1~8&lt;/code&gt;å’Œä¸€ä¸ªç©ºç™½ä½ï¼Œéœ€è¦å®ç°çš„ç›®æ ‡å°±æ˜¯ä½¿ç”¨æœ€å°‘çš„æ­¥æ•°ï¼Œå¯¹&lt;code&gt;1~8&lt;/code&gt;è¿›è¡Œæ’åºå¹¶ä½¿ç©ºç™½ä½åœ¨æœ€åä¸€æ ¼ä¸­ï¼Œåªå…è®¸å°†æ•°å­—å—æ¨ªå‘å’Œçºµå‘ç§»å…¥ç©ºç™½å—ï¼Œä»¥ä¸‹ä¸ºå›¾ä¾‹ï¼š&lt;/p&gt;
    
    </summary>
    
      <category term="Algorithms" scheme="http://peierlong.com/categories/Algorithms/"/>
    
    
      <category term="Algorithms" scheme="http://peierlong.com/tags/Algorithms/"/>
    
  </entry>
  
  <entry>
    <title>å †æ’åº(HeapSort)å®ç°</title>
    <link href="http://peierlong.com/2017/12/26/%E5%A0%86%E6%8E%92%E5%BA%8F(HeapSort)-%E5%AE%9E%E7%8E%B0/"/>
    <id>http://peierlong.com/2017/12/26/å †æ’åº(HeapSort)-å®ç°/</id>
    <published>2017-12-26T03:36:00.000Z</published>
    <updated>2019-03-13T02:32:01.042Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å †æ’åºå®ç°æ€è·¯"><a href="#å †æ’åºå®ç°æ€è·¯" class="headerlink" title="å †æ’åºå®ç°æ€è·¯"></a>å †æ’åºå®ç°æ€è·¯</h2><p>å †æ’åºæ˜¯åŸºäºäºŒå‰å †æ•°æ®ç»“æ„å®ç°çš„æ’åºç®—æ³•ï¼Œæ’åºæ€è·¯éå¸¸ç®€å•ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤æ­¥ã€‚</p><a id="more"></a><p><strong>ç¬¬ä¸€æ­¥ï¼šå¯¹Nä¸ªå…ƒç´ æ„å»º max-heap æ•°æ®ç»“æ„</strong></p><p>é€†åºå¯¹æ‰€æœ‰äºŒå‰å­æ ‘çš„çˆ¶çº§è¿›è¡Œä¸‹æ²‰æ“ä½œï¼ŒäºŒå‰å­æ ‘çš„æœ€å¤§çˆ¶çº§å…ƒç´ ä¸º<code>n/2</code>ã€‚  </p><p><strong>ç¬¬äºŒæ­¥ï¼šå¯¹æœ€å¤§å…ƒç´ æ›¿æ¢ç§»é™¤</strong></p><p>æŠŠæ ¹å…ƒç´ å’Œå°¾å…ƒç´ è¿›è¡Œæ›¿æ¢æ“ä½œï¼Œç„¶åé•¿åº¦è®¡æ•°å™¨å»æ‰å°¾å…ƒç´ çš„ç´¢å¼•ï¼Œå¹¶å¯¹æ ¹å…ƒç´ è¿›è¡Œä¸‹æ²‰æ“ä½œã€‚</p><h2 id="Javaå®ç°ä»£ç "><a href="#Javaå®ç°ä»£ç " class="headerlink" title="Javaå®ç°ä»£ç "></a>Javaå®ç°ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeapSort</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] pq)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = pq.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span>; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">            sink(pq, i, n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            exch(pq, <span class="number">1</span>, n);</span><br><span class="line">            sink(pq, <span class="number">1</span>, --n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å †å…ƒç´ ä¸‹æ²‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sink</span><span class="params">(Comparable[] pq, <span class="keyword">int</span> k, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= n) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = <span class="number">2</span> * k;</span><br><span class="line">            <span class="keyword">if</span> (j &lt; n &amp;&amp; less(pq, j, j + <span class="number">1</span>)) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!less(pq, k, j)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            exch(pq, j, k);</span><br><span class="line">            k = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ¤æ–­iå…ƒç´ æ˜¯å¦å°äºjå…ƒç´ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">less</span><span class="params">(Comparable[] pq, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pq[i - <span class="number">1</span>].compareTo(pq[j - <span class="number">1</span>]) &lt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ›¿æ¢æ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exch</span><span class="params">(Comparable[] pq, <span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        Comparable swap = pq[i - <span class="number">1</span>];</span><br><span class="line">        pq[i - <span class="number">1</span>] = pq[j - <span class="number">1</span>];</span><br><span class="line">        pq[j - <span class="number">1</span>] = swap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer[] a = &#123;<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">23</span>, <span class="number">54</span>, <span class="number">75</span>, <span class="number">1</span>, <span class="number">88</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">54</span>, <span class="number">78</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">11</span>, <span class="number">991</span>, <span class="number">765</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">49</span>, <span class="number">81</span>, <span class="number">80</span>&#125;;</span><br><span class="line">        HeapSort.sort(a);</span><br><span class="line">        <span class="keyword">for</span> (Integer i : a) &#123;</span><br><span class="line">            StdOut.print(i + <span class="string">" "</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¸ªäººé‡åˆ°çš„æ’åºé€»è¾‘éš¾ç‚¹"><a href="#ä¸ªäººé‡åˆ°çš„æ’åºé€»è¾‘éš¾ç‚¹" class="headerlink" title="ä¸ªäººé‡åˆ°çš„æ’åºé€»è¾‘éš¾ç‚¹"></a>ä¸ªäººé‡åˆ°çš„æ’åºé€»è¾‘éš¾ç‚¹</h2><ol><li>ä¸‹æ²‰æ“ä½œçš„å¾ªç¯å¦‚ä½•åˆ¤æ–­ï¼Ÿç­”ï¼šåˆ¤æ–­å­æ ‘æ˜¯å¦å°äºç­‰äºæ ‘é•¿</li><li>ä¸‹æ²‰æ“ä½œçš„ä¸¤ä¸ªå­æ ‘ç´¢å¼•çš„åˆ¤æ–­ï¼Ÿç­”ï¼šå¦‚ç¨‹åºä¸­åˆ¤æ–­ã€‚</li><li>less()æ–¹æ³•ä¸ºä½•æŠ¥æ•°ç»„è¶Šç•Œå¼‚å¸¸ï¼Ÿç­”ï¼šå› ä¸ºäºŒå‰å †çš„æ ¹å…ƒç´ çš„ç´¢å¼•æ˜¯ä»1å¼€å§‹çš„ï¼Œæ‰€ä»¥åšæ•°æ®æ“ä½œæ—¶éœ€è¦å¯¹ç´¢å¼•å‡1ã€‚</li></ol><p>ä»¥ä¸Šå †æ’åºå®Œæˆï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å †æ’åºå®ç°æ€è·¯&quot;&gt;&lt;a href=&quot;#å †æ’åºå®ç°æ€è·¯&quot; class=&quot;headerlink&quot; title=&quot;å †æ’åºå®ç°æ€è·¯&quot;&gt;&lt;/a&gt;å †æ’åºå®ç°æ€è·¯&lt;/h2&gt;&lt;p&gt;å †æ’åºæ˜¯åŸºäºäºŒå‰å †æ•°æ®ç»“æ„å®ç°çš„æ’åºç®—æ³•ï¼Œæ’åºæ€è·¯éå¸¸ç®€å•ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ä¸¤æ­¥ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="Algorithms" scheme="http://peierlong.com/categories/Algorithms/"/>
    
    
      <category term="Algorithms" scheme="http://peierlong.com/tags/Algorithms/"/>
    
  </entry>
  
  <entry>
    <title>ä¼˜å…ˆé˜Ÿåˆ—(PriorityQueues)ä¸äºŒå‰å †æ•°æ®ç»“æ„</title>
    <link href="http://peierlong.com/2017/12/25/%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97(PriorityQueues)%E4%B8%8E%E4%BA%8C%E5%8F%89%E5%A0%86%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <id>http://peierlong.com/2017/12/25/ä¼˜å…ˆé˜Ÿåˆ—(PriorityQueues)ä¸äºŒå‰å †æ•°æ®ç»“æ„/</id>
    <published>2017-12-25T09:55:20.000Z</published>
    <updated>2019-03-13T02:32:01.041Z</updated>
    
    <content type="html"><![CDATA[<h2 id="äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨"><a href="#äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨" class="headerlink" title="äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨"></a>äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨</h2><p>æ¥è‡ªwiki: <a href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E5%A0%86" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E5%A0%86</a></p><blockquote><p>äºŒå‰å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„å †ï¼ŒäºŒå‰å †æ˜¯å®Œå…¨äºŒå‰æ ‘æˆ–è€…æ˜¯è¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘ã€‚</p><p>äºŒå‰å †æ»¡è¶³å †ç‰¹æ€§ï¼šçˆ¶èŠ‚ç‚¹çš„é”®å€¼æ€»æ˜¯ä¿æŒå›ºå®šçš„åºå…³ç³»äºä»»ä½•ä¸€ä¸ªå­èŠ‚ç‚¹çš„é”®å€¼ï¼Œä¸”æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯ä¸€ä¸ªäºŒå‰å †ã€‚</p></blockquote><a id="more"></a><h2 id="ä¼˜å…ˆé˜Ÿåˆ—å®šä¹‰"><a href="#ä¼˜å…ˆé˜Ÿåˆ—å®šä¹‰" class="headerlink" title="ä¼˜å…ˆé˜Ÿåˆ—å®šä¹‰"></a>ä¼˜å…ˆé˜Ÿåˆ—å®šä¹‰</h2><p>æ¥è‡ªwiki: <a href="https://zh.wikipedia.org/wiki/%E5%84%AA%E5%85%88%E4%BD%87%E5%88%97" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%84%AA%E5%85%88%E4%BD%87%E5%88%97</a></p><blockquote><p>ä¼˜å…ˆé˜Ÿåˆ—æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ç±»æŠ½è±¡æ•°æ®ç±»å‹ã€‚ä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰å„è‡ªçš„ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ æœ€å…ˆå¾—åˆ°æœåŠ¡ï¼›ä¼˜å…ˆçº§ç›¸åŒçš„å…ƒç´ æŒ‰ç…§å…¶åœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„é¡ºåºå¾—åˆ°æœåŠ¡ã€‚ä¼˜å…ˆé˜Ÿåˆ—å¾€å¾€ç”¨å †æ¥å®ç°ã€‚</p></blockquote><h2 id="æœ€å¤§å€¼äºŒå‰å †å®ç°æ€è·¯å¤‡å¿˜"><a href="#æœ€å¤§å€¼äºŒå‰å †å®ç°æ€è·¯å¤‡å¿˜" class="headerlink" title="æœ€å¤§å€¼äºŒå‰å †å®ç°æ€è·¯å¤‡å¿˜"></a>æœ€å¤§å€¼äºŒå‰å †å®ç°æ€è·¯å¤‡å¿˜</h2><ul><li>æ ¹èŠ‚ç‚¹æ˜¯æ•´æ£µæ ‘çš„æœ€å¤§çš„å€¼ã€‚</li><li>å‡è®¾æŸèŠ‚ç‚¹çš„indexä¸º<code>k</code>ï¼Œå®ƒçš„çˆ¶èŠ‚ç‚¹çš„indexä¸º<code>k/2</code>ï¼Œä»–çš„ä¸¤ä¸ªå­èŠ‚ç‚¹çš„indexåˆ†åˆ«ä¸º<code>2k</code>å’Œ<code>2k + 1</code>ã€‚</li><li>äºŒå‰å †æ¶‰åŠåˆ°å…ƒç´ çš„ä¸‹æ²‰å’Œä¸Šæµ®æ“ä½œã€‚</li><li>äºŒå‰å †çš„æ’å…¥æ€è·¯ï¼šå…ˆæ’å…¥åˆ°æ ‘å°¾ï¼Œç„¶åå¯¹è¯¥å…ƒç´ åšä¸Šæµ®æ“ä½œã€‚</li><li>äºŒå‰å †åˆ é™¤æœ€å¤§å€¼å¹¶è¿”å›è¯¥å…ƒç´ æ€è·¯ï¼šå°†æ ¹å…ƒç´ å’Œå°¾å…ƒç´ æ›¿æ¢ï¼Œç„¶åå¯¹æ ¹å…ƒç´ è¿›è¡Œä¸‹æ²‰æ“ä½œï¼Œå¯¹å°¾å…ƒç´ è¿›è¡Œç½®ç©ºæ“ä½œã€‚</li></ul><h2 id="Javaå®ç°æœ€å¤§å€¼ä¼˜å…ˆé˜Ÿåˆ—"><a href="#Javaå®ç°æœ€å¤§å€¼ä¼˜å…ˆé˜Ÿåˆ—" class="headerlink" title="Javaå®ç°æœ€å¤§å€¼ä¼˜å…ˆé˜Ÿåˆ—"></a>Javaå®ç°æœ€å¤§å€¼ä¼˜å…ˆé˜Ÿåˆ—</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼˜å…ˆé˜Ÿåˆ—çš„å®ç°</span></span><br><span class="line"><span class="comment"> * æ•°æ®ç»“æ„ï¼šäºŒå‰å †</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> elong</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017/12/25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MaxPQ</span>&lt;<span class="title">Key</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">Key</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Key[] pq;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> N;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MaxPQ</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        pq = (Key[]) <span class="keyword">new</span> Comparable[capacity + <span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> N == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * lgN</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(Key key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (N == pq.length - <span class="number">1</span>) &#123;</span><br><span class="line">            resize(pq.length * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        pq[++N] = key;</span><br><span class="line">        swim(N);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * lgN</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Key <span class="title">delMax</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException(<span class="string">"Priority queue underflow"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Key max = pq[<span class="number">1</span>];</span><br><span class="line">        exch(<span class="number">1</span>, N--);</span><br><span class="line">        sink(<span class="number">1</span>);</span><br><span class="line">        pq[N + <span class="number">1</span>] = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (N &gt; <span class="number">0</span> &amp;&amp; N == (pq.length - <span class="number">1</span>) / <span class="number">4</span>) &#123;</span><br><span class="line">            resize(pq.length / <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šæµ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">swim</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (k &gt; <span class="number">1</span> &amp;&amp; less(k / <span class="number">2</span>, k)) &#123;</span><br><span class="line">            exch(k / <span class="number">2</span>, k);</span><br><span class="line">            k = k / <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸‹æ²‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sink</span><span class="params">(<span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">2</span> * k &lt;= N) &#123;</span><br><span class="line">            <span class="keyword">int</span> j = <span class="number">2</span> * k;</span><br><span class="line">            <span class="keyword">if</span> (j &lt; N &amp;&amp; less(j, j + <span class="number">1</span>)) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!less(k, j)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            exch(k, j);</span><br><span class="line">            k = j;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">exch</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        Key swap = pq[i];</span><br><span class="line">        pq[j] = pq[i];</span><br><span class="line">        pq[i] = swap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">less</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pq[i].compareTo(pq[j]) &lt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> capacity &gt; N;</span><br><span class="line">        Key[] temp = (Key[]) <span class="keyword">new</span> Object[capacity];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= N; i++) &#123;</span><br><span class="line">            temp[i] = pq[i];</span><br><span class="line">        &#125;</span><br><span class="line">        pq = temp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šï¼ŒäºŒå‰å †æ˜¯æ ‘ä¸­æœ€ç®€å•ä¹Ÿæ˜¯æœ€åŸºç¡€çš„æ•°æ®ç»“æ„ï¼Œæœ‰å¥½çš„åŸºç¡€æ‰ä¼šå­¦æ‡‚åç»­ç›¸å¯¹å¤æ‚çš„æ•°æ®ç»“æ„ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨&quot;&gt;&lt;a href=&quot;#äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨&quot; class=&quot;headerlink&quot; title=&quot;äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨&quot;&gt;&lt;/a&gt;äºŒå‰å †çš„å®šä¹‰å’Œæ€§è´¨&lt;/h2&gt;&lt;p&gt;æ¥è‡ªwiki: &lt;a href=&quot;https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E5%A0%86&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://zh.wikipedia.org/wiki/%E4%BA%8C%E5%8F%89%E5%A0%86&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;äºŒå‰å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„å †ï¼ŒäºŒå‰å †æ˜¯å®Œå…¨äºŒå‰æ ‘æˆ–è€…æ˜¯è¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘ã€‚&lt;/p&gt;
&lt;p&gt;äºŒå‰å †æ»¡è¶³å †ç‰¹æ€§ï¼šçˆ¶èŠ‚ç‚¹çš„é”®å€¼æ€»æ˜¯ä¿æŒå›ºå®šçš„åºå…³ç³»äºä»»ä½•ä¸€ä¸ªå­èŠ‚ç‚¹çš„é”®å€¼ï¼Œä¸”æ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘éƒ½æ˜¯ä¸€ä¸ªäºŒå‰å †ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Algorithms" scheme="http://peierlong.com/categories/Algorithms/"/>
    
    
      <category term="Algorithms" scheme="http://peierlong.com/tags/Algorithms/"/>
    
  </entry>
  
  <entry>
    <title>å¿«é€Ÿæ’åº(QuickSort)çš„å®ç°</title>
    <link href="http://peierlong.com/2017/12/25/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F(QuickSort)%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
    <id>http://peierlong.com/2017/12/25/å¿«é€Ÿæ’åº(QuickSort)çš„å®ç°/</id>
    <published>2017-12-25T09:30:43.000Z</published>
    <updated>2019-03-13T02:32:01.043Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¿«é€Ÿçš„æ’åºé€»è¾‘"><a href="#å¿«é€Ÿçš„æ’åºé€»è¾‘" class="headerlink" title="å¿«é€Ÿçš„æ’åºé€»è¾‘"></a>å¿«é€Ÿçš„æ’åºé€»è¾‘</h2><ul><li>å¿«é€Ÿæ’åºçš„ä¸»è¦æ€æƒ³æ˜¯é€’å½’</li><li>ç¬¬ä¸€æ­¥ï¼šå¯¹éœ€è¦æ’åºçš„æ‰€æœ‰å…ƒç´ è¿›è¡ŒShuffleã€‚</li><li>ç¬¬äºŒæ­¥ï¼šå–ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºåŒºåˆ†å…ƒç´ <code>k</code>ï¼Œå–ç¬¬äºŒä¸ªå…ƒç´ ä¸º<code>i</code>ï¼Œå–æœ€åä¸€ä¸ªå…ƒç´ ä¸º<code>j</code>ï¼Œ<code>i</code>å‘å³<code>j</code>å‘å·¦åˆ†åˆ«è¿­ä»£ï¼Œæœ€åæ›¿æ¢<code>k</code>å…ƒç´ å’Œ<code>j</code>å…ƒç´ ï¼Œæœ€ç»ˆä¿æŒ<code>k</code>å·¦ä¾§çš„å…ƒç´ éƒ½å°äº<code>k</code>ï¼Œå³ä¾§å…ƒç´ éƒ½å¤§äº<code>k</code>ã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼šä¸åœå¯¹å·¦å³éƒ¨åˆ†å†æ¬¡è¿›è¡Œä¸Šä¸€æ­¥åŠ¨ä½œï¼Œæœ€ç»ˆæ’åºå®Œæˆã€‚</li></ul><a id="more"></a><h2 id="Javaä»£ç å®ç°"><a href="#Javaä»£ç å®ç°" class="headerlink" title="Javaä»£ç å®ç°"></a>Javaä»£ç å®ç°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuickSort</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a)</span> </span>&#123;</span><br><span class="line">        Shuffle.shuffle(a);</span><br><span class="line">        sort(a, <span class="number">0</span>, a.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sort</span><span class="params">(Comparable[] a, <span class="keyword">int</span> lo, <span class="keyword">int</span> hi)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (hi &lt;= lo) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> j = partition(a, lo, hi);</span><br><span class="line">        sort(a, lo, j - <span class="number">1</span>);</span><br><span class="line">        sort(a, j + <span class="number">1</span>, hi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(Comparable[] a, <span class="keyword">int</span> lo, <span class="keyword">int</span> hi)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = lo, j = hi + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (less(a[++i], a[lo])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i == hi) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (less(a[lo], a[--j])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j == lo) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= j) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(a, i, j);</span><br><span class="line">        &#125;</span><br><span class="line">        swap(a, lo, j);</span><br><span class="line">        <span class="keyword">return</span> j;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ä¼˜åŒ–"><a href="#å°ä¼˜åŒ–" class="headerlink" title="å°ä¼˜åŒ–"></a>å°ä¼˜åŒ–</h2><p>åœ¨æ•°ç»„å¤§å°è¾ƒå°æ—¶ï¼Œä½¿ç”¨æ’å…¥æ’åºæ¯”å¿«é€Ÿæ’åºæ‰§è¡Œæ•ˆç‡è¦é«˜ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private static final int INSERTIONSORT_THRESHOLD = 7;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((hi - lo) &lt; INSERTIONSORT_THRESHOLD) &#123;</span><br><span class="line">    InsertionSort.sort(a, lo, hi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šï¼Œå¿«é€Ÿæ’åºçš„æ€æƒ³çœŸçš„æœ‰äº›çƒ§è„‘ï¼Œå®ç°èµ·æ¥å‘è¿˜æ˜¯å¾ˆå¤šï¼Œéœ€è¦ä»”ç»†ä»”ç»†å†ä»”ç»†çš„æ€è€ƒæ¯ä¸€ä¸ªç»†èŠ‚ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;å¿«é€Ÿçš„æ’åºé€»è¾‘&quot;&gt;&lt;a href=&quot;#å¿«é€Ÿçš„æ’åºé€»è¾‘&quot; class=&quot;headerlink&quot; title=&quot;å¿«é€Ÿçš„æ’åºé€»è¾‘&quot;&gt;&lt;/a&gt;å¿«é€Ÿçš„æ’åºé€»è¾‘&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å¿«é€Ÿæ’åºçš„ä¸»è¦æ€æƒ³æ˜¯é€’å½’&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸€æ­¥ï¼šå¯¹éœ€è¦æ’åºçš„æ‰€æœ‰å…ƒç´ è¿›è¡ŒShuffleã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬äºŒæ­¥ï¼šå–ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºåŒºåˆ†å…ƒç´ &lt;code&gt;k&lt;/code&gt;ï¼Œå–ç¬¬äºŒä¸ªå…ƒç´ ä¸º&lt;code&gt;i&lt;/code&gt;ï¼Œå–æœ€åä¸€ä¸ªå…ƒç´ ä¸º&lt;code&gt;j&lt;/code&gt;ï¼Œ&lt;code&gt;i&lt;/code&gt;å‘å³&lt;code&gt;j&lt;/code&gt;å‘å·¦åˆ†åˆ«è¿­ä»£ï¼Œæœ€åæ›¿æ¢&lt;code&gt;k&lt;/code&gt;å…ƒç´ å’Œ&lt;code&gt;j&lt;/code&gt;å…ƒç´ ï¼Œæœ€ç»ˆä¿æŒ&lt;code&gt;k&lt;/code&gt;å·¦ä¾§çš„å…ƒç´ éƒ½å°äº&lt;code&gt;k&lt;/code&gt;ï¼Œå³ä¾§å…ƒç´ éƒ½å¤§äº&lt;code&gt;k&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;ç¬¬ä¸‰æ­¥ï¼šä¸åœå¯¹å·¦å³éƒ¨åˆ†å†æ¬¡è¿›è¡Œä¸Šä¸€æ­¥åŠ¨ä½œï¼Œæœ€ç»ˆæ’åºå®Œæˆã€‚&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="Algorithms" scheme="http://peierlong.com/categories/Algorithms/"/>
    
    
      <category term="Algorithms" scheme="http://peierlong.com/tags/Algorithms/"/>
    
  </entry>
  
</feed>
